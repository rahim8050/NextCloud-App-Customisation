{"version":3,"file":"richdocuments-src_view_Viewer_vue.js?v=08049da19d648e9f9c4b","mappings":"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","sources":["webpack:///richdocuments/src/components/Modal/Confirmation.vue?vue&type=style&index=0&id=59370936&prod&lang=scss&scoped=true","webpack:///richdocuments/src/components/Modal/SaveAs.vue?vue&type=style&index=0&id=36c6412a&prod&lang=scss&scoped=true","webpack:///richdocuments/src/components/Modal/ZoteroHint.vue?vue&type=style&index=0&id=f3a018ec&prod&lang=scss&scoped=true","webpack:///richdocuments/src/view/Office.vue?vue&type=style&index=0&id=463e23e0&prod&lang=scss&scoped=true","webpack:///richdocuments/src/view/Office.vue?vue&type=style&index=1&id=463e23e0&prod&lang=scss","webpack://richdocuments/./src/view/Viewer.vue?a1c5","webpack:///richdocuments/src/services/api.js","webpack:///richdocuments/src/components/Modal/ZoteroHint.vue?vue&type=script&lang=js","webpack:///richdocuments/src/components/Modal/ZoteroHint.vue","webpack://richdocuments/./src/components/Modal/ZoteroHint.vue?86a2","webpack://richdocuments/./src/components/Modal/ZoteroHint.vue?e661","webpack://richdocuments/./src/components/Modal/ZoteroHint.vue?425a","webpack:///richdocuments/src/helpers/isDocument.js","webpack:///richdocuments/src/helpers/index.js","webpack:///richdocuments/src/services/config.tsx","webpack:///richdocuments/src/helpers/url.js","webpack:///richdocuments/src/services/postMessage.tsx","webpack:///richdocuments/src/components/Modal/SaveAs.vue","webpack:///richdocuments/src/components/Modal/SaveAs.vue?vue&type=script&lang=js","webpack://richdocuments/./src/components/Modal/SaveAs.vue?66e8","webpack://richdocuments/./src/components/Modal/SaveAs.vue?27bc","webpack://richdocuments/./src/components/Modal/SaveAs.vue?c6fa","webpack:///richdocuments/src/view/FilesAppIntegration.js","webpack:///richdocuments/src/helpers/filesApp.js","webpack:///richdocuments/src/services/collabora.js","webpack:///richdocuments/src/helpers/safariFixer.js","webpack:///richdocuments/src/helpers/coolParameters.js","webpack:///richdocuments/src/mixins/autoLogout.js","webpack:///richdocuments/src/components/Modal/Confirmation.vue","webpack:///richdocuments/src/components/Modal/Confirmation.vue?vue&type=script&lang=js","webpack://richdocuments/./src/components/Modal/Confirmation.vue?7863","webpack://richdocuments/./src/components/Modal/Confirmation.vue?d4ac","webpack://richdocuments/./src/components/Modal/Confirmation.vue?152e","webpack:///richdocuments/src/mixins/openLocal.js","webpack:///richdocuments/src/mixins/pickLink.js","webpack:///richdocuments/src/mixins/assistant.js","webpack:///richdocuments/src/mixins/saveAs.js","webpack:///richdocuments/src/mixins/uiMention.js","webpack:///richdocuments/src/mixins/version.js","webpack:///richdocuments/src/helpers/getLoggedInUser.js","webpack:///richdocuments/src/view/Office.vue","webpack:///richdocuments/src/helpers/guestName.js","webpack:///richdocuments/src/view/Office.vue?vue&type=script&lang=js","webpack://richdocuments/./src/view/Office.vue?f36a","webpack://richdocuments/./src/view/Office.vue?1c6d","webpack://richdocuments/./src/view/Office.vue?3499","webpack://richdocuments/./src/view/Office.vue?66c9","webpack:///richdocuments/src/view/Viewer.vue","webpack:///richdocuments/src/view/Viewer.vue?vue&type=script&lang=js","webpack://richdocuments/./src/view/Viewer.vue?d6a7"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.confirmation-dialog[data-v-59370936]{display:flex;flex-direction:column;align-items:flex-start;margin:24px}.confirmation-dialog h1[data-v-59370936]{font-size:120%;font-weight:bold;margin-bottom:12px}.confirmation-dialog--buttons[data-v-59370936]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%;margin-top:24px}`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/components/Modal/Confirmation.vue\"],\"names\":[],\"mappings\":\"AACA,sCACI,YAAA,CACA,qBAAA,CACA,sBAAA,CACA,WAAA,CACA,yCACI,cAAA,CACA,gBAAA,CACA,kBAAA,CAGJ,+CACI,YAAA,CACA,kBAAA,CACA,kBAAA,CACA,6BAAA,CACA,UAAA,CACA,eAAA\",\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.saveas-dialog[data-v-36c6412a]{display:flex;flex-direction:column;align-items:flex-start;margin:24px}.saveas-dialog h1[data-v-36c6412a]{font-size:120%;font-weight:bold;margin-bottom:12px}.saveas-dialog p[data-v-36c6412a]{margin-bottom:12px}.saveas-dialog--buttons[data-v-36c6412a]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%;margin-top:24px}`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/components/Modal/SaveAs.vue\"],\"names\":[],\"mappings\":\"AACA,gCACI,YAAA,CACA,qBAAA,CACA,sBAAA,CACA,WAAA,CAEH,mCACO,cAAA,CACA,gBAAA,CACA,kBAAA,CAGP,kCACC,kBAAA,CAGE,yCACI,YAAA,CACA,kBAAA,CACA,kBAAA,CACA,6BAAA,CACA,UAAA,CACA,eAAA\",\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.zotero-hint[data-v-f3a018ec]{margin:24px}.zotero-hint form[data-v-f3a018ec],.zotero-hint .input-field[data-v-f3a018ec]{margin-top:24px}.zotero-hint div.submit[data-v-f3a018ec]{margin-top:12px;display:flex;justify-content:end}`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/components/Modal/ZoteroHint.vue\"],\"names\":[],\"mappings\":\"AACA,8BACC,WAAA,CAEA,8EACC,eAAA,CAGD,yCACC,eAAA,CACA,YAAA,CACA,mBAAA\",\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.office-viewer[data-v-463e23e0]{z-index:100000;max-width:100%;display:flex;flex-direction:column;background-color:var(--color-main-background)}.office-viewer__loading-overlay[data-v-463e23e0]:not(.viewer__file--hidden){border-top:3px solid var(--color-primary-element);display:flex;height:100%;width:100%;z-index:1;top:0;left:0;background-color:var(--color-main-background)}.office-viewer__loading-overlay:not(.viewer__file--hidden).debug[data-v-463e23e0]{opacity:.5}.office-viewer__loading-overlay[data-v-463e23e0]:not(.viewer__file--hidden) .empty-content p{text-align:center}.office-viewer__loading-overlay:not(.viewer__file--hidden) .empty-content[data-v-463e23e0]{align-self:center;flex-grow:1}.office-viewer__embedding[data-v-463e23e0]{min-height:400px}.office-viewer__embedding .toggle-interactive[data-v-463e23e0]{position:sticky;bottom:12px;right:12px;z-index:1;margin-left:auto;margin-right:0}.office-viewer__iframe[data-v-463e23e0]{width:100%;flex-grow:1}`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/view/Office.vue\"],\"names\":[],\"mappings\":\"AACA,gCACC,cAAA,CACA,cAAA,CACA,YAAA,CACA,qBAAA,CACA,6CAAA,CAEA,4EACC,iDAAA,CACA,YAAA,CACA,WAAA,CACA,UAAA,CACA,SAAA,CACA,KAAA,CACA,MAAA,CACA,6CAAA,CACA,kFACC,UAAA,CAGD,6FACC,iBAAA,CAGD,2FACC,iBAAA,CACA,WAAA,CAIF,2CACC,gBAAA,CAEA,+DACC,eAAA,CACA,WAAA,CACA,UAAA,CACA,SAAA,CACA,gBAAA,CACA,cAAA,CAIF,wCACC,UAAA,CACA,WAAA\",\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.viewer__content:not(.viewer--split) .office-viewer:not(.viewer__file--hidden):not(.widget-file){width:100%;height:100vh;height:100dvh;top:-50px;position:absolute}[data-handler=richdocuments] .modal-container{bottom:0}.viewer__content.viewer--split .office-viewer{height:100%;width:100%}`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/view/Office.vue\"],\"names\":[],\"mappings\":\"AACA,iGACC,UAAA,CACA,YAAA,CACA,aAAA,CACA,SAAA,CACA,iBAAA,CAGD,8CACC,QAAA,CAGD,8CACC,WAAA,CACA,UAAA\",\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('Office',{attrs:{\"filename\":_vm.filename,\"fileid\":_vm.fileid,\"has-preview\":_vm.hasPreview,\"source\":_vm.source,\"mime\":_vm.mime,\"permissions\":_vm.permissions,\"is-embedded\":_vm.isEmbedded},on:{\"close\":function($event){return _vm.$parent.close()},\"update:loaded\":function($event){return _vm.$emit('update:loaded', $event)}}})\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/**\n * SPDX-FileCopyrightText: 2021 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport axios from '@nextcloud/axios'\nimport { generateOcsUrl, generateFilePath } from '@nextcloud/router'\nimport { getSharingToken } from '@nextcloud/sharing/public'\n\nexport const createEmptyFile = async (context, mimeType, fileName, templateId = null) => {\n\tconst shareToken = getSharingToken()\n\n\tconst response = await axios.post(generateOcsUrl('apps/richdocuments/api/v1/file', 2), {\n\t\tmimeType,\n\t\tfileName,\n\t\tdirectoryPath: context.dirname,\n\t\tshareToken,\n\t\ttemplateId,\n\t})\n\n\treturn response.data\n}\n\nexport const savePersonalSetting = (data) => {\n\treturn axios.post(generateFilePath('richdocuments', 'ajax', 'personal.php'), data)\n}\n","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ZoteroHint.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ZoteroHint.vue?vue&type=script&lang=js\"","<!--\n  - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcModal :show=\"show\" :name=\"t('richdocument', 'Link to your Zotero library')\" @close=\"close\">\n\t\t<div class=\"zotero-hint\">\n\t\t\t<h2>{{ t('richdocument', 'Link to your Zotero library') }}</h2>\n\t\t\t<BookOpenPageVariantOutline :size=\"96\" />\n\t\t\t<p>{{ t('richdocuments', 'Connect your Zotero account to make use of references within Office.') }}</p>\n\t\t\t<p>\n\t\t\t\t{{ t('richdocuments', 'You can generate an account key here:') }}\n\t\t\t\t<a href=\"https://www.zotero.org/settings/keys/new\" target=\"_blank\" class=\"external\">\n\t\t\t\t\t{{ t('richdocuments', 'Zotero account settings') }}\n\t\t\t\t</a>\n\t\t\t</p>\n\t\t\t<form @submit.prevent=\"submit\">\n\t\t\t\t<NcTextField :value.sync=\"apiKey\"\n\t\t\t\t\t:label=\"t('richdocuments', 'Zotero API key')\"\n\t\t\t\t\t:placeholder=\"t('richdocuments', 'Zotero API key')\" />\n\t\t\t\t<div class=\"submit\">\n\t\t\t\t\t<NcButton :aria-label=\"t('richdocuments', 'Submit')\" type=\"primary\" @click=\"submit\">\n\t\t\t\t\t\t{{ t('richdocuments', 'Submit') }}\n\t\t\t\t\t</NcButton>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t</NcModal>\n</template>\n\n<script>\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\nimport NcModal from '@nextcloud/vue/dist/Components/NcModal.js'\nimport NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\nimport { showError } from '@nextcloud/dialogs'\nimport BookOpenPageVariantOutline from 'vue-material-design-icons/BookOpenPageVariantOutline.vue'\nimport { savePersonalSetting } from '../../services/api.js'\nexport default {\n\tname: 'ZoteroHint',\n\tcomponents: {\n\t\tBookOpenPageVariantOutline,\n\t\tNcModal,\n\t\tNcButton,\n\t\tNcTextField,\n\t},\n\tprops: {\n\t\tshow: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['submit'],\n\tdata() {\n\t\treturn {\n\t\t\tapiKey: '',\n\t\t}\n\t},\n\tmethods: {\n\t\tasync submit() {\n\t\t\ttry {\n\t\t\t\tawait savePersonalSetting({\n\t\t\t\t\tzoteroAPIKeyInput: this.apiKey,\n\t\t\t\t})\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Failed to set zotero api key', e)\n\t\t\t\tshowError(t('richdocuments', 'Failed to set Zotero API key'))\n\t\t\t}\n\t\t\tthis.$emit('submit')\n\t\t\tthis.close()\n\t\t},\n\t\tclose() {\n\t\t\tthis.$emit('update:show', false)\n\t\t},\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.zotero-hint {\n\tmargin: 24px;\n\n\tform, .input-field {\n\t\tmargin-top: 24px;\n\t}\n\n\tdiv.submit {\n\t\tmargin-top: 12px;\n\t\tdisplay: flex;\n\t\tjustify-content: end;\n\t}\n}\n</style>\n","\n      import API from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ZoteroHint.vue?vue&type=style&index=0&id=f3a018ec&prod&lang=scss&scoped=true\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ZoteroHint.vue?vue&type=style&index=0&id=f3a018ec&prod&lang=scss&scoped=true\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render, staticRenderFns } from \"./ZoteroHint.vue?vue&type=template&id=f3a018ec&scoped=true\"\nimport script from \"./ZoteroHint.vue?vue&type=script&lang=js\"\nexport * from \"./ZoteroHint.vue?vue&type=script&lang=js\"\nimport style0 from \"./ZoteroHint.vue?vue&type=style&index=0&id=f3a018ec&prod&lang=scss&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f3a018ec\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('NcModal',{attrs:{\"show\":_vm.show,\"name\":_vm.t('richdocument', 'Link to your Zotero library')},on:{\"close\":_vm.close}},[_c('div',{staticClass:\"zotero-hint\"},[_c('h2',[_vm._v(_vm._s(_vm.t('richdocument', 'Link to your Zotero library')))]),_vm._v(\" \"),_c('BookOpenPageVariantOutline',{attrs:{\"size\":96}}),_vm._v(\" \"),_c('p',[_vm._v(_vm._s(_vm.t('richdocuments', 'Connect your Zotero account to make use of references within Office.')))]),_vm._v(\" \"),_c('p',[_vm._v(\"\\n\\t\\t\\t\"+_vm._s(_vm.t('richdocuments', 'You can generate an account key here:'))+\"\\n\\t\\t\\t\"),_c('a',{staticClass:\"external\",attrs:{\"href\":\"https://www.zotero.org/settings/keys/new\",\"target\":\"_blank\"}},[_vm._v(\"\\n\\t\\t\\t\\t\"+_vm._s(_vm.t('richdocuments', 'Zotero account settings'))+\"\\n\\t\\t\\t\")])]),_vm._v(\" \"),_c('form',{on:{\"submit\":function($event){$event.preventDefault();return _vm.submit.apply(null, arguments)}}},[_c('NcTextField',{attrs:{\"value\":_vm.apiKey,\"label\":_vm.t('richdocuments', 'Zotero API key'),\"placeholder\":_vm.t('richdocuments', 'Zotero API key')},on:{\"update:value\":function($event){_vm.apiKey=$event}}}),_vm._v(\" \"),_c('div',{staticClass:\"submit\"},[_c('NcButton',{attrs:{\"aria-label\":_vm.t('richdocuments', 'Submit'),\"type\":\"primary\"},on:{\"click\":_vm.submit}},[_vm._v(\"\\n\\t\\t\\t\\t\\t\"+_vm._s(_vm.t('richdocuments', 'Submit'))+\"\\n\\t\\t\\t\\t\")])],1)],1)],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/**\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nimport { getCapabilities } from './../services/capabilities.ts'\n\n/** @type Array.<String> */\nconst mimetypes = getCapabilities().mimetypes\n\n/**\n * Determines if the mimetype of the resource is supported by richdocuments\n * @return {boolean}\n */\nfunction isDocument() {\n\t/** @type HTMLInputElement */\n\tconst mimetypeElement = document.getElementById('mimetype')\n\n\treturn Boolean(mimetypeElement) && mimetypes.includes(mimetypeElement.value)\n}\n\nexport default isDocument\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { getLanguage, getLocale } from '@nextcloud/l10n'\n\nconst languageToBCP47 = () => {\n\tlet language = getLanguage().replace(/_/g, '-')\n\tconst locale = getLocale()\n\n\t// German formal should just be treated as 'de'\n\tif (language === 'de-DE') {\n\t\tlanguage = 'de'\n\t}\n\n\t// es-419 should be mapped as this is not considered a valid locale string in COOL\n\tif (language === 'es-419') {\n\t\tlanguage = 'es-MX'\n\t}\n\n\t// Australia\n\tif (language === 'en-GB' && locale === 'en_AU') {\n\t\tlanguage = 'en-AU'\n\t}\n\n\t// special case where setting the bc47 region depending on the locale setting makes sense\n\tconst whitelist = {\n\t\tde: {\n\t\t\tde_CH: 'de-CH',\n\t\t\tgsw: 'de-CH',\n\t\t\tgsw_CH: 'de-CH',\n\t\t},\n\t\tfr: {\n\t\t\tfr_CH: 'fr-CH',\n\t\t},\n\t\tit: {\n\t\t\tit_CH: 'it-CH',\n\t\t},\n\t}\n\tconst matchingWhitelist = whitelist[language]\n\tif (typeof matchingWhitelist !== 'undefined' && typeof matchingWhitelist[locale] !== 'undefined') {\n\t\treturn matchingWhitelist[locale]\n\t}\n\n\t// Collabora Online expects BCP47 language tag syntax.\n\t// When the Nextcloud language consists of two parts, we send both,\n\t// as the region is then provided by the language setting.\n\treturn language\n}\n\nconst getNextcloudVersion = () => {\n\treturn parseInt(OC.config.version.split('.')[0])\n}\n\nconst splitPath = (path) => {\n\tconst fileName = path.split('\\\\').pop().split('/').pop()\n\tconst directory = path.slice(0, -fileName.length - 1)\n\treturn [directory, fileName]\n}\n\nconst getRandomId = (length = 5) => {\n\treturn Math.random()\n\t\t.toString(36)\n\t\t.replace(/[^a-z]+/g, '')\n\t\t.slice(0, length || 5)\n\n}\n\nexport {\n\tlanguageToBCP47,\n\tgetNextcloudVersion,\n\tsplitPath,\n\tgetRandomId,\n}\n\nexport { default as isDocument } from './isDocument.js'\nexport { default as isPdf } from './isPdf.js'\nexport { default as isDownloadHidden } from './isDownloadHidden.js'\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\n/*\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nimport { loadState } from '@nextcloud/initial-state';\nvar ConfigService = /** @class */ (function () {\n    function ConfigService() {\n        this.values = __assign({ wopi_callback_url: loadState('richdocuments', 'wopi_callback_url', '') }, loadState('richdocuments', 'document', {}));\n    }\n    ConfigService.prototype.update = function (key, value) {\n        this.values[key] = value;\n    };\n    ConfigService.prototype.get = function (key) {\n        return this.values[key];\n    };\n    return ConfigService;\n}());\nvar Config = new ConfigService();\nexport default Config;\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { getRootUrl, generateUrl } from '@nextcloud/router'\nimport { getSharingToken } from '@nextcloud/sharing/public'\nimport { languageToBCP47 } from './index.js'\nimport Config from './../services/config.tsx'\n\nconst getSearchParam = (name) => {\n\tconst results = new RegExp('[?&]' + name + '=([^&#]*)').exec(window.location.href)\n\tif (results === null) {\n\t\treturn null\n\t}\n\treturn decodeURI(results[1]) || ''\n}\n\nconst getCallbackBaseUrl = () => {\n\tconst callbackUrl = Config.get('wopi_callback_url')\n\treturn callbackUrl || window.location.protocol + '//' + window.location.host + getRootUrl()\n}\n\nconst getWopiSrc = (fileId) => {\n\t// WOPISrc - URL that Collabora will use to access Nextcloud\n\t// index.php is forced here to avoid different wopi srcs for the same document\n\tconst wopiurl = getCallbackBaseUrl() + '/index.php/apps/richdocuments/wopi/files/' + fileId\n\tconsole.debug('[getWopiUrl] ' + wopiurl)\n\treturn wopiurl\n}\n\nconst getWopiUrl = ({ fileId, readOnly, closeButton, revisionHistory, target = undefined, startPresentation = false }) => {\n\t// Only set the revision history parameter if the versions app is enabled\n\trevisionHistory = revisionHistory && window?.oc_appswebroots?.files_versions\n\n\t// urlsrc - the URL from discovery xml that we access for the particular\n\t// document; we add various parameters to that.\n\t// The discovery is available at\n\t//   https://<loolwsd-server>:9980/hosting/discovery\n\treturn Config.get('urlsrc')\n\t\t+ 'WOPISrc=' + encodeURIComponent(getWopiSrc(fileId))\n\t\t+ '&lang=' + languageToBCP47()\n\t\t+ (closeButton ? '&closebutton=1' : '')\n\t\t+ (revisionHistory ? '&revisionhistory=1' : '')\n\t\t+ (readOnly ? '&permission=readonly' : '')\n\t\t+ (target ? '&target=' + encodeURIComponent(target) : '')\n\t\t+ (startPresentation ? '&startPresentation=1' : '')\n}\n\nconst getDocumentUrlFromTemplate = (templateId, fileName, fileDir, fillWithTemplate) => {\n\treturn generateUrl(\n\t\t'apps/richdocuments/indexTemplate?templateId={templateId}&fileName={fileName}&dir={dir}&requesttoken={requesttoken}',\n\t\t{\n\t\t\ttemplateId,\n\t\t\tfileName,\n\t\t\tdir: fileDir,\n\t\t\trequesttoken: OC.requestToken,\n\t\t},\n\t)\n}\n\nconst getDocumentUrlForPublicFile = (fileName, fileId) => {\n\treturn generateUrl(\n\t\t'apps/richdocuments/public?shareToken={shareToken}&fileName={fileName}&requesttoken={requesttoken}&fileId={fileId}',\n\t\t{\n\t\t\tshareToken: getSharingToken(),\n\t\t\tfileName,\n\t\t\tfileId,\n\t\t\trequesttoken: OC.requestToken,\n\t\t},\n\t)\n}\n\nconst getDocumentUrlForFile = (fileDir, fileId) => {\n\treturn generateUrl(\n\t\t'apps/richdocuments/index?fileId={fileId}&requesttoken={requesttoken}',\n\t\t{\n\t\t\tfileId,\n\t\t\tdir: fileDir,\n\t\t\trequesttoken: OC.requestToken,\n\t\t})\n}\n\nexport const getConfigFileUrl = () => {\n\treturn generateUrl('apps/richdocuments/wopi/settings', null, { baseURL: getCallbackBaseUrl() })\n}\n\nconst getNextcloudUrl = () => {\n\treturn window.location.host\n}\n\nexport {\n\tgetSearchParam,\n\tgetWopiUrl,\n\tgetCallbackBaseUrl,\n\n\tgetDocumentUrlFromTemplate,\n\tgetDocumentUrlForPublicFile,\n\tgetDocumentUrlForFile,\n\tgetNextcloudUrl,\n}\n","/*\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nimport { emit } from '@nextcloud/event-bus';\nvar PostMessageService = /** @class */ (function () {\n    function PostMessageService(targets) {\n        var _this = this;\n        this.postMessageHandlers = [];\n        this.targets = targets;\n        window.addEventListener('message', function (event) {\n            _this.handlePostMessage(event.data);\n        }, false);\n    }\n    PostMessageService.prototype.sendPostMessage = function (target, message, targetOrigin) {\n        if (targetOrigin === void 0) { targetOrigin = '*'; }\n        var targetElement;\n        if (typeof this.targets[target] === 'function') {\n            targetElement = this.targets[target]();\n        }\n        else {\n            targetElement = this.targets[target];\n        }\n        targetElement.postMessage(message, targetOrigin);\n        console.debug('PostMessageService.sendPostMessage', target, message);\n    };\n    PostMessageService.prototype.sendWOPIPostMessage = function (target, msgId, values) {\n        if (values === void 0) { values = {}; }\n        var msg = {\n            MessageId: msgId,\n            SendTime: Date.now(),\n            Values: values,\n        };\n        this.sendPostMessage(target, JSON.stringify(msg));\n    };\n    PostMessageService.parsePostMessage = function (data) {\n        var msgId, args, deprecated;\n        try {\n            var msg = JSON.parse(data);\n            msgId = msg.MessageId;\n            args = msg.Values;\n            deprecated = !!msg.Values.Deprecated;\n        }\n        catch (exc) {\n            msgId = data;\n        }\n        return { msgId: msgId, args: args, deprecated: deprecated };\n    };\n    PostMessageService.prototype.registerPostMessageHandler = function (callback) {\n        this.postMessageHandlers.push(callback);\n    };\n    PostMessageService.prototype.unregisterPostMessageHandler = function (callback) {\n        var handlerIndex = this.postMessageHandlers.findIndex(function (cb) { return cb === callback; });\n        delete this.postMessageHandlers[handlerIndex];\n    };\n    PostMessageService.prototype.handlePostMessage = function (data) {\n        var parsed = PostMessageService.parsePostMessage(data);\n        if (typeof parsed === 'undefined' || parsed === null) {\n            return;\n        }\n        try {\n            var wopiPostMessage = JSON.parse(data);\n            if (typeof wopiPostMessage === 'object' && wopiPostMessage !== null) {\n                emit('richdocuments:wopi-post', wopiPostMessage);\n            }\n        }\n        catch (e) { }\n        this.postMessageHandlers.forEach(function (fn) {\n            if (parsed.deprecated) {\n                console.debug('PostMessageService.handlePostMessage', 'Ignoring deprecated post message', parsed.msgId);\n                return;\n            }\n            try {\n                fn({\n                    data: data,\n                    parsed: parsed,\n                });\n            }\n            catch (e) {\n                console.error('Error during post message handler', parsed, e);\n            }\n        });\n    };\n    return PostMessageService;\n}());\nexport default PostMessageService;\n","<!--\n  - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcModal :name=\"t('richdocuments', 'Save as')\">\n\t\t<div class=\"saveas-dialog\">\n\t\t\t<h1>{{ name }}</h1>\n\t\t\t<p>{{ description }}</p>\n\t\t\t<NcTextField ref=\"nameInput\"\n\t\t\t\tv-model=\"newFileName\"\n\t\t\t\t:label-visible=\"true\"\n\t\t\t\t:label=\"t('richdocuments', 'Path to save')\"\n\t\t\t\t:placeholder=\"'/path/to/save'\" />\n\t\t\t<div class=\"saveas-dialog--buttons\">\n\t\t\t\t<NcButton type=\"secondary\"\n\t\t\t\t\t@click=\"cancel\">\n\t\t\t\t\t{{ t('richdocuments', 'Cancel') }}\n\t\t\t\t</NcButton>\n\t\t\t\t<NcButton type=\"primary\"\n\t\t\t\t\t@click=\"close\">\n\t\t\t\t\t{{ t('richdocuments', 'Save') }}\n\t\t\t\t</NcButton>\n\t\t\t</div>\n\t\t</div>\n\t</NcModal>\n</template>\n\n<script>\nimport { translate as t } from '@nextcloud/l10n'\n\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\nimport NcModal from '@nextcloud/vue/dist/Components/NcModal.js'\nimport NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\n\nexport default {\n\tname: 'SaveAs',\n\tcomponents: {\n\t\tNcModal,\n\t\tNcButton,\n\t\tNcTextField,\n\t},\n\tprops: {\n\t\tname: {\n\t\t\ttype: String,\n\t\t\tdefault: t('richdocuments', 'Save As'),\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tbuttonText: {\n\t\t\ttype: String,\n\t\t\tdefault: t('richdocuments', 'Save'),\n\t\t},\n\t\tpath: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tformat: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['close'],\n\tdata() {\n\t\treturn {\n\t\t\tselectedPath: '',\n\t\t}\n\t},\n\tcomputed: {\n\t\tnewFileName: {\n\t\t\tget() {\n\t\t\t\tif (this.selectedPath !== '') {\n\t\t\t\t\treturn this.selectedPath\n\t\t\t\t}\n\t\t\t\tconst filename = this.path\n\t\t\t\tconst extension = filename.split('.').pop()\n\t\t\t\tconst filenameWithoutExtension = filename.substring(0, filename.length - extension.length - 1)\n\t\t\t\treturn filenameWithoutExtension + '.' + (this.format !== '' ? this.format : extension)\n\t\t\t},\n\t\t\tset(value) {\n\t\t\t\tthis.selectedPath = value\n\t\t\t},\n\t\t},\n\t},\n\tmounted() {\n\t\t// prepare filename for having a separate picker for the path (.split('/').pop())\n\t\tconst filename = this.path\n\t\tconst extension = filename.split('.').pop()\n\t\tconst filenameWithoutExtension = filename.substring(0, filename.length - extension.length - 1)\n\t\tthis.$nextTick(() => {\n\t\t\tconst input = this.$refs.nameInput.$refs.inputField.$el.querySelector('input')\n\t\t\tinput.setSelectionRange(0, filenameWithoutExtension.length)\n\t\t\tinput.focus()\n\t\t})\n\t},\n\tmethods: {\n\t\tt,\n\t\tclose() {\n\t\t\tthis.$emit('close', this.newFileName)\n\t\t},\n\t\tcancel() {\n\t\t\tthis.$emit('close', null)\n\t\t},\n\t},\n}\n</script>\n<style lang=\"scss\" scoped>\n.saveas-dialog {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n    margin: 24px;\n\n\th1 {\n        font-size: 120%;\n        font-weight: bold;\n        margin-bottom: 12px;\n    }\n\n\tp {\n\t\tmargin-bottom: 12px;\n\t}\n\n    &--buttons {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        justify-content: space-between;\n        width: 100%;\n        margin-top: 24px;\n    }\n}\n</style>\n","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SaveAs.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SaveAs.vue?vue&type=script&lang=js\"","\n      import API from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SaveAs.vue?vue&type=style&index=0&id=36c6412a&prod&lang=scss&scoped=true\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SaveAs.vue?vue&type=style&index=0&id=36c6412a&prod&lang=scss&scoped=true\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render, staticRenderFns } from \"./SaveAs.vue?vue&type=template&id=36c6412a&scoped=true\"\nimport script from \"./SaveAs.vue?vue&type=script&lang=js\"\nexport * from \"./SaveAs.vue?vue&type=script&lang=js\"\nimport style0 from \"./SaveAs.vue?vue&type=style&index=0&id=36c6412a&prod&lang=scss&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"36c6412a\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('NcModal',{attrs:{\"name\":_vm.t('richdocuments', 'Save as')}},[_c('div',{staticClass:\"saveas-dialog\"},[_c('h1',[_vm._v(_vm._s(_vm.name))]),_vm._v(\" \"),_c('p',[_vm._v(_vm._s(_vm.description))]),_vm._v(\" \"),_c('NcTextField',{ref:\"nameInput\",attrs:{\"label-visible\":true,\"label\":_vm.t('richdocuments', 'Path to save'),\"placeholder\":'/path/to/save'},model:{value:(_vm.newFileName),callback:function ($$v) {_vm.newFileName=$$v},expression:\"newFileName\"}}),_vm._v(\" \"),_c('div',{staticClass:\"saveas-dialog--buttons\"},[_c('NcButton',{attrs:{\"type\":\"secondary\"},on:{\"click\":_vm.cancel}},[_vm._v(\"\\n\\t\\t\\t\\t\"+_vm._s(_vm.t('richdocuments', 'Cancel'))+\"\\n\\t\\t\\t\")]),_vm._v(\" \"),_c('NcButton',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.close}},[_vm._v(\"\\n\\t\\t\\t\\t\"+_vm._s(_vm.t('richdocuments', 'Save'))+\"\\n\\t\\t\\t\")])],1)],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { generateUrl } from '@nextcloud/router'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { getFilePickerBuilder, spawnDialog } from '@nextcloud/dialogs'\nimport { isPublicShare } from '@nextcloud/sharing/public'\nimport axios from '@nextcloud/axios'\nimport { emit } from '@nextcloud/event-bus'\nimport { getCurrentDirectory } from '../helpers/filesApp.js'\nimport {\n\tdavGetClient,\n\tdavGetDefaultPropfind,\n\tdavResultToNode,\n\tdavRootPath,\n} from '@nextcloud/files'\nimport SaveAs from '../components/Modal/SaveAs.vue'\n\nexport default {\n\n\tfileNode: undefined,\n\n\tfileModel: null,\n\n\tfileList: undefined,\n\n\tfilePath: undefined,\n\n\t/* Views: people currently editing the file */\n\tviews: {},\n\n\tfollowingEditor: false,\n\n\tfollowing: null,\n\n\thandlers: {},\n\n\tstartLoading() {\n\t\tif (this.getFileList()) {\n\t\t\tthis.getFileList().setViewerMode && this.getFileList().setViewerMode(true)\n\t\t\tthis.getFileList().showMask && this.getFileList().showMask()\n\t\t}\n\t},\n\n\tinit({ fileName, fileId, filePath, sendPostMessage, fileList, fileModel }) {\n\t\tthis.fileNode = undefined\n\t\tthis.fileName = fileName\n\t\tthis.fileId = fileId\n\t\tthis.fileList = fileList\n\t\tthis.filePath = filePath\n\t\tthis.fileModel = fileModel\n\t\tthis.sendPostMessage = sendPostMessage\n\n\t\tif (this.fileModel && this.fileModel.on) {\n\t\t\tthis.fileModel.on('change', () => {\n\t\t\t\tthis._addHeaderFileActions()\n\t\t\t})\n\t\t}\n\n\t\tthis.getFileNode(true)\n\t},\n\n\tregisterHandler(event, callback) {\n\t\tthis.handlers[event] = callback\n\t},\n\n\tinitAfterReady() {\n\t\tif (this.handlers.initAfterReady && this.handlers.initAfterReady(this)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (this.getFileList()) {\n\t\t\tthis.getFileModel()\n\t\t\tthis.getFileList().hideMask && this.getFileList().hideMask()\n\t\t\tthis.getFileList().setPageTitle && this.getFileList().setPageTitle(this.fileName)\n\t\t}\n\t},\n\n\tclose() {\n\t\tif (this.handlers.close && this.handlers.close(this)) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.fileModel = null\n\t\t$('#richdocuments-header').remove()\n\t},\n\n\tasync saveAs(newName) {\n\t\tconst oldFile = this.getFileModel()\n\n\t\tif (this.handlers.saveAs && this.handlers.saveAs(this)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (newName) {\n\t\t\tthis.fileName = newName\n\t\t}\n\n\t\tconst node = await this.getFileNode(true)\n\n\t\tif (!node) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.changeFilesRoute(node.fileid)\n\n\t\tOCA?.Files?.Sidebar?.close()\n\n\t\tif (this.getFileList()) {\n\t\t\tconst newFileModel = oldFile.clone()\n\t\t\tnewFileModel.set('id', node.fileid)\n\t\t\tnewFileModel.set('name', newName)\n\t\t\tnewFileModel.set('mtime', Date.now())\n\t\t\tthis.getFileList()\n\t\t\t\t.add(newFileModel.toJSON())\n\n\t\t\tOC.Apps.hideAppSidebar()\n\t\t}\n\t},\n\n\tshare() {\n\t\tif (this.handlers.share && this.handlers.share(this)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (isPublicShare()) {\n\t\t\tconsole.error('[FilesAppIntegration] Sharing is not supported')\n\t\t\treturn\n\t\t}\n\n\t\tOCA?.Files?.Sidebar?.open(this.filePath + '/' + this.fileName)\n\t\tOCA?.Files?.Sidebar?.setActiveTab('sharing')\n\t},\n\n\trename(newName) {\n\t\tthis.updateFileInfo(newName, Date.now())\n\n\t\tthis.fileName = newName\n\n\t\tif (this.handlers.rename && this.handlers.rename(this)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (this.getFileList()) {\n\t\t\tOC.Apps.hideAppSidebar()\n\t\t}\n\t},\n\n\t/**\n\t * @param mimeTypeFilter\n\t * @param insertFileProc\n\t * @param insertHandler\n\t * @private\n\t */\n\tinsertFile_impl(mimeTypeFilter, insertFileProc, insertHandler) {\n\t\tif (isPublicShare()) {\n\t\t\tconsole.error('[FilesAppIntegration] insertFile is not supported')\n\t\t}\n\n\t\tconst insertFileFromPath = async (path) => {\n\t\t\tconst filename = path.substring(path.lastIndexOf('/') + 1)\n\t\t\tconst { data } = await axios.post(generateUrl('apps/richdocuments/assets'), { path })\n\t\t\tinsertFileProc(filename, data.url)\n\t\t}\n\n\t\tif (insertHandler && insertHandler(this, mimeTypeFilter, { insertFileFromPath })) {\n\t\t\treturn\n\t\t}\n\n\t\tgetFilePickerBuilder(t('richdocuments', 'Insert file from {name}', { name: OC.theme.name }))\n\t\t\t.setMimeTypeFilter(mimeTypeFilter)\n\t\t\t.setFilter((node) => {\n\t\t\t\tconst downloadShareAttribute = JSON.parse(node.attributes['share-attributes']).find((shareAttribute) => shareAttribute.key === 'download')\n\t\t\t\tconst downloadPermissions = downloadShareAttribute !== undefined ? (downloadShareAttribute.enabled || downloadShareAttribute.value) : true\n\t\t\t\treturn (node.permissions & OC.PERMISSION_READ) && downloadPermissions\n\t\t\t})\n\t\t\t.addButton({\n\t\t\t\tlabel: t('richdocuments', 'Insert file'),\n\t\t\t\tcallback: (files) => {\n\t\t\t\t\tif (files && files.length) {\n\t\t\t\t\t\tinsertFileFromPath(files[0].path)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t})\n\t\t\t.build()\n\t\t\t.pick()\n\t},\n\n\tinsertGraphic(insertFileProc) {\n\t\tthis.insertFile_impl(['image/png', 'image/gif', 'image/jpeg', 'image/svg'],\n\t\t\tinsertFileProc,\n\t\t\t(filesAppIntegration, mimeTypeFilter, { insertFileFromPath }) => { return this.handlers.insertGraphic && this.handlers.insertGraphic(filesAppIntegration, { insertFileFromPath }) })\n\t},\n\n\tinsertFile(mimeTypeFilter, insertFileProc) {\n\t\tthis.insertFile_impl(mimeTypeFilter, insertFileProc, this.handlers.insertFile)\n\t},\n\n\tgetFileList() {\n\t\tif (this.fileList) {\n\t\t\treturn this.fileList\n\t\t}\n\t\tif (OCA.Files && OCA.Files.App) {\n\t\t\treturn OCA.Files.App.fileList\n\t\t}\n\t\tif (OCA.Sharing && OCA.Sharing.PublicApp) {\n\t\t\treturn OCA.Sharing.PublicApp.fileList\n\t\t}\n\t\treturn null\n\t},\n\n\tgetFileModel() {\n\t\tif (this.fileModel) {\n\t\t\treturn this.fileModel\n\t\t}\n\t\tif (!this.getFileList() || !this.getFileList().getModelForFile || !this.getFileList()._updateDetailsView) {\n\t\t\treturn null\n\t\t}\n\t\ttry {\n\t\t\tthis.getFileList()._updateDetailsView(this.fileName, false)\n\n\t\t\tthis.fileModel = this.getFileList().getModelForFile(this.fileName)\n\n\t\t\tif (this.fileModel && this.fileModel.on) {\n\t\t\t\tthis.fileModel.on('change', () => {\n\t\t\t\t\tthis._addHeaderFileActions()\n\t\t\t\t})\n\t\t\t}\n\t\t} catch (e) {\n\t\t\treturn null\n\t\t}\n\n\t\treturn this.fileModel\n\t},\n\n\tsetViews(views) {\n\t\tthis.views = {}\n\t\tviews.forEach((view) => {\n\t\t\tthis.views[view.ViewId] = view\n\t\t})\n\t\tthis.renderAvatars()\n\t},\n\n\tfollowReset(event) {\n\t\tthis.sendPostMessage('Action_FollowUser', { Follow: false })\n\t\tthis.following = null\n\t\tthis.followingEditor = false\n\t\tthis.renderAvatars()\n\t},\n\tfollowCurrentEditor(event) {\n\t\tthis.sendPostMessage('Action_FollowUser', { Follow: true })\n\t\tthis.following = null\n\t\tthis.followingEditor = true\n\t\tthis.renderAvatars()\n\t},\n\tfollowView(view) {\n\t\tthis.sendPostMessage('Action_FollowUser', { ViewId: view.ViewId, Follow: true })\n\t\tthis.following = view.ViewId\n\t\tthis.followingEditor = false\n\t\tthis.renderAvatars()\n\t},\n\n\t_addHeaderFileActions() {\n\t\tconsole.debug('[FilesAppIntegration] Adding header file actions')\n\t\tOC.unregisterMenu($('#richdocuments-actions .icon-more'), $('#richdocuments-actions-menu'))\n\t\t$('#richdocuments-actions').remove()\n\t\tconst isInverted = Boolean(window?.OCA?.Theming?.inverted)\n\t\tconst actionsContainer = $('<div id=\"richdocuments-actions\"><div class=\"icon-collabora icon-more ' + (isInverted ? 'icon-black' : 'icon-white') + '\"></div><ul id=\"richdocuments-actions-menu\" class=\"popovermenu\"></ul></div>')\n\t\tconst actions = actionsContainer.find('#richdocuments-actions-menu').empty()\n\n\t\tconst getContext = () => ({\n\t\t\t$file: this.getFileList().$el ? this.getFileList().$el.find('[data-id=' + this.fileId + ']').first() : null,\n\t\t\tfileActions: this.getFileList().fileActions,\n\t\t\tfileList: this.getFileList(),\n\t\t\tfileInfoModel: this.getFileModel(),\n\t\t})\n\n\t\tconst isFavorite = function(fileInfo) {\n\t\t\treturn fileInfo.get('tags') && fileInfo.get('tags').indexOf(OC.TAG_FAVORITE) >= 0\n\t\t}\n\t\tconst $favorite = $('<li><a></a></li>').click((event) => {\n\t\t\t$favorite.find('a').removeClass('icon-starred').removeClass('icon-star-dark').addClass('icon-loading-small')\n\t\t\tif (this.handlers.actionFavorite && this.handlers.actionFavorite(this)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.getFileList().fileActions.triggerAction('Favorite', this.getFileModel(), this.getFileList())\n\t\t\tthis.getFileModel().trigger('change', this.getFileModel())\n\t\t})\n\t\tif (isFavorite(this.getFileModel())) {\n\t\t\t$favorite.find('a').text(t('files', 'Remove from favorites'))\n\t\t\t$favorite.find('a').addClass('icon-starred')\n\t\t} else {\n\t\t\t$favorite.find('a').text(t('files', 'Add to favorites'))\n\t\t\t$favorite.find('a').addClass('icon-star-dark')\n\t\t}\n\n\t\tconst $info = $('<li><a class=\"icon-info\"></a></li>').click(() => {\n\t\t\tif (this.handlers.actionDetails && this.handlers.actionDetails(this)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.getFileList().fileActions.actions.all.Details.action(this.fileName, getContext())\n\t\t\tOC.hideMenus()\n\t\t})\n\t\t$info.find('a').text(t('files', 'Details'))\n\t\tconst $download = $('<li><a class=\"icon-download\">Download</a></li>').click(() => {\n\t\t\tif (this.handlers.actionDownload && this.handlers.actionDownload(this)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.getFileList().fileActions.actions.all.Download.action(this.fileName, getContext())\n\t\t\tOC.hideMenus()\n\t\t})\n\t\t$download.find('a').text(t('files', 'Download'))\n\t\tactions.append($favorite).append($info).append($download)\n\t\t$('#richdocuments-header').append(actionsContainer)\n\t\tOC.registerMenu($('#richdocuments-actions .icon-more'), $('#richdocuments-actions-menu'), false, true)\n\t},\n\n\t/**\n\t * @param {View} view the view\n\t * @return {$|HTMLElement}\n\t * @private\n\t */\n\t_userEntry(view) {\n\t\tconst entry = $('<li></li>')\n\t\tentry.append(this._avatarForView(view))\n\n\t\tconst label = $('<div class=\"label\"></div>')\n\t\tlabel.text(view.UserName)\n\t\tif (view.ReadOnly === '1') {\n\t\t\tlabel.text(view.UserName + ' ' + t('richdocuments', '(read only)'))\n\n\t\t}\n\t\tlabel.click((event) => {\n\t\t\tevent.stopPropagation()\n\t\t\tthis.followView(view)\n\t\t})\n\t\tif (this.following === view.ViewId) {\n\t\t\t$('#editors-menu').find('li').removeClass('active')\n\t\t\tentry.addClass('active')\n\t\t}\n\t\tentry.append(label)\n\n\t\tconst isFileOwner = !isPublicShare() && this.getFileModel() && typeof this.getFileModel().get('shareOwner') === 'undefined'\n\t\tconst canEdit = this.getFileModel() && !!(this.getFileModel().get('permissions') & OC.PERMISSION_UPDATE)\n\t\tif (isFileOwner && canEdit && !view.IsCurrentView) {\n\t\t\tconst removeButton = $('<div class=\"icon-close\" title=\"' + t('richdocuments', 'Remove user') + '\"/>')\n\t\t\tremoveButton.click(() => {\n\t\t\t\tthis.sendPostMessage('Action_RemoveView', { ViewId: view.ViewId })\n\t\t\t})\n\t\t\tentry.append(removeButton)\n\t\t}\n\t\treturn entry\n\t},\n\n\t/**\n\t * @param {View} view the view\n\t * @return {$|HTMLElement}\n\t * @private\n\t */\n\t_avatarForView(view) {\n\t\tconst userId = (view.UserId === '') ? view.UserName : view.UserId\n\t\tconst avatarContainer = $('<div class=\"richdocuments-avatar\"><div class=\"avatar\" title=\"' + view.UserName + '\" data-user=\"' + userId + '\"></div></div>')\n\t\tconst avatar = avatarContainer.find('.avatar')\n\n\t\tavatar.css({\n\t\t\tborderColor: '#' + ('000000' + Number(view.Color).toString(16)).slice(-6),\n\t\t\tborderWidth: '2px',\n\t\t\tborderStyle: 'solid',\n\t\t})\n\t\tif (view.ReadOnly === '1') {\n\t\t\tavatarContainer.addClass('read-only')\n\t\t\t$(avatar).attr('title', view.UserName + ' ' + t('richdocuments', '(read only)'))\n\t\t} else {\n\t\t\t$(avatar).attr('title', view.UserName)\n\t\t}\n\n\t\t$(avatar).avatar(userId, 32, undefined, true, undefined, view.UserName)\n\t\treturn avatarContainer\n\t},\n\n\trenderAvatars() {\n\t\tconst avatardiv = $('#header .header-right #richdocuments-avatars')\n\t\tavatardiv.empty()\n\t\tconst popover = $('<div id=\"editors-menu\" class=\"popovermenu\"><ul></ul></div>')\n\n\t\tconst users = []\n\t\t// Add new avatars\n\t\tlet i = 0\n\t\tfor (const viewId in this.views) {\n\t\t\t/**\n\t\t\t * @type {View}\n\t\t\t */\n\t\t\tconst view = this.views[viewId]\n\t\t\tview.UserName = view.UserName !== '' ? view.UserName : t('richdocuments', 'Guest')\n\t\t\tpopover.find('ul').append(this._userEntry(view))\n\n\t\t\tif (view.UserId === getCurrentUser()?.uid) {\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tif (view.UserId !== '' && users.indexOf(view.UserId) > -1) {\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tusers.push(view.UserId)\n\t\t\tif (i++ < 4) {\n\t\t\t\tavatardiv.append(this._avatarForView(view))\n\t\t\t}\n\t\t}\n\t\tconst followCurrentEditor = $('<li><input type=\"checkbox\" class=\"checkbox\" /><label class=\"label\">' + t('richdocuments', 'Follow current editor') + '</label></li>')\n\t\tfollowCurrentEditor.find('label').click((event) => {\n\t\t\tevent.stopPropagation()\n\t\t\tif (this.followingEditor) {\n\t\t\t\tthis.followReset()\n\t\t\t} else {\n\t\t\t\tthis.followCurrentEditor()\n\t\t\t}\n\t\t})\n\t\tfollowCurrentEditor.find('.checkbox').prop('checked', this.followingEditor)\n\t\tpopover.find('ul').append(followCurrentEditor)\n\t\tavatardiv.append(popover)\n\t},\n\n\tshowRevHistory() {\n\t\tif (this.handlers.showRevHistory && this.handlers.showRevHistory(this)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (isPublicShare() || !OCA?.Files?.Sidebar) {\n\t\t\tconsole.error('[FilesAppIntegration] Versions are not supported')\n\t\t\treturn\n\t\t}\n\t\tOCA?.Files?.Sidebar?.open(this.filePath + '/' + this.fileName)\n\t\tOCA?.Files?.Sidebar?.setActiveTab('version_vue')\n\t},\n\n\t/**\n\t * Called when a new file creation has been triggered from collabora\n\t *\n\t * Ask for a new filename and open the files app in a new tab\n\t * the parameters richdocuments_create and richdocuments_filename are\n\t * parsed by viewer.js and open a template picker in the new tab with\n\t * FilesAppIntegration.preloadCreate\n\t *\n\t * @param {string} type the file type\n\t */\n\tcreateNewFile(type) {\n\t\tif (this.handlers.createNewFile && this.handlers.createNewFile(this, { type })) {\n\t\t\treturn\n\t\t}\n\n\t\tspawnDialog(\n\t\t\tSaveAs,\n\t\t\t{\n\t\t\t\tname: t('richdocuments', 'New file'),\n\t\t\t\tdescription: t('richdocuments', 'Please enter the filename for the new file'),\n\t\t\t\tbuttonText: t('richdocuments', 'Create'),\n\t\t\t},\n\t\t\t(value) => {\n\t\t\t\tif (value) {\n\t\t\t\t\tif (type === 'text') {\n\t\t\t\t\t\ttype = 'document'\n\t\t\t\t\t}\n\t\t\t\t\tconst url = generateUrl('/apps/files/?dir=' + getCurrentDirectory() + '&richdocuments_create=' + type + '&richdocuments_filename=' + encodeURI(value))\n\t\t\t\t\twindow.open(url, '_blank')\n\t\t\t\t}\n\t\t\t},\n\t\t)\n\t},\n\n\tloggingContext() {\n\t\treturn {\n\t\t\tcurrentUser: getCurrentUser()?.uid,\n\t\t\tfile: {\n\t\t\t\tsharingToken: document.getElementById('sharingToken')?.value,\n\t\t\t\tfileId: this.fileId,\n\t\t\t\tfilePath: (this.filePath ?? '') + '/' + this.fileName,\n\t\t\t},\n\t\t}\n\t},\n\n\tasync updateFileInfo(name, mtime) {\n\t\tconst node = await this.getFileNode()\n\n\t\tif (node) {\n\t\t\tif (name) {\n\t\t\t\tnode.rename(name)\n\t\t\t\temit('files:node:renamed', this.source)\n\t\t\t}\n\t\t\tif (mtime) {\n\t\t\t\tnode._data.mtime = new Date(mtime)\n\t\t\t}\n\n\t\t\temit('files:node:updated', node)\n\t\t}\n\n\t\t// FIXME: Remove once all files app is moved to vue\n\t\tconst fileInfo = this.getFileModel()\n\t\tif (!fileInfo) {\n\t\t\treturn\n\t\t}\n\n\t\tif (name) {\n\t\t\tfileInfo.set('name', name)\n\t\t}\n\n\t\tif (mtime) {\n\t\t\tfileInfo.set('mtime', mtime)\n\t\t}\n\t\tfileInfo.trigger('change', this.getFileModel())\n\t},\n\n\tasync getFileNode(forceFetch = false) {\n\t\tif (isPublicShare()) {\n\t\t\treturn\n\t\t}\n\n\t\tif (this.fileNode !== undefined && !forceFetch) {\n\t\t\treturn this.fileNode\n\t\t}\n\n\t\ttry {\n\t\t\tconst path = this.filePath + '/' + this.fileName\n\t\t\tconst client = davGetClient()\n\t\t\tconst results = await client.getDirectoryContents(`${davRootPath}${path}`, {\n\t\t\t\tdetails: true,\n\t\t\t\tdata: davGetDefaultPropfind(),\n\t\t\t})\n\t\t\tconst nodes = results.data.map((result) => davResultToNode(result))\n\n\t\t\tthis.fileNode = nodes[0] ?? null\n\t\t} catch (e) {\n\t\t\tconsole.error('Failed to fetch file metadata from webdav', e)\n\t\t\tthis.fileNode = null\n\t\t}\n\n\t\treturn this.fileNode\n\t},\n\n\tchangeFilesRoute(fileId) {\n\t\tOCP?.Files?.Router?.goToRoute(\n\t\t\tOCP.Files.Router.name,\n\t\t\t{ ...OCP.Files.Router.params, fileid: fileId },\n\t\t\tOCP.Files.Router.query,\n\t\t\ttrue,\n\t\t)\n\t},\n\n}\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\n/**\n * @return {string}\n */\nexport const getCurrentDirectory = () => {\n\tif (OCA.Sharing?.PublicApp) {\n\t\treturn OCA.Sharing.PublicApp.fileList.getCurrentDirectory()\n\t}\n\n\treturn OCA.Files.App.currentFileList.getCurrentDirectory()\n}\n","/**\n * SPDX-FileCopyrightText: 2021 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nimport axios from '@nextcloud/axios'\nimport { getCapabilities } from './../services/capabilities.ts'\n\nexport const LOADING_ERROR = {\n\tCOLLABORA_UNCONFIGURED: 1,\n\tPROXY_FAILED: 2,\n}\n\nexport const isCollaboraConfigured = () => {\n\tconst collaboraCapabilities = getCapabilities()?.collabora\n\treturn isBuiltinCodeServerUsed() || collaboraCapabilities.length !== 0\n}\n\nexport const isBuiltinCodeServerUsed = () => {\n\treturn getCapabilities()?.config?.wopi_url?.indexOf('proxy.php') !== -1\n}\n\nexport const checkCollaboraConfiguration = async () => {\n\tconst wopiUrl = getCapabilities()?.config?.wopi_url\n\tif (!wopiUrl) {\n\t\tthrow Error(LOADING_ERROR.COLLABORA_UNCONFIGURED)\n\t}\n}\n\nlet proxyStatusCheckRetry = 0\nexport const checkProxyStatus = async (_resolve, _reject) => {\n\tconst wopiUrl = getCapabilities()?.config?.wopi_url\n\tif (wopiUrl.indexOf('proxy.php') === -1) {\n\t\treturn true\n\t}\n\n\tconst url = wopiUrl.slice(0, wopiUrl.indexOf('proxy.php') + 'proxy.php'.length)\n\tconst proxyStatusUrl = url + '?status'\n\n\tconst checkProxyStatusCallback = async (resolve, reject) => {\n\t\tconst result = await axios.get(proxyStatusUrl)\n\t\tif (!result || !result?.data?.status) {\n\t\t\treject('Failed to contact status endpoint')\n\t\t}\n\n\t\tif (result.data.status === 'OK') {\n\t\t\treturn resolve(true)\n\t\t}\n\t\tif (result.data.status === 'error') {\n\t\t\treturn reject(t('richdocuments', 'Built-in CODE server failed to start'))\n\t\t}\n\n\t\tif (proxyStatusCheckRetry < 3 && (result.data.status === 'starting' || result.data.status === 'stopped' || result.data.status === 'restarting')) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tproxyStatusCheckRetry++\n\t\t\t\tcheckProxyStatus(resolve, reject)\n\t\t\t})\n\t\t} else {\n\t\t\treject('Maximum retries reached')\n\t\t}\n\n\t}\n\n\tif (_reject && _resolve) {\n\t\treturn checkProxyStatusCallback(_reject, _resolve)\n\t} else {\n\t\treturn new Promise(checkProxyStatusCallback)\n\t}\n}\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nlet scrollLock = false\nlet intervalHandler\n\nconst isiOS = [\n\t'iPad Simulator',\n\t'iPhone Simulator',\n\t'iPod Simulator',\n\t'iPad',\n\t'iPhone',\n\t'iPod',\n].includes(navigator.platform) || (navigator.userAgent.includes('Mac') && navigator.maxTouchPoints > 1)\n\n// Workaround for Safari automatically scrolling the body when the hidden input is focussed\nconst handleScrollReset = () => {\n\tdocument.documentElement.scrollTop = 0\n\tdocument.scrollingElement.scrollTop = 0\n}\n\n// Workaround for Safari to resize the iframe to the proper height\n// as 100vh is not the proper viewport height there\nconst handleResize = () => {\n\tconst expectedHeight = window.visualViewport.height ?? document.documentElement.clientHeight\n\tconst frame = document.getElementById('richdocumentsframe')\n\tif (frame) {\n\t\tframe.style.maxHeight = expectedHeight + 'px'\n\t}\n\tconst viewer = document.querySelector('.office-viewer')\n\tif (viewer) {\n\t\tviewer.style.height = expectedHeight + 'px'\n\t}\n}\n\nconst fixThemAll = () => {\n\tif (!isiOS) {\n\t\treturn\n\t}\n\tif (!scrollLock) {\n\t\treturn\n\t}\n\thandleScrollReset()\n\thandleResize()\n}\n\nconst preventDefault = (e) => e.preventDefault()\n\nexport const enableScrollLock = () => {\n\tif (scrollLock || !isiOS) {\n\t\treturn\n\t}\n\n\tscrollLock = true\n\n\twindow?.visualViewport?.addEventListener('resize', fixThemAll)\n\t\t|| window.addEventListener('resize', fixThemAll)\n\n\tdocument.addEventListener('touchstart', preventDefault, false)\n\tdocument.addEventListener('touchmove', preventDefault, false)\n\n\tintervalHandler = setInterval(fixThemAll, 200)\n}\n\nexport const disableScrollLock = () => {\n\tif (!scrollLock || !isiOS) {\n\t\treturn\n\t}\n\n\tscrollLock = false\n\n\twindow?.visualViewport?.removeEventListener('resize', fixThemAll)\n\t\t|| window.removeEventListener('resize', fixThemAll)\n\n\tdocument.removeEventListener('touchstart', preventDefault, false)\n\tdocument.removeEventListener('touchmove', preventDefault, false)\n\n\tclearInterval(intervalHandler)\n}\n","/**\n * SPDX-FileCopyrightText: 2021 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { loadState } from '@nextcloud/initial-state'\n\nconst getUIDefaults = () => {\n\tconst defaults = loadState('richdocuments', 'uiDefaults', {})\n\tconst statusBar = 'true'\n\tconst textRuler = 'false'\n\tconst sidebar = 'false'\n\tconst saveAsMode = 'group'\n\tconst uiMode = defaults.UIMode ?? 'notebookbar'\n\n\tlet uiDefaults = 'TextRuler=' + textRuler + ';'\n\tuiDefaults += 'TextSidebar=' + sidebar + ';TextStatusbar=' + statusBar + ';'\n\tuiDefaults += 'PresentationSidebar=' + sidebar + ';PresentationStatusbar=' + statusBar + ';'\n\tuiDefaults += 'SpreadsheetSidebar=' + sidebar + ';SpreadsheetStatusbar=' + statusBar + ';'\n\tuiDefaults += 'UIMode=' + uiMode + ';'\n\tuiDefaults += 'UITheme=' + getUITheme() + ';'\n\tuiDefaults += 'SaveAsMode=' + saveAsMode + ';'\n\treturn uiDefaults\n}\n\nconst getCollaboraTheme = () => {\n\treturn loadState('richdocuments', 'theme', 'nextcloud')\n}\n\nconst getUITheme = () => {\n\tconst systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches\n\tlet dataset = {}\n\ttry {\n\t\tdataset = (document.body.dataset.themes ? document.body.dataset : parent?.document.body.dataset) ?? {}\n\t} catch (e) {\n\t\t// Ignore errors here in case we run into cross-origin domains\n\t}\n\tconst nextcloudDarkMode = dataset?.themeDark === '' || dataset?.themeDarkHighcontrast === ''\n\tconst matchedDarkMode = (!dataset?.themes || dataset?.themes === '' || dataset?.themeDefault === '') ? systemDarkMode : nextcloudDarkMode\n\treturn matchedDarkMode ? 'dark' : 'light'\n}\n\nconst createDataThemeDiv = (elementType, theme) => {\n\tconst element = document.createElement(elementType)\n\telement.setAttribute('id', 'cool-var-source-' + theme)\n\telement.setAttribute('data-theme-' + theme, '')\n\tdocument.body.appendChild(element)\n\treturn element\n}\n\nconst generateCSSVarTokens = (isSettingIframe = false) => {\n\t/* NC versus COOL */\n\tconst cssVarMap = {\n\t\t'--color-primary-element-text': '--co-primary-text:--co-settings-btn-primary-text',\n\t\t'--color-primary-element': '--co-primary-element:--co-text-accent:--co-settings-btn-primary',\n\t\t'--color-primary-element-light': '--co-primary-light:--co-primary-element-light:--co-settings-btn-light',\n\t\t'--color-error': '--co-color-error',\n\t\t'--color-warning': '--co-color-warning',\n\t\t'--color-success': '--co-color-success',\n\t\t'--border-radius': '--co-border-radius',\n\t\t'--border-radius-large': '--co-border-radius-large',\n\t\t'--color-loading-light': '--co-loading-light',\n\t\t'--color-loading-dark': '--co-loading-dark',\n\t\t'--color-box-shadow': '--co-box-shadow',\n\t\t'--color-border': '--co-border:--co-settings-border',\n\t\t'--color-border-dark': '--co-border-dark:--co--settings-border-contrast',\n\t\t'--border-radius-pill': '--co-border-radius-pill',\n\t\t'--color-primary-element-light-text': '--co-settings-btn-light-text',\n\t\t'--color-main-text': '--co-settings-text',\n\t\t'--color-text-maxcontrast': '--co-settings-text-maxcontrast',\n\t\t'--color-main-background': '--co-settings-background',\n\t\t'--color-background-hover': '--co-settings-background-hover',\n\t}\n\tlet str = ''\n\tconst lightElement = createDataThemeDiv('div', 'light')\n\tconst darkElement = createDataThemeDiv('div', 'dark')\n\tlet selectedElement = lightElement\n\n\t// Note: To style the iframe properly, we send appropriate CSS variables based on the current theme.\n\t// For example, if the current theme is dark, we send values corresponding to the dark theme.\n\tif (isSettingIframe) {\n\t\tselectedElement = getUITheme() === 'dark' ? darkElement : lightElement\n\t}\n\ttry {\n\t\tfor (const cssVarKey in cssVarMap) {\n\t\t\tlet cStyle = window.getComputedStyle(selectedElement).getPropertyValue(cssVarKey)\n\t\t\tif (!cStyle) {\n\t\t\t\t// try suffix -dark instead\n\t\t\t\tcStyle = window.getComputedStyle(selectedElement).getPropertyValue(cssVarKey + '-dark')\n\t\t\t}\n\t\t\tif (!cStyle) continue // skip if it is not set\n\t\t\tconst varNames = cssVarMap[cssVarKey].split(':')\n\t\t\tfor (let i = 0; i < varNames.length; ++i) {\n\t\t\t\tstr += varNames[i] + '=' + cStyle.trim() + ';'\n\t\t\t}\n\t\t}\n\t} catch (e) {\n\t\t// Skip extracting css vars if we cannot access parent\n\t}\n\n\tif (isSettingIframe) {\n\t\tlightElement.remove()\n\t\tdarkElement.remove()\n\t\treturn str.replace(/[\"']/g, '\\\\\\'')\n\t}\n\n\tconst handover = [\n\t\t'--color-main-background',\n\t\t'--color-main-background-rgb',\n\t\t'--color-main-background-translucent',\n\t\t'--color-main-background-blur',\n\t\t'--color-main-text',\n\t\t'--color-text-maxcontrast',\n\t\t'--color-box-shadow',\n\t\t'--color-box-shadow-rgb',\n\t\t'--default-font-size',\n\t\t'--border-radius',\n\t\t'--border-radius-large',\n\t\t'--border-radius-rounded',\n\t\t'--border-radius-pill',\n\t\t'--default-clickable-area',\n\t\t'--default-line-height',\n\t\t'--default-grid-baseline',\n\t\t'--color-primary',\n\t\t'--color-primary-default',\n\t\t'--color-primary-text',\n\t\t'--color-primary-hover',\n\t\t'--color-primary-light',\n\t\t'--color-primary-light-text',\n\t\t'--color-primary-light-hover',\n\t\t'--color-primary-element',\n\t\t'--color-primary-element-hover',\n\t\t'--color-primary-element-text',\n\t\t'--color-primary-element-light',\n\t\t'--color-primary-element-light-hover',\n\t\t'--color-primary-element-light-text',\n\t\t'--color-primary-element-text-dark',\n\t\t'--primary-invert-if-bright',\n\t\t'--background-invert-if-bright',\n\t\t'--background-invert-if-dark',\n\t]\n\tfor (const i in handover) {\n\t\tconst varName = handover[i]\n\n\t\tconst lightStyle = window.getComputedStyle(lightElement).getPropertyValue(varName)\n\t\tconst darkStyle = window.getComputedStyle(darkElement).getPropertyValue(varName)\n\n\t\tif (lightStyle) str += varName.replace('--', '--nc-light-') + '=' + lightStyle.trim() + ';'\n\t\tif (darkStyle) str += varName.replace('--', '--nc-dark-') + '=' + darkStyle.trim() + ';'\n\n\t\t// Workaround for now as we need primary-invert-if-dark which is not available on server yet\n\t\tif (varName === '--primary-invert-if-bright') {\n\t\t\tif (lightStyle.trim() === 'no') {\n\t\t\t\tstr += '--nc-light-primary-invert-if-dark=invert(1);'\n\t\t\t\tstr += '--nc-dark-primary-invert-if-dark=invert(1);'\n\t\t\t} else {\n\t\t\t\tstr += '--nc-light-primary-invert-if-dark=no;'\n\t\t\t\tstr += '--nc-dark-primary-invert-if-dark=no;'\n\t\t\t}\n\t\t}\n\t}\n\t// cleanup theme elements after extracting property values\n\tlightElement.remove()\n\tdarkElement.remove()\n\n\tconst customLogo = loadState('richdocuments', 'theming-customLogo', false)\n\tif (customLogo) {\n\t\tstr += `--nc-custom-logo=${encodeURIComponent(customLogo)};`\n\t}\n\n\tconst rootEl = document.querySelector(':root')\n\n\tconst logoBgColor = window.getComputedStyle(rootEl).getPropertyValue('--nc-logo-background')\n\tstr += '--nc-logo-background=' + (logoBgColor === '' ? 'transparent' : logoBgColor) + ';'\n\n\tconst logoDisplay = window.getComputedStyle(rootEl).getPropertyValue('--nc-logo-display')\n\tif (logoDisplay) {\n\t\tstr += `--nc-logo-display=${logoDisplay};`\n\t}\n\n\treturn str.replace(/[\"']/g, '\\\\\\'')\n}\n\nexport {\n\tgetUIDefaults,\n\tgetCollaboraTheme,\n\tgenerateCSSVarTokens,\n\tgetUITheme,\n}\n","/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport axios from '@nextcloud/axios'\nimport { loadState } from '@nextcloud/initial-state'\nimport { generateUrl } from '@nextcloud/router'\nimport { getCurrentUser } from '@nextcloud/auth'\n\nconst config = loadState('core', 'config', {})\n\nconst getInterval = () => {\n\tconst interval = config.session_lifetime ? Math.floor(config.session_lifetime / 2) : 900\n\treturn Math.min(24 * 3600, Math.max(60, interval))\n}\n\nexport default {\n\n\tdata() {\n\t\treturn {\n\t\t\tautoLogoutInterval: null,\n\t\t\tautoLogoutRegistered: false,\n\t\t}\n\t},\n\n\tmounted() {\n\t\tif (!getCurrentUser()) {\n\t\t\treturn\n\t\t}\n\n\t\tif (config?.auto_logout || !config?.session_keepalive) {\n\t\t\tthis.autoLogoutInterval = setInterval(this.registerCheck, 10000)\n\t\t}\n\t},\n\n\tbeforeDestroy() {\n\t\tif (this.autoLogoutInterval) {\n\t\t\tclearInterval(this.autoLogoutInterval)\n\t\t}\n\t},\n\n\tmethods: {\n\t\textendAutoLogout() {\n\t\t\tconst oldValue = localStorage.getItem('lastActive')\n\t\t\tconst newValue = Date.now().toString()\n\t\t\tlocalStorage.setItem('lastActive', newValue)\n\t\t\tconst event = new StorageEvent('storage', {\n\t\t\t\tkey: 'lastActive',\n\t\t\t\toldValue,\n\t\t\t\tnewValue,\n\t\t\t})\n\t\t\twindow.dispatchEvent(event)\n\t\t},\n\t\tregisterCheck() {\n\t\t\tif (!this.autoLogoutRegistered && this.postMessage) {\n\t\t\t\tthis.postMessage.registerPostMessageHandler(this.handleGetUserStateResponse)\n\t\t\t\tthis.autoLogoutRegistered = true\n\t\t\t}\n\t\t\tif (this.autoLogoutRegistered && this.postMessage) {\n\t\t\t\tthis.sendPostMessage('Get_User_State')\n\t\t\t}\n\t\t},\n\t\thandleGetUserStateResponse({ parsed: { msgId, args } }) {\n\t\t\tif (msgId !== 'Get_User_State_Resp') {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst elapsed = args.Elapsed\n\t\t\tconst lastActive = Number(localStorage.getItem('lastActive'))\n\t\t\tconst timeSinceLastActive = Date.now() - lastActive\n\t\t\tconst recheckAfter = (getInterval() * 1000)\n\n\t\t\tif (!config.session_keepalive && timeSinceLastActive > recheckAfter) {\n\t\t\t\taxios.get(generateUrl('/apps/richdocuments/heartbeat'))\n\t\t\t}\n\n\t\t\tif (elapsed < 30) {\n\t\t\t\tconsole.debug('[richdocuments] Extending auto logout timeout, office idle since ' + elapsed, timeSinceLastActive, recheckAfter, timeSinceLastActive > recheckAfter)\n\t\t\t\tthis.extendAutoLogout()\n\t\t\t}\n\t\t},\n\t},\n\n}\n","<!--\n  - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<NcModal>\n\t\t<div class=\"confirmation-dialog\">\n\t\t\t<h1>{{ name }}</h1>\n\t\t\t<p>{{ description }}</p>\n\t\t\t<div class=\"confirmation-dialog--buttons\">\n\t\t\t\t<NcButton type=\"secondary\"\n\t\t\t\t\t@click=\"() => close(false)\">\n\t\t\t\t\t{{ cancelButtonText }}\n\t\t\t\t</NcButton>\n\t\t\t\t<NcButton type=\"primary\"\n\t\t\t\t\t@click=\"() => close(true)\">\n\t\t\t\t\t{{ confirmButtonText }}\n\t\t\t\t</NcButton>\n\t\t\t</div>\n\t\t</div>\n\t</NcModal>\n</template>\n<script>\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\nimport NcModal from '@nextcloud/vue/dist/Components/NcModal.js'\nimport { translate as t } from '@nextcloud/l10n'\n\nexport default {\n\tname: 'Confirmation',\n\tcomponents: {\n\t\tNcButton,\n\t\tNcModal,\n\t},\n\tprops: {\n\t\tname: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tconfirmButtonText: {\n\t\t\ttype: String,\n\t\t\tdefault: t('richdocuments', 'Confirm'),\n\t\t},\n\t\tcancelButtonText: {\n\t\t\ttype: String,\n\t\t\tdefault: t('richdocuments', 'Cancel'),\n\t\t},\n\t},\n\temits: ['close'],\n\tmethods: {\n\t\tt,\n\t\tclose(result) {\n\t\t\tthis.$emit('close', result)\n\t\t},\n\t},\n}\n</script>\n<style lang=\"scss\" scoped>\n.confirmation-dialog {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n    margin: 24px;\n    h1 {\n        font-size: 120%;\n        font-weight: bold;\n        margin-bottom: 12px;\n    }\n\n    &--buttons {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        justify-content: space-between;\n        width: 100%;\n        margin-top: 24px;\n    }\n}\n</style>\n","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Confirmation.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Confirmation.vue?vue&type=script&lang=js\"","\n      import API from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Confirmation.vue?vue&type=style&index=0&id=59370936&prod&lang=scss&scoped=true\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Confirmation.vue?vue&type=style&index=0&id=59370936&prod&lang=scss&scoped=true\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render, staticRenderFns } from \"./Confirmation.vue?vue&type=template&id=59370936&scoped=true\"\nimport script from \"./Confirmation.vue?vue&type=script&lang=js\"\nexport * from \"./Confirmation.vue?vue&type=script&lang=js\"\nimport style0 from \"./Confirmation.vue?vue&type=style&index=0&id=59370936&prod&lang=scss&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"59370936\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('NcModal',[_c('div',{staticClass:\"confirmation-dialog\"},[_c('h1',[_vm._v(_vm._s(_vm.name))]),_vm._v(\" \"),_c('p',[_vm._v(_vm._s(_vm.description))]),_vm._v(\" \"),_c('div',{staticClass:\"confirmation-dialog--buttons\"},[_c('NcButton',{attrs:{\"type\":\"secondary\"},on:{\"click\":() => _vm.close(false)}},[_vm._v(\"\\n\\t\\t\\t\\t\"+_vm._s(_vm.cancelButtonText)+\"\\n\\t\\t\\t\")]),_vm._v(\" \"),_c('NcButton',{attrs:{\"type\":\"primary\"},on:{\"click\":() => _vm.close(true)}},[_vm._v(\"\\n\\t\\t\\t\\t\"+_vm._s(_vm.confirmButtonText)+\"\\n\\t\\t\\t\")])],1)])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { getCurrentUser } from '@nextcloud/auth'\nimport axios from '@nextcloud/axios'\nimport { spawnDialog } from '@nextcloud/dialogs'\nimport { encodePath } from '@nextcloud/paths'\nimport { generateOcsUrl } from '@nextcloud/router'\nimport { getNextcloudUrl } from '../helpers/url.js'\nimport Confirmation from '../components/Modal/Confirmation.vue'\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\topeningLocally: false,\n\t\t}\n\t},\n\tmethods: {\n\t\tstartOpenLocalProcess() {\n\t\t\tthis.showOpenLocalConfirmation()\n\t\t},\n\n\t\tshowOpenLocalConfirmation() {\n\t\t\tspawnDialog(\n\t\t\t\tConfirmation,\n\t\t\t\t{\n\t\t\t\t\tname: t('richdocuments', 'Open file locally'),\n\t\t\t\t\tdescription: t('richdocuments', 'When opening a file locally, the document will close for all users currently viewing the document.'),\n\t\t\t\t\tconfirmButtonText: t('richdocuments', 'Open locally'),\n\t\t\t\t\tcancelButtonText: t('richdocuments', 'Continue editing online'),\n\t\t\t\t},\n\t\t\t\t(decision) => {\n\t\t\t\t\tif (!decision) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tthis.openingLocally = true\n\t\t\t\t\tthis.postMessage.registerPostMessageHandler(this.handleCloseSession)\n\t\t\t\t\tthis.sendPostMessage('Action_Save', {\n\t\t\t\t\t\tDontTerminateEdit: false,\n\t\t\t\t\t\tDontSaveIfUnmodified: false,\n\t\t\t\t\t\tNotify: false,\n\t\t\t\t\t})\n\t\t\t\t\tthis.sendPostMessage('Close_Session')\n\t\t\t\t},\n\t\t\t)\n\t\t},\n\n\t\thandleCloseSession() {\n\t\t\tthis.postMessage.unregisterPostMessageHandler(this.handleCloseSession)\n\t\t\tthis.openLocally()\n\t\t},\n\n\t\tshowOpenLocalFinished() {\n\t\t\tconst fileName = this.filename\n\t\t\tspawnDialog(\n\t\t\t\tConfirmation,\n\t\t\t\t{\n\t\t\t\t\tname: t('richdocuments', 'Open file locally'),\n\t\t\t\t\tdescription: t('richdocuments', 'The file should now open locally. If you don\\'t see this happening, make sure that the desktop client is installed on your system.'),\n\t\t\t\t\tconfirmButtonText: t('richdocuments', 'Retry to open locally'),\n\t\t\t\t\tcancelButtonText: t('richdocuments', 'Continue editing online'),\n\t\t\t\t},\n\t\t\t\t(decision) => {\n\t\t\t\t\tif (!decision) {\n\t\t\t\t\t\twindow.OCA.Viewer.open({ path: fileName })\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tthis.openingLocally = true\n\t\t\t\t\tthis.openLocally()\n\t\t\t\t},\n\t\t\t)\n\t\t},\n\n\t\tunlockFile() {\n\t\t\treturn axios.post(generateOcsUrl('apps/richdocuments/api/v1/local'), { fileId: this.fileid })\n\t\t},\n\n\t\topenLocally() {\n\t\t\tif (this.openingLocally) {\n\t\t\t\taxios.post(\n\t\t\t\t\tgenerateOcsUrl('apps/files/api/v1/openlocaleditor'),\n\t\t\t\t\t{ path: this.filename },\n\t\t\t\t).then((result) => {\n\t\t\t\t\tconst url = 'nc://open/'\n\t\t\t\t\t\t+ getCurrentUser()?.uid + '@' + getNextcloudUrl()\n\t\t\t\t\t\t+ encodePath(this.filename)\n\t\t\t\t\t\t+ '?token=' + result.data.ocs.data.token\n\n\t\t\t\t\tthis.showOpenLocalFinished()\n\t\t\t\t\t// Firefox may cancel requests that the files app could send when updating the file meta data\n\t\t\t\t\t// so we need to wait a bit before closing the viewer\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.openingLocally = false\n\t\t\t\t\t\tthis.close()\n\t\t\t\t\t}, 1000)\n\t\t\t\t\twindow.open(url, '_self')\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { generateOcsUrl } from '@nextcloud/router'\nimport axios from '@nextcloud/axios'\nimport { getLinkWithPicker } from '@nextcloud/vue/dist/Components/NcRichText.js'\n\n// FIXME: Migrate to vue component\nexport default {\n\tmethods: {\n\t\tasync pickLink() {\n\t\t\ttry {\n\t\t\t\tif (this.showLinkPicker) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.showLinkPicker = true\n\t\t\t\tconst link = await getLinkWithPicker(null, true)\n\t\t\t\ttry {\n\t\t\t\t\tconst url = new URL(link)\n\t\t\t\t\tif (url.protocol === 'http:' || url.protocol === 'https:') {\n\t\t\t\t\t\tthis.sendPostMessage('Action_InsertLink', { url: link })\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.debug('error when parsing the link picker result')\n\t\t\t\t}\n\t\t\t\tthis.sendPostMessage('Action_Paste', { Mimetype: 'text/plain', Data: link })\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Link picker promise rejected :', e)\n\t\t\t} finally {\n\t\t\t\tthis.showLinkPicker = false\n\t\t\t}\n\t\t},\n\t\tasync resolveLink(url) {\n\t\t\ttry {\n\t\t\t\tconst result = await axios.get(generateOcsUrl('references/resolve', 2), {\n\t\t\t\t\tparams: {\n\t\t\t\t\t\treference: url,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tconst resolvedLink = result.data.ocs.data.references[url]\n\t\t\t\tconst title = resolvedLink?.openGraphObject?.name\n\t\t\t\tconst thumbnailUrl = resolvedLink?.openGraphObject?.thumb\n\t\t\t\tif (thumbnailUrl) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst imageResponse = await axios.get(thumbnailUrl, { responseType: 'blob' })\n\t\t\t\t\t\tif (imageResponse?.status === 200 && imageResponse?.data) {\n\t\t\t\t\t\t\tconst reader = new FileReader()\n\t\t\t\t\t\t\treader.addEventListener('loadend', (e) => {\n\t\t\t\t\t\t\t\tconst b64Image = e.target.result\n\t\t\t\t\t\t\t\tthis.sendPostMessage('Action_GetLinkPreview_Resp', { url, title, image: b64Image })\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\treader.readAsDataURL(imageResponse.data)\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('Error loading the reference image', e)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.sendPostMessage('Action_GetLinkPreview_Resp', { url, title, image: null })\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Error resolving a reference', e)\n\t\t\t}\n\t\t},\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { translate as t } from '@nextcloud/l10n'\nimport { generateUrl } from '@nextcloud/router'\nimport axios from '@nextcloud/axios'\n\nconst SupportedTaskTypes = {\n\tText: 'core:text2text',\n\tImage: 'core:text2image',\n}\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\ttask: null,\n\t\t}\n\t},\n\tmethods: {\n\t\tasync openAssistant() {\n\t\t\tthis.task = await window.OCA.Assistant.openAssistantForm({\n\t\t\t\tappId: 'richdocuments',\n\t\t\t\tcustomId: 'richdocuments:' + this.fileid,\n\t\t\t\tisInsideViewer: true,\n\t\t\t\tactionButtons: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: t('richdocuments', 'Insert into document'),\n\t\t\t\t\t\ttitle: t('richdocuments', 'Insert into document'),\n\t\t\t\t\t\tonClick: () => this.handleTask(this.task),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t})\n\t\t},\n\t\thandleTask(task) {\n\t\t\tswitch (task.type) {\n\n\t\t\tcase SupportedTaskTypes.Text:\n\t\t\t\tthis.insertAIText(task.output.output)\n\t\t\t\tbreak\n\n\t\t\tcase SupportedTaskTypes.Image:\n\t\t\t\tthis.insertAIImages(task.output.images)\n\t\t\t\tbreak\n\n\t\t\tdefault:\n\t\t\t\tbreak\n\t\t\t}\n\t\t},\n\t\tinsertAIText(text) {\n\t\t\tthis.sendPostMessage('Action_Paste', {\n\t\t\t\tMimetype: 'text/plain;charset=utf-8',\n\t\t\t\tData: text,\n\t\t\t})\n\t\t},\n\t\tasync insertAIImages(images) {\n\t\t\tconst assets = await axios({\n\t\t\t\tmethod: 'post',\n\t\t\t\turl: generateUrl('apps/richdocuments/assets/tasks'),\n\t\t\t\tdata: {\n\t\t\t\t\ttaskId: this.task.id,\n\t\t\t\t\tfileIds: [images[0]],\n\t\t\t\t},\n\t\t\t})\n\n\t\t\t// For now, we only insert the first generated image\n\t\t\tconst firstImage = assets.data[0]\n\n\t\t\tthis.sendPostMessage('Action_InsertGraphic', {\n\t\t\t\tfilename: firstImage.filename,\n\t\t\t\turl: firstImage.url,\n\t\t\t})\n\t\t},\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { spawnDialog } from '@nextcloud/dialogs'\nimport SaveAs from '../components/Modal/SaveAs.vue'\n\nexport default {\n\tmethods: {\n\t\tasync saveAs(format) {\n\t\t\tspawnDialog(\n\t\t\t\tSaveAs,\n\t\t\t\t{\n\t\t\t\t\tpath: this.filename,\n\t\t\t\t\tformat,\n\t\t\t\t\tdescription: t('richdocuments', 'Save a copy of the file under a new name and continue editing the new file'),\n\t\t\t\t},\n\t\t\t\t(value) => value && this.sendPostMessage('Action_SaveAs', { Filename: value, Notify: true }),\n\t\t\t)\n\t\t},\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { generateOcsUrl } from '@nextcloud/router'\nimport axios from '@nextcloud/axios'\nimport Config from '../services/config.tsx'\nimport { getNextcloudUrl } from '../helpers/url.js'\n\nexport default {\n\tmethods: {\n\t\tasync uiMention({ type, text, username }) {\n\t\t\tif (type === 'autocomplete') {\n\t\t\t\tlet users = []\n\n\t\t\t\tif (Config.get('userId') !== null) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst result = await axios.get(generateOcsUrl('core/autocomplete/get'), {\n\t\t\t\t\t\t\tparams: { search: text },\n\t\t\t\t\t\t})\n\t\t\t\t\t\tusers = result.data.ocs.data\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst list = users.map((user) => {\n\t\t\t\t\tconst profile = window.location.protocol + '//' + getNextcloudUrl() + '/index.php/u/' + user.id\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlabel: user.label,\n\t\t\t\t\t\tusername: user.id,\n\t\t\t\t\t\tprofile,\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tthis.sendPostMessage('Action_Mention', { list })\n\t\t\t}\n\t\t\tif (type === 'selected') {\n\t\t\t\tawait axios.post(generateOcsUrl(`apps/richdocuments/api/v1/mention/${this.fileid}`), { mention: username })\n\t\t\t}\n\t\t},\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { emit, subscribe, unsubscribe } from '@nextcloud/event-bus'\nimport { generateRemoteUrl, getRootUrl } from '@nextcloud/router'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport axios from '@nextcloud/axios'\nimport { showError } from '@nextcloud/dialogs'\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tversionToRestore: null,\n\t\t}\n\t},\n\tmounted() {\n\t\tsubscribe('files_versions:restore:requested', this.onRestoreRequested)\n\n\t},\n\n\tbeforeDestroy() {\n\t\tunsubscribe('files_versions:restore:requested', this.onRestoreRequested)\n\t},\n\n\tmethods: {\n\t\tonRestoreRequested(eventState) {\n\t\t\t// Tell Collabora that we are about to restore a version\n\t\t\tthis.sendPostMessage('Host_VersionRestore', {\n\t\t\t\tStatus: 'Pre_Restore',\n\t\t\t})\n\n\t\t\tthis.versionToRestore = eventState.version\n\n\t\t\t// Prevent files_versions own restore as we'd need to wait for Collabora to be ready\n\t\t\teventState.preventDefault = true\n\t\t},\n\t\tasync handlePreRestoreAck() {\n\t\t\tconst restoreUrl = getRootUrl() + '/remote.php/dav/versions/' + getCurrentUser().uid\n\t\t\t\t+ '/versions/' + this.fileid + '/' + this.versionToRestore.fileVersion\n\t\t\ttry {\n\t\t\t\tawait axios({\n\t\t\t\t\tmethod: 'MOVE',\n\t\t\t\t\turl: restoreUrl,\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tDestination: generateRemoteUrl('dav') + '/versions/' + getCurrentUser().uid + '/restore/target',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\temit('files_versions:restore:restored', this.versionToRestore)\n\t\t\t} catch (e) {\n\t\t\t\tshowError(t('richdocuments', 'Failed to revert the document to older version'))\n\t\t\t}\n\t\t\tthis.versionToRestore = null\n\t\t},\n\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { loadState } from '@nextcloud/initial-state'\n\n/**\n * @return {boolean|string} Gets the current user's display name if logged in.\n */\nfunction getLoggedInUser() {\n\treturn loadState('richdocuments', 'loggedInUser')\n}\n\nexport default getLoggedInUser\n","<!--\n  - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div class=\"office-viewer\" :class=\"{ 'office-viewer__embedding': isEmbedded }\">\n\t\t<div v-if=\"showLoadingIndicator\"\n\t\t\tclass=\"office-viewer__loading-overlay\"\n\t\t\t:class=\"{ debug: debug }\">\n\t\t\t<NcEmptyContent v-if=\"!error\" :name=\"loadingMessage\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<NcLoadingIcon />\n\t\t\t\t</template>\n\t\t\t\t<template #action>\n\t\t\t\t\t<NcButton @click=\"close\">\n\t\t\t\t\t\t{{ t('richdocuments', 'Cancel') }}\n\t\t\t\t\t</NcButton>\n\t\t\t\t</template>\n\t\t\t</NcEmptyContent>\n\t\t\t<NcEmptyContent v-else :name=\"t('richdocuments', 'Document loading failed')\" :description=\"errorMessage\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<AlertOctagonOutline />\n\t\t\t\t</template>\n\t\t\t\t<template #description>\n\t\t\t\t\t<p>{{ errorMessage }}</p>\n\t\t\t\t\t<p v-if=\"showAdminStorageFailure\">\n\t\t\t\t\t\t{{ t('richdocuments', 'Please check the Collabora Online server log for more details and make sure that Nextcloud can be reached from there.') }}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p v-if=\"showAdminWebsocketFailure\">\n\t\t\t\t\t\t{{ t('richdocuments', 'Socket connection closed unexpectedly. The reverse proxy might be misconfigured, please contact the administrator.') }}\n\t\t\t\t\t\t<a href=\"https://docs.nextcloud.com/server/latest/admin_manual/office/proxy.html\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noreferrer noopener\"\n\t\t\t\t\t\t\tclass=\"external\">\n\t\t\t\t\t\t\t{{ t('richdocuments', 'More information can be found in the reverse proxy documentation') }}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</p>\n\t\t\t\t</template>\n\t\t\t\t<template #action>\n\t\t\t\t\t<NcButton @click=\"close\">\n\t\t\t\t\t\t{{ t('richdocuments', 'Close') }}\n\t\t\t\t\t</NcButton>\n\t\t\t\t</template>\n\t\t\t</NcEmptyContent>\n\t\t</div>\n\t\t<form ref=\"form\"\n\t\t\t:target=\"iframeId\"\n\t\t\t:action=\"formData.action\"\n\t\t\tmethod=\"post\">\n\t\t\t<input name=\"access_token\" :value=\"formData.accessToken\" type=\"hidden\">\n\t\t\t<input name=\"access_token_ttl\" :value=\"formData.accessTokenTTL\" type=\"hidden\">\n\t\t\t<input name=\"ui_defaults\" :value=\"formData.uiDefaults\" type=\"hidden\">\n\t\t\t<input name=\"css_variables\" :value=\"formData.cssVariables\" type=\"hidden\">\n\t\t\t<input name=\"theme\" :value=\"formData.theme\" type=\"hidden\">\n\t\t\t<input name=\"buy_product\" value=\"https://nextcloud.com/pricing\" type=\"hidden\">\n\t\t\t<input name=\"host_session_id\" :value=\"formData.hostSessionID\" type=\"hidden\">\n\t\t\t<input name=\"wopi_setting_base_url\" :value=\"formData.wopiSettingBaseUrl\" type=\"hidden\">\n\t\t</form>\n\t\t<iframe :id=\"iframeId\"\n\t\t\tref=\"documentFrame\"\n\t\t\t:name=\"iframeId\"\n\t\t\tdata-cy=\"coolframe\"\n\t\t\tscrolling=\"no\"\n\t\t\tallowfullscreen\n\t\t\tallow=\"clipboard-read *; clipboard-write *\"\n\t\t\tclass=\"office-viewer__iframe\"\n\t\t\t:style=\"{visibility: showIframe ? 'visible' : 'hidden' }\"\n\t\t\t:src=\"iframeSrc\"\n\t\t\t:title=\"iframeTitle\" />\n\n\t\t<NcButton v-if=\"isEmbedded && !hasWidgetEditingEnabled\" class=\"toggle-interactive\" @click=\"toggleEdit\">\n\t\t\t{{ t('richdocuments', 'Edit') }}\n\t\t\t<template #icon>\n\t\t\t\t<PencilIcon />\n\t\t\t</template>\n\t\t</NcButton>\n\t\t<ZoteroHint :show.sync=\"showZotero\" @submit=\"reload\" />\n\t</div>\n</template>\n\n<script>\nimport PencilIcon from 'vue-material-design-icons/PencilOutline.vue'\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\nimport NcEmptyContent from '@nextcloud/vue/dist/Components/NcEmptyContent.js'\nimport NcLoadingIcon from '@nextcloud/vue/dist/Components/NcLoadingIcon.js'\nimport AlertOctagonOutline from 'vue-material-design-icons/AlertOctagonOutline.vue'\nimport { loadState } from '@nextcloud/initial-state'\nimport { showInfo, spawnDialog } from '@nextcloud/dialogs'\n\nimport ZoteroHint from '../components/Modal/ZoteroHint.vue'\nimport { basename, dirname } from 'path'\nimport { getRandomId } from '../helpers/index.js'\nimport {\n\tgetNextcloudUrl,\n\tgetWopiUrl,\n\tgetConfigFileUrl,\n} from '../helpers/url.js'\nimport PostMessageService from '../services/postMessage.tsx'\nimport FilesAppIntegration from './FilesAppIntegration.js'\nimport { LOADING_ERROR, checkCollaboraConfiguration, checkProxyStatus } from '../services/collabora.js'\nimport { enableScrollLock, disableScrollLock } from '../helpers/safariFixer.js'\nimport axios from '@nextcloud/axios'\nimport {\n\tgenerateUrl,\n\timagePath,\n} from '@nextcloud/router'\nimport { isPublicShare, getSharingToken } from '@nextcloud/sharing/public'\nimport { getCapabilities } from './../services/capabilities.ts'\nimport {\n\tgenerateCSSVarTokens,\n\tgetCollaboraTheme,\n\tgetUIDefaults,\n} from '../helpers/coolParameters.js'\nimport Config from '../services/config.tsx'\nimport autoLogout from '../mixins/autoLogout.js'\nimport openLocal from '../mixins/openLocal.js'\nimport pickLink from '../mixins/pickLink.js'\nimport assistant from '../mixins/assistant.js'\nimport saveAs from '../mixins/saveAs.js'\nimport uiMention from '../mixins/uiMention.js'\nimport version from '../mixins/version.js'\nimport { getCurrentUser, getGuestNickname } from '@nextcloud/auth'\nimport { shouldAskForGuestName } from '../helpers/guestName.js'\n\nconst FRAME_DOCUMENT = 'FRAME_DOCUMENT'\n\nconst LOADING_STATE = {\n\tLOADING: 0,\n\tFRAME_READY: 1,\n\tDOCUMENT_READY: 2,\n\tFAILED: -1,\n}\n\nexport default {\n\tname: 'Office',\n\tcomponents: {\n\t\tAlertOctagonOutline,\n\t\tNcButton,\n\t\tNcEmptyContent,\n\t\tNcLoadingIcon,\n\t\tPencilIcon,\n\t\tZoteroHint,\n\t},\n\tmixins: [\n\t\tautoLogout, openLocal, pickLink, saveAs, uiMention, version, assistant,\n\t],\n\tprops: {\n\t\tfilename: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tfileid: {\n\t\t\ttype: Number,\n\t\t\tdefault: null,\n\t\t},\n\t\thasPreview: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: () => false,\n\t\t},\n\t\tsource: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tmime: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tpermissions: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tisEmbedded: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tpostMessage: null,\n\t\t\tiframeId: 'collaboraframe_' + getRandomId(),\n\t\t\tiframeSrc: null,\n\t\t\tloading: LOADING_STATE.LOADING,\n\t\t\tloadingTimeout: null,\n\t\t\terror: null,\n\t\t\terrorType: null,\n\t\t\tloadingMsg: null,\n\n\t\t\tshowLinkPicker: false,\n\t\t\tshowZotero: false,\n\t\t\tmodified: false,\n\t\t\thasWidgetEditingEnabled: false,\n\n\t\t\tformData: {\n\t\t\t\taction: null,\n\t\t\t\taccessToken: null,\n\t\t\t\taccessTokenTTL: null,\n\t\t\t\tuiDefaults: getUIDefaults(),\n\t\t\t\tcssVariables: generateCSSVarTokens(),\n\t\t\t\ttheme: getCollaboraTheme(),\n\t\t\t\thostSessionID: 'nextcloud ' + OC.config.version + ' - richdocuments ' + getCapabilities().version,\n\t\t\t\twopiSettingBaseUrl: getConfigFileUrl(),\n\t\t\t},\n\t\t}\n\t},\n\tcomputed: {\n\t\tshowIframe() {\n\t\t\treturn this.loading >= LOADING_STATE.FRAME_READY || this.debug\n\t\t},\n\t\tiframeTitle() {\n\t\t\treturn loadState('richdocuments', 'productName', 'Nextcloud Office')\n\t\t},\n\t\tshowLoadingIndicator() {\n\t\t\treturn this.loading < LOADING_STATE.FRAME_READY\n\t\t},\n\t\terrorMessage() {\n\t\t\tswitch (parseInt(this.error)) {\n\t\t\tcase LOADING_ERROR.COLLABORA_UNCONFIGURED:\n\t\t\t\treturn t('richdocuments', '{productName} is not configured', { productName: loadState('richdocuments', 'productName', 'Nextcloud Office') })\n\t\t\tcase LOADING_ERROR.PROXY_FAILED:\n\t\t\t\treturn t('richdocuments', 'Starting the built-in CODE server failed')\n\t\t\tdefault:\n\t\t\t\treturn this.error\n\t\t\t}\n\t\t},\n\t\tloadingMessage() {\n\t\t\tif (this.loadingMsg) {\n\t\t\t\treturn this.loadingMsg\n\t\t\t}\n\n\t\t\treturn t('richdocuments', 'Loading {filename} ', { filename: basename(this.filename) }, 1, { escape: false })\n\t\t},\n\t\tdebug() {\n\t\t\treturn !!window.TESTING\n\t\t},\n\t\tisPublic() {\n\t\t\treturn isPublicShare()\n\t\t},\n\t\tshareToken() {\n\t\t\treturn getSharingToken()\n\t\t},\n\t\tshowAdminStorageFailure() {\n\t\t\treturn getCurrentUser()?.isAdmin && this.errorType === 'websocketloadfailed'\n\t\t},\n\t\tshowAdminWebsocketFailure() {\n\t\t\treturn getCurrentUser()?.isAdmin && this.errorType === 'websocketconnectionfailed'\n\t\t},\n\t},\n\twatch: {\n\t\thasWidgetEditingEnabled() {\n\t\t\tthis.load()\n\t\t},\n\t},\n\tasync mounted() {\n\t\tthis.postMessage = new PostMessageService({\n\t\t\tFRAME_DOCUMENT: () => document.getElementById(this.iframeId).contentWindow,\n\t\t})\n\t\ttry {\n\t\t\tawait checkCollaboraConfiguration()\n\t\t\tawait checkProxyStatus()\n\t\t} catch (e) {\n\t\t\tthis.error = e.message\n\t\t\tthis.loading = LOADING_STATE.FAILED\n\t\t\treturn\n\t\t}\n\n\t\tif (this.fileid) {\n\t\t\tconst fileList = OCA?.Files?.App?.getCurrentFileList?.()\n\t\t\tFilesAppIntegration.init({\n\t\t\t\tfileName: basename(this.filename),\n\t\t\t\tfileId: this.fileid,\n\t\t\t\tfilePath: dirname(this.filename),\n\t\t\t\tfileList,\n\t\t\t\tfileModel: fileList?.getModelForFile(basename(this.filename)),\n\t\t\t\tsendPostMessage: (msgId, values) => {\n\t\t\t\t\tthis.postMessage.sendWOPIPostMessage(FRAME_DOCUMENT, msgId, values)\n\t\t\t\t},\n\t\t\t})\n\n\t\t\twindow.OCA?.Files?.Sidebar?.close()\n\t\t}\n\t\tthis.postMessage.registerPostMessageHandler(this.postMessageHandler)\n\n\t\tif (shouldAskForGuestName(this.mime, this.permissions?.includes('W'))) {\n\t\t\tconst { default: GuestNamePicker } = await import(\n\t\t\t\t/* webpackChunkName: 'GuestNamePicker' */\n\t\t\t\t'../components/GuestNamePicker.vue')\n\n\t\t\tspawnDialog(GuestNamePicker, {\n\t\t\t\tfileName: basename(this.filename),\n\t\t\t\tonSubmit: async () => {\n\t\t\t\t\tawait this.load()\n\t\t\t\t},\n\t\t\t})\n\t\t} else {\n\t\t\tawait this.load()\n\t\t}\n\t},\n\tbeforeDestroy() {\n\t\tthis.postMessage.unregisterPostMessageHandler(this.postMessageHandler)\n\t},\n\tmethods: {\n\t\tasync load() {\n\t\t\tconst fileid = this.fileid ?? basename(dirname(this.source))\n\t\t\tconst version = this.fileid ? 0 : basename(this.source)\n\n\t\t\tenableScrollLock()\n\n\t\t\t// Generate WOPI token\n\t\t\tconst { data } = await axios.post(generateUrl('/apps/richdocuments/token'), {\n\t\t\t\tfileId: fileid, shareToken: this.shareToken, version, guestName: getGuestNickname(),\n\t\t\t})\n\n\t\t\tif (data.federatedUrl) {\n\t\t\t\tthis.$set(this.formData, 'action', data.federatedUrl)\n\t\t\t\tthis.$nextTick(() => this.$refs.form.submit())\n\t\t\t\tthis.loading = LOADING_STATE.DOCUMENT_READY\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tConfig.update('urlsrc', data.urlSrc)\n\t\t\tConfig.update('wopi_callback_url', loadState('richdocuments', 'wopi_callback_url', ''))\n\t\t\tConfig.update('startPresentation', loadState('richdocuments', 'startPresentation', false))\n\n\t\t\tconst forceReadOnly = this.isEmbedded && !this.hasWidgetEditingEnabled\n\n\t\t\t// Generate form and submit to the iframe\n\t\t\tconst action = getWopiUrl({\n\t\t\t\tfileId: fileid + '_' + loadState('richdocuments', 'instanceId', 'instanceid') + (version > 0 ? '_' + version : ''),\n\t\t\t\treadOnly: forceReadOnly || version > 0,\n\t\t\t\trevisionHistory: !this.isPublic,\n\t\t\t\tcloseButton: !Config.get('hideCloseButton') && !this.isEmbedded,\n\t\t\t\tstartPresentation: Config.get('startPresentation'),\n\t\t\t})\n\t\t\tthis.$set(this.formData, 'action', action)\n\t\t\tthis.$set(this.formData, 'accessToken', data.token)\n\t\t\tthis.$nextTick(() => this.$refs.form.submit())\n\n\t\t\tthis.loading = LOADING_STATE.LOADING\n\t\t\tthis.loadingTimeout = setTimeout(() => {\n\t\t\t\tconsole.error('Document loading failed due to timeout: Please check for failing network requests')\n\t\t\t\tthis.loading = LOADING_STATE.FAILED\n\t\t\t\tthis.error = t('richdocuments', 'Failed to load {productName} - please try again later', { productName: loadState('richdocuments', 'productName', 'Nextcloud Office') })\n\t\t\t}, (getCapabilities().config.timeout * 1000 || 15000))\n\t\t},\n\t\tsendPostMessage(msgId, values = {}) {\n\t\t\tthis.postMessage.sendWOPIPostMessage(FRAME_DOCUMENT, msgId, values)\n\t\t},\n\t\tdocumentReady() {\n\t\t\tthis.loading = LOADING_STATE.DOCUMENT_READY\n\t\t\tclearTimeout(this.loadingTimeout)\n\t\t\tthis.sendPostMessage('Host_PostmessageReady')\n\t\t},\n\t\tasync share() {\n\t\t\tFilesAppIntegration.share()\n\t\t},\n\t\tclose() {\n\t\t\tFilesAppIntegration.close()\n\t\t\tif (this.modified) {\n\t\t\t\tFilesAppIntegration.updateFileInfo(undefined, Date.now())\n\t\t\t}\n\t\t\tdisableScrollLock()\n\t\t\tthis.$emit('close')\n\t\t},\n\t\treload() {\n\t\t\tthis.loading = LOADING_STATE.LOADING\n\t\t\tthis.load()\n\t\t\tthis.$refs.documentFrame.contentWindow.location.replace(this.iframeSrc)\n\t\t},\n\t\tpostMessageHandler({ parsed }) {\n\t\t\tconst { msgId, args, deprecated } = parsed\n\t\t\tconsole.debug('[viewer] Received post message', msgId, args, deprecated)\n\t\t\tif (deprecated) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tswitch (msgId) {\n\t\t\tcase 'App_LoadingStatus':\n\t\t\t\tif (args.Status === 'Frame_Ready') {\n\t\t\t\t\t// defer showing the frame until collabora has finished also loading the document\n\t\t\t\t\tthis.loading = LOADING_STATE.FRAME_READY\n\t\t\t\t\tthis.$emit('update:loaded', true)\n\t\t\t\t\tFilesAppIntegration.initAfterReady()\n\t\t\t\t} else if (args.Status === 'Document_Loaded') {\n\t\t\t\t\tthis.documentReady()\n\n\t\t\t\t\tif (loadState('richdocuments', 'open_local_editor', true) && !this.isEmbedded) {\n\t\t\t\t        this.sendPostMessage('Insert_Button', {\n\t\t\t\t\t        id: 'Open_Local_Editor',\n\t\t\t\t\t        imgurl: window.location.protocol + '//' + getNextcloudUrl() + imagePath('richdocuments', 'launch.svg'),\n\t\t\t\t\t        mobile: false,\n\t\t\t\t\t        label: t('richdocuments', 'Open in local editor'),\n\t\t\t\t\t        hint: t('richdocuments', 'Open in local editor'),\n\t\t\t\t\t        insertBefore: 'print',\n\t\t\t\t        })\n\t\t\t        }\n\t\t\t\t} else if (args.Status === 'Failed') {\n\t\t\t\t\tthis.loading = LOADING_STATE.FAILED\n\t\t\t\t\tthis.$emit('update:loaded', true)\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 'Action_Load_Resp':\n\t\t\t\tif (args.success) {\n\t\t\t\t\tthis.documentReady()\n\t\t\t\t} else {\n\t\t\t\t\tif (args.errorType === 'clusterscaling') {\n\t\t\t\t\t\tthis.loadingMsg = t('richdocuments', 'Cluster is scaling ')\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.error = args.errorMsg\n\t\t\t\t\t\tthis.errorType = args.errorType\n\t\t\t\t\t\tthis.loading = LOADING_STATE.FAILED\n\t\t\t\t\t\tclearTimeout(this.loadingTimeout)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 'UI_Close':\n\t\t\t\tthis.close()\n\t\t\t\tbreak\n\t\t\tcase 'Session_Closed':\n\t\t\t\tthis.handleSessionClosed(args)\n\t\t\t\tbreak\n\t\t\tcase 'UI_SaveAs':\n\t\t\t\tthis.saveAs(args.format)\n\t\t\t\tbreak\n\t\t\tcase 'Action_Save_Resp':\n\t\t\t\tif (args.fileName !== this.filename) {\n\t\t\t\t\tFilesAppIntegration.saveAs(args.fileName)\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 'UI_InsertGraphic':\n\t\t\t\tFilesAppIntegration.insertGraphic((filename, url) => {\n\t\t\t\t\tthis.postMessage.sendWOPIPostMessage(FRAME_DOCUMENT, 'Action_InsertGraphic', {\n\t\t\t\t\t\tfilename,\n\t\t\t\t\t\turl,\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\tcase 'UI_InsertFile':\n\t\t\t\tFilesAppIntegration.insertFile(args.mimeTypeFilter, (filename, url) => {\n\t\t\t\t\tthis.postMessage.sendWOPIPostMessage(FRAME_DOCUMENT, args.callback, {\n\t\t\t\t\t\tfilename,\n\t\t\t\t\t\turl,\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\tcase 'UI_Mention':\n\t\t\t\tthis.uiMention(parsed.args)\n\t\t\t\tbreak\n\t\t\tcase 'UI_CreateFile':\n\t\t\t\tFilesAppIntegration.createNewFile(args.DocumentType)\n\t\t\t\tbreak\n\t\t\tcase 'File_Rename':\n\t\t\t\tFilesAppIntegration.rename(decodeURIComponent(args.NewName))\n\t\t\t\tbreak\n\t\t\tcase 'UI_FileVersions':\n\t\t\t\tFilesAppIntegration.showRevHistory()\n\t\t\t\tbreak\n\t\t\tcase 'App_VersionRestore':\n\t\t\t\tif (args.Status === 'Pre_Restore_Ack') {\n\t\t\t\t\tthis.handlePreRestoreAck()\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 'UI_Share':\n\t\t\t\tthis.share()\n\t\t\t\tbreak\n\t\t\tcase 'UI_ZoteroKeyMissing':\n\t\t\t\tthis.showZotero = true\n\t\t\t\tbreak\n\t\t\t// FIXME: Remove once https://github.com/CollaboraOnline/online/pull/8926 is released\n\t\t\tcase 'UI UI_PickLink':\n\t\t\tcase 'UI_PickLink':\n\t\t\t\tthis.pickLink()\n\t\t\t\tbreak\n\t\t\tcase 'UI_InsertAIContent':\n\t\t\t\tthis.openAssistant()\n\t\t\t\tbreak\n\t\t\tcase 'Action_GetLinkPreview':\n\t\t\t\tthis.resolveLink(args.url)\n\t\t\t\tbreak\n\t\t\tcase 'Action_Save':\n\t\t\t\tif (this.modified) {\n\t\t\t\t\tFilesAppIntegration.updateFileInfo(undefined, Date.now())\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 'Clicked_Button':\n\t\t\t\tthis.buttonClicked(args)\n\t\t\t\tbreak\n\t\t\tcase 'Doc_ModifiedStatus':\n\t\t\t\tif (args.Modified !== this.modified && !this.openingLocally) {\n\t\t\t\t\tFilesAppIntegration.updateFileInfo(undefined, Date.now())\n\t\t\t\t}\n\t\t\t\tthis.modified = args.Modified\n\t\t\t\tbreak\n\t\t\t}\n\t\t},\n\n\t\tasync buttonClicked(args) {\n\t\t\tif (args?.Id === 'Open_Local_Editor') {\n\t\t\t\tthis.startOpenLocalProcess()\n\t\t\t}\n\t\t},\n\n\t\thandleSessionClosed({ Reason }) {\n\t\t\tif (Reason !== 'OwnerTermination') {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (this.openingLocally) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tshowInfo(t('richdocuments', 'The collaborative editing was terminated by another user'))\n\t\t\tthis.close()\n\t\t},\n\n\t\ttoggleEdit() {\n\t\t\tthis.hasWidgetEditingEnabled = true\n\t\t},\n\n\t},\n}\n</script>\n<style lang=\"scss\" scoped>\n.office-viewer {\n\tz-index: 100000;\n\tmax-width: 100%;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground-color: var(--color-main-background);\n\n\t&__loading-overlay:not(.viewer__file--hidden) {\n\t\tborder-top: 3px solid var(--color-primary-element);\n\t\tdisplay: flex;\n\t\theight: 100%;\n\t\twidth: 100%;\n\t\tz-index: 1;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tbackground-color: var(--color-main-background);\n\t\t&.debug {\n\t\t\topacity: .5;\n\t\t}\n\n\t\t::v-deep .empty-content p {\n\t\t\ttext-align: center;\n\t\t}\n\n\t\t.empty-content {\n\t\t\talign-self: center;\n\t\t\tflex-grow: 1;\n\t\t}\n\t}\n\n\t&__embedding {\n\t\tmin-height: 400px;\n\n\t\t.toggle-interactive {\n\t\t\tposition: sticky;\n\t\t\tbottom: 12px;\n\t\t\tright: 12px;\n\t\t\tz-index: 1;\n\t\t\tmargin-left: auto;\n\t\t\tmargin-right: 0;\n\t\t}\n\t}\n\n\t&__iframe {\n\t\twidth: 100%;\n\t\tflex-grow: 1;\n\t}\n}\n</style>\n\n<style lang=\"scss\">\n.viewer__content:not(.viewer--split) .office-viewer:not(.viewer__file--hidden):not(.widget-file) {\n\twidth: 100%;\n\theight: 100vh;\n\theight: 100dvh;\n\ttop: -50px;\n\tposition: absolute;\n}\n\n[data-handler=\"richdocuments\"] .modal-container {\n\tbottom: 0;\n}\n\n.viewer__content.viewer--split .office-viewer {\n\theight: 100%;\n\twidth: 100%;\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport {\n\tgetCurrentUser,\n\tgetGuestNickname,\n} from '@nextcloud/auth'\nimport getLoggedInUser from '../helpers/getLoggedInUser.js'\n\n/**\n * Determines if the user should be asked to enter a guest name\n *\n * @param {string} mimetype - Mimetype of the file\n * @param {boolean} canWrite - If write access is granted\n */\nexport function shouldAskForGuestName(mimetype, canWrite) {\n\tconst noLoggedInUser = !getLoggedInUser()\n\tconst noGuest = !getGuestNickname()\n\tconst noCurrentUser = !getCurrentUser() || getCurrentUser()?.uid === ''\n\tconst isReadOnlyPDF = mimetype === 'application/pdf' && !canWrite\n\n\tif (!canWrite) {\n\t\treturn false\n\t}\n\n\treturn noLoggedInUser && noGuest && noCurrentUser && !isReadOnlyPDF\n}\n","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Office.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Office.vue?vue&type=script&lang=js\"","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/dist/cjs.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Office.vue?vue&type=style&index=0&id=463e23e0&prod&lang=scss&scoped=true\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/dist/cjs.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Office.vue?vue&type=style&index=0&id=463e23e0&prod&lang=scss&scoped=true\";\n       export default content && content.locals ? content.locals : undefined;\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/dist/cjs.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Office.vue?vue&type=style&index=1&id=463e23e0&prod&lang=scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/dist/cjs.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Office.vue?vue&type=style&index=1&id=463e23e0&prod&lang=scss\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render, staticRenderFns } from \"./Office.vue?vue&type=template&id=463e23e0&scoped=true\"\nimport script from \"./Office.vue?vue&type=script&lang=js\"\nexport * from \"./Office.vue?vue&type=script&lang=js\"\nimport style0 from \"./Office.vue?vue&type=style&index=0&id=463e23e0&prod&lang=scss&scoped=true\"\nimport style1 from \"./Office.vue?vue&type=style&index=1&id=463e23e0&prod&lang=scss\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"463e23e0\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"office-viewer\",class:{ 'office-viewer__embedding': _vm.isEmbedded }},[(_vm.showLoadingIndicator)?_c('div',{staticClass:\"office-viewer__loading-overlay\",class:{ debug: _vm.debug }},[(!_vm.error)?_c('NcEmptyContent',{attrs:{\"name\":_vm.loadingMessage},scopedSlots:_vm._u([{key:\"icon\",fn:function(){return [_c('NcLoadingIcon')]},proxy:true},{key:\"action\",fn:function(){return [_c('NcButton',{on:{\"click\":_vm.close}},[_vm._v(\"\\n\\t\\t\\t\\t\\t\"+_vm._s(_vm.t('richdocuments', 'Cancel'))+\"\\n\\t\\t\\t\\t\")])]},proxy:true}],null,false,2574797798)}):_c('NcEmptyContent',{attrs:{\"name\":_vm.t('richdocuments', 'Document loading failed'),\"description\":_vm.errorMessage},scopedSlots:_vm._u([{key:\"icon\",fn:function(){return [_c('AlertOctagonOutline')]},proxy:true},{key:\"description\",fn:function(){return [_c('p',[_vm._v(_vm._s(_vm.errorMessage))]),_vm._v(\" \"),(_vm.showAdminStorageFailure)?_c('p',[_vm._v(\"\\n\\t\\t\\t\\t\\t\"+_vm._s(_vm.t('richdocuments', 'Please check the Collabora Online server log for more details and make sure that Nextcloud can be reached from there.'))+\"\\n\\t\\t\\t\\t\")]):_vm._e(),_vm._v(\" \"),(_vm.showAdminWebsocketFailure)?_c('p',[_vm._v(\"\\n\\t\\t\\t\\t\\t\"+_vm._s(_vm.t('richdocuments', 'Socket connection closed unexpectedly. The reverse proxy might be misconfigured, please contact the administrator.'))+\"\\n\\t\\t\\t\\t\\t\"),_c('a',{staticClass:\"external\",attrs:{\"href\":\"https://docs.nextcloud.com/server/latest/admin_manual/office/proxy.html\",\"target\":\"_blank\",\"rel\":\"noreferrer noopener\"}},[_vm._v(\"\\n\\t\\t\\t\\t\\t\\t\"+_vm._s(_vm.t('richdocuments', 'More information can be found in the reverse proxy documentation'))+\"\\n\\t\\t\\t\\t\\t\")])]):_vm._e()]},proxy:true},{key:\"action\",fn:function(){return [_c('NcButton',{on:{\"click\":_vm.close}},[_vm._v(\"\\n\\t\\t\\t\\t\\t\"+_vm._s(_vm.t('richdocuments', 'Close'))+\"\\n\\t\\t\\t\\t\")])]},proxy:true}],null,false,3747207937)})],1):_vm._e(),_vm._v(\" \"),_c('form',{ref:\"form\",attrs:{\"target\":_vm.iframeId,\"action\":_vm.formData.action,\"method\":\"post\"}},[_c('input',{attrs:{\"name\":\"access_token\",\"type\":\"hidden\"},domProps:{\"value\":_vm.formData.accessToken}}),_vm._v(\" \"),_c('input',{attrs:{\"name\":\"access_token_ttl\",\"type\":\"hidden\"},domProps:{\"value\":_vm.formData.accessTokenTTL}}),_vm._v(\" \"),_c('input',{attrs:{\"name\":\"ui_defaults\",\"type\":\"hidden\"},domProps:{\"value\":_vm.formData.uiDefaults}}),_vm._v(\" \"),_c('input',{attrs:{\"name\":\"css_variables\",\"type\":\"hidden\"},domProps:{\"value\":_vm.formData.cssVariables}}),_vm._v(\" \"),_c('input',{attrs:{\"name\":\"theme\",\"type\":\"hidden\"},domProps:{\"value\":_vm.formData.theme}}),_vm._v(\" \"),_c('input',{attrs:{\"name\":\"buy_product\",\"value\":\"https://nextcloud.com/pricing\",\"type\":\"hidden\"}}),_vm._v(\" \"),_c('input',{attrs:{\"name\":\"host_session_id\",\"type\":\"hidden\"},domProps:{\"value\":_vm.formData.hostSessionID}}),_vm._v(\" \"),_c('input',{attrs:{\"name\":\"wopi_setting_base_url\",\"type\":\"hidden\"},domProps:{\"value\":_vm.formData.wopiSettingBaseUrl}})]),_vm._v(\" \"),_c('iframe',{ref:\"documentFrame\",staticClass:\"office-viewer__iframe\",style:({visibility: _vm.showIframe ? 'visible' : 'hidden' }),attrs:{\"id\":_vm.iframeId,\"name\":_vm.iframeId,\"data-cy\":\"coolframe\",\"scrolling\":\"no\",\"allowfullscreen\":\"\",\"allow\":\"clipboard-read *; clipboard-write *\",\"src\":_vm.iframeSrc,\"title\":_vm.iframeTitle}}),_vm._v(\" \"),(_vm.isEmbedded && !_vm.hasWidgetEditingEnabled)?_c('NcButton',{staticClass:\"toggle-interactive\",on:{\"click\":_vm.toggleEdit},scopedSlots:_vm._u([{key:\"icon\",fn:function(){return [_c('PencilIcon')]},proxy:true}],null,false,411976917)},[_vm._v(\"\\n\\t\\t\"+_vm._s(_vm.t('richdocuments', 'Edit'))+\"\\n\\t\\t\")]):_vm._e(),_vm._v(\" \"),_c('ZoteroHint',{attrs:{\"show\":_vm.showZotero},on:{\"update:show\":function($event){_vm.showZotero=$event},\"submit\":_vm.reload}})],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<!--\n  - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<!--\n  - This component is a wrapper around the Office component to be used in the viewer\n  - We currently need this to isolate the vue instances\n-->\n<template>\n\t<Office :filename=\"filename\"\n\t\t:fileid=\"fileid\"\n\t\t:has-preview=\"hasPreview\"\n\t\t:source=\"source\"\n\t\t:mime=\"mime\"\n\t\t:permissions=\"permissions\"\n\t\t:is-embedded=\"isEmbedded\"\n\t\t@close=\"$parent.close()\"\n\t\t@update:loaded=\"$emit('update:loaded', $event)\" />\n</template>\n<script>\nimport Vue from 'vue'\nimport Office from './Office.vue'\n\nVue.prototype.t = t\nVue.prototype.n = n\n\nexport default {\n\tname: 'Viewer',\n\tcomponents: {\n\t\tOffice: Vue.extend(Office),\n\t},\n\tprops: {\n\t\tfilename: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tfileid: {\n\t\t\ttype: Number,\n\t\t\tdefault: null,\n\t\t},\n\t\thasPreview: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: () => false,\n\t\t},\n\t\tsource: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tmime: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tpermissions: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tisEmbedded: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n}\n</script>\n","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./Viewer.vue?vue&type=template&id=3965d132\"\nimport script from \"./Viewer.vue?vue&type=script&lang=js\"\nexport * from \"./Viewer.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"names":["___CSS_LOADER_EXPORT___","push","module","id","name","components","BookOpenPageVariantOutline","NcModal","NcButton","NcTextField","props","show","type","Boolean","default","emits","data","apiKey","methods","submit","zoteroAPIKeyInput","axios","post","generateFilePath","e","console","error","showError","t","$emit","close","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","locals","_vm","this","_c","_self","attrs","on","staticClass","_v","_s","$event","preventDefault","apply","arguments","getCapabilities","mimetypes","getRandomId","length","undefined","Math","random","toString","replace","slice","__assign","Object","assign","s","i","n","p","prototype","hasOwnProperty","call","ConfigService","values","wopi_callback_url","loadState","update","key","value","get","getCallbackBaseUrl","Config","window","location","protocol","host","getRootUrl","getWopiUrl","_ref","fileId","readOnly","closeButton","revisionHistory","target","startPresentation","oc_appswebroots","files_versions","encodeURIComponent","wopiurl","debug","getWopiSrc","languageToBCP47","language","getLanguage","locale","getLocale","matchingWhitelist","de","de_CH","gsw","gsw_CH","fr","fr_CH","it","it_CH","getNextcloudUrl","PostMessageService","targets","_this","postMessageHandlers","addEventListener","event","handlePostMessage","sendPostMessage","message","targetOrigin","postMessage","sendWOPIPostMessage","msgId","msg","MessageId","SendTime","Date","now","Values","JSON","stringify","parsePostMessage","args","deprecated","parse","Deprecated","exc","registerPostMessageHandler","callback","unregisterPostMessageHandler","handlerIndex","findIndex","cb","parsed","wopiPostMessage","emit","forEach","fn","String","description","buttonText","path","format","selectedPath","computed","newFileName","filename","extension","split","pop","substring","set","mounted","filenameWithoutExtension","$nextTick","input","$refs","nameInput","inputField","$el","querySelector","setSelectionRange","focus","cancel","ref","model","$$v","expression","fileNode","fileModel","fileList","filePath","views","followingEditor","following","handlers","startLoading","getFileList","setViewerMode","showMask","init","fileName","_addHeaderFileActions","getFileNode","registerHandler","initAfterReady","getFileModel","hideMask","setPageTitle","$","remove","saveAs","newName","oldFile","node","changeFilesRoute","fileid","OCA","Files","Sidebar","newFileModel","clone","add","toJSON","OC","Apps","hideAppSidebar","share","isPublicShare","open","setActiveTab","rename","updateFileInfo","insertFile_impl","mimeTypeFilter","insertFileProc","insertHandler","insertFileFromPath","async","lastIndexOf","generateUrl","url","getFilePickerBuilder","theme","setMimeTypeFilter","setFilter","downloadShareAttribute","attributes","find","shareAttribute","downloadPermissions","enabled","permissions","PERMISSION_READ","addButton","label","files","build","pick","insertGraphic","filesAppIntegration","_ref2","insertFile","App","Sharing","PublicApp","getModelForFile","_updateDetailsView","setViews","view","ViewId","renderAvatars","followReset","Follow","followCurrentEditor","followView","unregisterMenu","isInverted","Theming","inverted","actionsContainer","actions","empty","getContext","$file","first","fileActions","fileInfoModel","$favorite","click","removeClass","addClass","actionFavorite","triggerAction","trigger","fileInfo","indexOf","TAG_FAVORITE","text","$info","actionDetails","all","Details","action","hideMenus","$download","actionDownload","Download","append","registerMenu","_userEntry","entry","_avatarForView","UserName","ReadOnly","stopPropagation","isFileOwner","canEdit","PERMISSION_UPDATE","IsCurrentView","removeButton","userId","UserId","avatarContainer","avatar","css","borderColor","Number","Color","borderWidth","borderStyle","attr","avatardiv","popover","users","viewId","getCurrentUser","uid","prop","showRevHistory","createNewFile","spawnDialog","SaveAs","getCurrentDirectory","currentFileList","encodeURI","loggingContext","currentUser","file","sharingToken","document","getElementById","mtime","source","_data","forceFetch","client","davGetClient","nodes","getDirectoryContents","davRootPath","details","davGetDefaultPropfind","map","result","davResultToNode","OCP","Router","goToRoute","params","query","LOADING_ERROR","proxyStatusCheckRetry","checkProxyStatus","_resolve","_reject","wopiUrl","config","wopi_url","proxyStatusUrl","checkProxyStatusCallback","resolve","reject","status","setTimeout","Promise","intervalHandler","scrollLock","isiOS","includes","navigator","platform","userAgent","maxTouchPoints","fixThemAll","documentElement","scrollTop","scrollingElement","handleResize","expectedHeight","visualViewport","height","clientHeight","frame","style","maxHeight","viewer","getUIDefaults","uiDefaults","UIMode","getUITheme","systemDarkMode","matchMedia","matches","dataset","body","themes","parent","nextcloudDarkMode","themeDark","themeDarkHighcontrast","themeDefault","createDataThemeDiv","elementType","element","createElement","setAttribute","appendChild","generateCSSVarTokens","isSettingIframe","cssVarMap","str","lightElement","darkElement","selectedElement","cssVarKey","cStyle","getComputedStyle","getPropertyValue","varNames","trim","handover","varName","lightStyle","darkStyle","customLogo","rootEl","logoBgColor","logoDisplay","autoLogoutInterval","autoLogoutRegistered","auto_logout","session_keepalive","setInterval","registerCheck","beforeDestroy","clearInterval","extendAutoLogout","oldValue","localStorage","getItem","newValue","setItem","StorageEvent","dispatchEvent","handleGetUserStateResponse","elapsed","Elapsed","lastActive","timeSinceLastActive","recheckAfter","getInterval","interval","session_lifetime","floor","min","max","confirmButtonText","cancelButtonText","openingLocally","startOpenLocalProcess","showOpenLocalConfirmation","Confirmation","decision","handleCloseSession","DontTerminateEdit","DontSaveIfUnmodified","Notify","openLocally","showOpenLocalFinished","Viewer","unlockFile","generateOcsUrl","then","encodePath","ocs","token","pickLink","showLinkPicker","link","getLinkWithPicker","URL","Mimetype","Data","resolveLink","resolvedLink","reference","references","title","openGraphObject","thumbnailUrl","thumb","imageResponse","responseType","reader","FileReader","b64Image","image","readAsDataURL","SupportedTaskTypes","task","openAssistant","Assistant","openAssistantForm","appId","customId","isInsideViewer","actionButtons","onClick","handleTask","insertAIText","output","insertAIImages","images","firstImage","method","taskId","fileIds","Filename","uiMention","username","search","list","user","profile","mention","versionToRestore","subscribe","onRestoreRequested","unsubscribe","eventState","Status","version","handlePreRestoreAck","restoreUrl","fileVersion","headers","Destination","generateRemoteUrl","FRAME_DOCUMENT","LOADING_STATE","AlertOctagonOutline","NcEmptyContent","NcLoadingIcon","PencilIcon","ZoteroHint","mixins","autoLogout","openLocal","assistant","hasPreview","required","mime","isEmbedded","iframeId","iframeSrc","loading","loadingTimeout","errorType","loadingMsg","showZotero","modified","hasWidgetEditingEnabled","formData","accessToken","accessTokenTTL","cssVariables","hostSessionID","wopiSettingBaseUrl","baseURL","showIframe","iframeTitle","showLoadingIndicator","errorMessage","parseInt","productName","loadingMessage","basename","escape","TESTING","isPublic","shareToken","getSharingToken","showAdminStorageFailure","isAdmin","showAdminWebsocketFailure","watch","load","contentWindow","Error","checkCollaboraConfiguration","getCurrentFileList","FilesAppIntegration","dirname","postMessageHandler","mimetype","canWrite","noLoggedInUser","getLoggedInUser","noGuest","getGuestNickname","noCurrentUser","shouldAskForGuestName","GuestNamePicker","onSubmit","guestName","federatedUrl","$set","form","urlSrc","forceReadOnly","timeout","documentReady","clearTimeout","removeEventListener","reload","documentFrame","imgurl","imagePath","mobile","hint","insertBefore","success","errorMsg","handleSessionClosed","DocumentType","decodeURIComponent","NewName","buttonClicked","Modified","Id","Reason","showInfo","toggleEdit","class","scopedSlots","_u","proxy","_e","domProps","visibility","Vue","Office","extend","$parent"],"sourceRoot":""}