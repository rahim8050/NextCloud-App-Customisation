const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=[window.OC.filePath('forms', '', 'js/index-BC-7VPxC-BQ4FjNB3.chunk.mjs'),window.OC.filePath('forms', '', 'js/Submit-C5uhIhQb.chunk.mjs'),window.OC.filePath('forms', '', 'js/NcSettingsSection-CX5q924g-LnPhDy5H.chunk.mjs'),window.OC.filePath('forms', '', 'js/modulepreload-polyfill-DsqUG6ei.chunk.mjs'),window.OC.filePath('forms', '', 'js/vendor-DyfrS5kh.chunk.mjs'),window.OC.filePath('forms', '', 'js/NcEmptyContent-4nhQl1Jo.chunk.mjs')])))=>i.map(i=>d[i]);
/*! third party licenses: js/vendor.LICENSE.txt */
import{n as T,b as st,j as ps,e as D,u as Rt,s as Vt,o as $e,N as it,l as et,g as lt,w as gs,x as vs,t as ze,y as ys,c as _s,a as bs}from"./modulepreload-polyfill-DsqUG6ei.chunk.mjs";import{_ as ws,y as Ss,z as Cs,d as pt,I as gt,V as Dt,T as Ue,Q as ks,A as As,B as Es,D as xs,G as Ot,H as Ns,O,J as vt,K as R,L as ct,M as B,P as Ye,R as Qe,U as yt,W as je,X as ut,Y as Ts,f as Ze,N as dt,Z as qt,$ as $t,a0 as Is,S as Ls,a1 as Hs,a2 as Ms,a3 as Ke,a4 as Ps,a5 as Fs,a6 as Rs,a7 as Vs}from"./Submit-C5uhIhQb.chunk.mjs";import{V as Q,p as Bs,q as We,a as Ds}from"./vendor-DyfrS5kh.chunk.mjs";import{p as Os,t as G,h as qs,i as $s,j as zs,k as Us,d as ot,c as M,m as _t,g as rt,v as H,l as I,s as F,_ as Z,o as Ys,f as Je,a as Qs,q as j,r as js,b as Ge,e as Zs,V as Ks}from"./NcSettingsSection-CX5q924g-LnPhDy5H.chunk.mjs";import{a as zt,b as Ut,N as Ws}from"./NcEmptyContent-4nhQl1Jo.chunk.mjs";import{I as Js,F as Yt}from"./FormsIcon-OjYb23IL.chunk.mjs";const ft="forms";var Gs=Object.defineProperty,Jt=Object.getOwnPropertySymbols,Xs=Object.prototype.hasOwnProperty,ti=Object.prototype.propertyIsEnumerable,Gt=(e,s,i)=>s in e?Gs(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,ei=(e,s)=>{for(var i in s||(s={}))Xs.call(s,i)&&Gt(e,i,s[i]);if(Jt)for(var i of Jt(s))ti.call(s,i)&&Gt(e,i,s[i]);return e};function si(e,s={},i={},o=()=>{}){typeof i=="function"&&(o=i,i={});let{container:r}=i;"container"in s&&typeof s.container=="string"&&(r??(r=s.container));const n=(typeof r=="string"&&document.querySelector(r)||document.body).appendChild(document.createElement("div")),a=new Q({el:n,name:"VueDialogHelper",render:l=>l(e,{props:ei({container:null},s),on:{close:(...d)=>{o(...d.map(m=>Bs(m))),a.$destroy(),n.remove()}}})});return a}const ii='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-folder-move" viewBox="0 0 24 24"><path d="M14,18V15H10V11H14V8L19,13M20,6H12L10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6Z" /></svg>',oi='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-folder-multiple" viewBox="0 0 24 24"><path d="M22,4H14L12,2H6A2,2 0 0,0 4,4V16A2,2 0 0,0 6,18H22A2,2 0 0,0 24,16V6A2,2 0 0,0 22,4M2,6H0V11H0V20A2,2 0 0,0 2,22H20V20H2V6Z" /></svg>';class ri extends Error{}class ni{title;multiSelect;mimeTypeFilter;directoriesAllowed;buttons;path;filter;container;disabledNavigation;constructor(s,i,o,r,n,a,l,d,m=!1){this.title=s,this.multiSelect=i,this.mimeTypeFilter=o,this.directoriesAllowed=r,this.path=a,this.filter=l,this.buttons=n,this.container=d,this.disabledNavigation=m}async pickNodes(){const{FilePickerVue:s}=await ws(async()=>{const{FilePickerVue:i}=await import("./index-BC-7VPxC-BQ4FjNB3.chunk.mjs");return{FilePickerVue:i}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);return new Promise((i,o)=>{si(s,{allowPickDirectory:this.directoriesAllowed,buttons:this.buttons,container:this.container,name:this.title,path:this.path,mimetypeFilter:this.mimeTypeFilter,multiselect:this.multiSelect,filterFn:this.filter,disabledNavigation:this.disabledNavigation},(...r)=>{const[n]=r;!Array.isArray(n)||n.length===0?o(new ri("FilePicker: No nodes selected")):i(n)})})}async pick(){const s=await this.pickNodes();return this.multiSelect?s.map(i=>i.path):s[0]?.path??"/"}}class ai{title;multiSelect=!1;mimeTypeFilter=[];directoriesAllowed=!1;path;filter;buttons=[];container;disabledNavigation=!1;constructor(s){this.title=s}setContainer(s){return this.container=s,this}setMultiSelect(s){return this.multiSelect=s,this}addMimeTypeFilter(s){return this.mimeTypeFilter.push(s),this}setMimeTypeFilter(s){return this.mimeTypeFilter=s,this}addButton(s){return typeof this.buttons=="function"&&(console.warn("FilePicker buttons were set to factory, now overwritten with button object."),this.buttons=[]),this.buttons.push(s),this}setButtonFactory(s){return this.buttons=s,this}setType(s){return this.buttons=(i,o)=>{const r=[],n=i?.[0]?.attributes?.displayName||i?.[0]?.basename,a=n||Os.basename(o);if(s===1){let l=G("Choose");i.length===1?l=G("Choose {file}",{file:n}):this.multiSelect&&(l=qs("Choose %n file","Choose %n files",i.length)),r.push({callback:()=>{},type:"primary",label:l})}return(s===4||s===3)&&r.push({callback:()=>{},label:a?G("Copy to {target}",{target:a}):G("Copy"),icon:oi,variant:s===3?"primary":"secondary"}),(s===4||s===2)&&r.push({callback:()=>{},label:a?G("Move to {target}",{target:a}):G("Move"),icon:ii,variant:"primary"}),r},this}allowDirectories(s=!0){return this.directoriesAllowed=s,this}startAt(s){return this.path=s,this}setFilter(s){return this.filter=s,this}disableNavigation(){return this.disabledNavigation=!0,this}build(){return new ni(this.title,this.multiSelect,this.mimeTypeFilter,this.directoriesAllowed,this.buttons,this.path,this.filter,this.container,this.disabledNavigation)}}function li(e){return new ai(e)}const ci={name:"LockOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var ui=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon lock-outline-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M12,17C10.89,17 10,16.1 10,15C10,13.89 10.89,13 12,13A2,2 0 0,1 14,15A2,2 0 0,1 12,17M18,20V10H6V20H18M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V10C4,8.89 4.89,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},di=[],hi=T(ci,ui,di,!1,null,null);const mi=hi.exports,fi={name:"PlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var pi=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon plus-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},gi=[],vi=T(fi,pi,gi,!1,null,null);const Qt=vi.exports,yi={name:"NcActionCaption",inject:{isInSemanticMenu:{from:"NcActions:isSemanticMenu",default:!1}},props:{name:{type:String,required:!0}}};var _i=function(){var e=this,s=e._self._c;return s("li",{staticClass:"app-navigation-caption",attrs:{role:e.isInSemanticMenu&&"presentation"}},[e._v(" "+e._s(e.name)+" ")])},bi=[],wi=st(yi,_i,bi,!1,null,"7bf21eca");const Si=wi.exports,Ci={name:"NcAppNavigationList"};var ki=function(){var e=this,s=e._self._c;return s("ul",{staticClass:"app-navigation-list"},[e._t("default")],2)},Ai=[],Ei=st(Ci,ki,Ai,!1,null,"058e6060");const xi=Ei.exports,Ni={name:"NcAppNavigation",components:{NcAppNavigationList:xi,NcAppNavigationToggle:Ss},inject:{setHasAppNavigation:{default:()=>()=>Q.util.warn("NcAppNavigation is not mounted inside NcContent, this is probably an error."),from:"NcContent:setHasAppNavigation"}},props:{ariaLabel:{type:String,default:""},ariaLabelledby:{type:String,default:""}},setup(){return{isMobile:$e()}},data(){return{open:!this.isMobile,focusTrap:null}},watch:{isMobile(){this.open=!this.isMobile,this.toggleFocusTrap()},open(){this.toggleFocusTrap()}},mounted(){this.setHasAppNavigation(!0),Vt("toggle-navigation",this.toggleNavigationByEventBus),D("navigation-toggled",{open:this.open}),this.focusTrap=zs(this.$refs.appNavigationContainer,{allowOutsideClick:!0,fallbackFocus:this.$refs.appNavigationContainer,trapStack:Us(),escapeDeactivates:!1}),this.toggleFocusTrap(),Cs("n",this.onKeyDown,{prevent:!0,stop:!0})},unmounted(){this.setHasAppNavigation(!1),Rt("toggle-navigation",this.toggleNavigationByEventBus),this.focusTrap.deactivate()},methods:{async toggleNavigation(e){if(this.open===e){D("navigation-toggled",{open:this.open});return}this.open=typeof e>"u"?!this.open:e;const s=getComputedStyle(document.body),i=parseInt(s.getPropertyValue("--animation-quick"))||100;this.open&&(await this.$nextTick(),this.focusFirstElement()),setTimeout(()=>{D("navigation-toggled",{open:this.open})},1.5*i)},toggleNavigationByEventBus({open:e}){this.toggleNavigation(e)},toggleFocusTrap(){this.isMobile&&this.open?this.focusTrap.activate():this.focusTrap.deactivate()},handleEsc(){this.isMobile&&this.open&&this.toggleNavigation(!1)},focusFirstElement(){const e=$s(this.$refs.appNavigationContainer)[0];e&&(e.focus(),ps.debug("Focusing first element in the navigation",{element:e}))},onKeyDown(e){if(e.key==="n"){if(!this.open){this.toggleNavigation(!0);return}this.isFocusWithinNavigation()&&this.toggleNavigation(!1)}},isFocusWithinNavigation(){var e;const s=document.activeElement;return(e=this.$refs.appNavigationContainer)==null?void 0:e.contains(s)}}};var Ti=function(){var e=this,s=e._self._c;return s("div",{ref:"appNavigationContainer",staticClass:"app-navigation",class:{"app-navigation--close":!e.open}},[s("nav",{staticClass:"app-navigation__content",attrs:{id:"app-navigation-vue","aria-hidden":e.open?"false":"true","aria-label":e.ariaLabel||void 0,"aria-labelledby":e.ariaLabelledby||void 0,inert:!e.open||void 0},on:{keydown:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"esc",27,i.key,["Esc","Escape"])?null:e.handleEsc.apply(null,arguments)}}},[s("div",{staticClass:"app-navigation__search"},[e._t("search")],2),s("div",{staticClass:"app-navigation__body",class:{"app-navigation__body--no-list":!e.$scopedSlots.list}},[e._t("default")],2),e.$scopedSlots.list?s("NcAppNavigationList",{staticClass:"app-navigation__list"},[e._t("list")],2):e._e(),e._t("footer")],2),s("NcAppNavigationToggle",{attrs:{open:e.open},on:{"update:open":e.toggleNavigation}})],1)},Ii=[],Li=st(Ni,Ti,Ii,!1,null,"cdba9e96");const Hi=Li.exports,Mi={name:"NcAppNavigationCaption",components:{NcActions:ot},inheritAttrs:!1,props:{name:{type:String,required:!0},headingId:{type:String,default:null},isHeading:{type:Boolean,default:!1},headingLevel:{type:Number,default:2}," ":{}},computed:{wrapperTag(){return this.isHeading?"div":"li"},captionTag(){const e=Math.max(2,this.headingLevel);return this.isHeading?"h".concat(e):"span"},hasActions(){return!!this.$slots.actions}}};var Pi=function(){var e=this,s=e._self._c;return s(e.wrapperTag,{tag:"component",staticClass:"app-navigation-caption",class:{"app-navigation-caption--heading":e.isHeading}},[s(e.captionTag,{tag:"component",staticClass:"app-navigation-caption__name",attrs:{id:e.headingId}},[e._v(" "+e._s(e.name)+" ")]),e.hasActions?s("div",{staticClass:"app-navigation-caption__actions"},[s("NcActions",e._g(e._b({scopedSlots:e._u([{key:"icon",fn:function(){return[e._t("actionsTriggerIcon")]},proxy:!0}],null,!0)},"NcActions",e.$attrs,!1),e.$listeners),[e._t("actions")],2)],1):e._e()],1)},Fi=[],Ri=st(Mi,Pi,Fi,!1,null,"fac69d4a");const Vi=Ri.exports,Bi={components:{NcButton:it},props:{buttonId:{type:String,required:!1,default:""},disabled:{type:Boolean,required:!1,default:!1},text:{type:String,required:!0},type:{type:String,default:"primary",validator(e){return["primary","secondary","tertiary"].indexOf(e)!==-1}},variant:{type:String,default:"primary",validator(e){return["primary","secondary","tertiary"].indexOf(e)!==-1}}},emits:["click"]};var Di=function(){var e=this,s=e._self._c;return s("div",{staticClass:"app-navigation-new"},[s("NcButton",{attrs:{id:e.buttonId,disabled:e.disabled,variant:e.type!=="primary"?e.type:e.variant},on:{click:function(i){return e.$emit("click")}},scopedSlots:e._u([{key:"icon",fn:function(){return[e._t("icon")]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.text)+" ")])],1)},Oi=[],qi=st(Bi,Di,Oi,!1,null,"6f255eb3");const $i=qi.exports,zi={name:"NcAppSidebarTab",inject:["registerTab","unregisterTab","getActiveTab","isTablistShown"],props:{id:{type:String,required:!0},name:{type:String,required:!0},icon:{type:String,default:""},order:{type:Number,default:0}},emits:["bottom-reached","scroll"],expose:["id","name","icon","order","renderIcon"],computed:{isActive(){return this.getActiveTab()===this.id}},created(){this.registerTab(this)},beforeDestroy(){this.unregisterTab(this.id)},methods:{onScroll(e){this.$el.scrollHeight-this.$el.scrollTop===this.$el.clientHeight&&this.$emit("bottom-reached",e),this.$emit("scroll",e)},renderIcon(){var e,s;return(s=(e=this.$scopedSlots).icon)==null?void 0:s.call(e)}}};var Ui=function(){var e=this,s=e._self._c;return s("section",{staticClass:"app-sidebar__tab",class:{"app-sidebar__tab--active":e.isActive},attrs:{id:"tab-".concat(e.id),"aria-hidden":!e.isActive,"aria-label":e.isTablistShown()?void 0:e.name,"aria-labelledby":e.isTablistShown()?"tab-button-".concat(e.id):void 0,tabindex:e.isTablistShown()?0:-1,role:e.isTablistShown()?"tabpanel":void 0},on:{scroll:e.onScroll}},[s("h3",{staticClass:"hidden-visually"},[e._v(" "+e._s(e.name)+" ")]),e._t("default")],2)},Yi=[],Qi=st(zi,Ui,Yi,!1,null,"bc553f62");const ji=Qi.exports;window.axios=M;const Zi={name:"Create",components:{Draggable:Ns,IconLock:mi,IconPlus:Qt,NcActionButton:rt,NcActions:ot,NcAppContent:Ut,NcEmptyContent:zt,NcLoadingIcon:_t,NcNoteCard:Ot,Question:xs,QuestionLong:Es,QuestionShort:As,QuestionMultiple:ks,TopBar:Ue},mixins:[Dt],data(){return{answerTypes:ct,isLoadingQuestions:!1,isDragging:!1,maxStringLengths:et("forms","maxStringLengths"),questionMenuOpened:!1}},computed:{hasQuestions(){return this.form.questions&&this.form.questions.length===0},isRequiredUsed(){return this.form.questions.reduce((e,s)=>e||s.isRequired,!1)},isExpired(){return this.form.expires&&R().unix()>this.form.expires},isFormArchived(){return this.form.state===B.FormArchived},infoMessage(){let e="";return this.form.isAnonymous&&(e+=t("forms","Responses are anonymous.")),this.form.isAnonymous||(e+=t("forms","Responses are connected to your account.")),this.isRequiredUsed&&(e+=" "+t("forms","An asterisk (*) indicates mandatory questions.")),e},expirationMessage(){const e=R(this.form.expires,"X").fromNow();return this.isExpired?t("forms","Expired {relativeDate}.",{relativeDate:e}):t("forms","Expires {relativeDate}.",{relativeDate:e})},answerTypesFilter(){const{datetime:e,...s}=ct;return s},lockedUntilFormatted(){return R(this.form.lockedUntil,"X").fromNow()}},watch:{hash(){this.fetchFullForm(this.form.id)},"form.title"(){vt(this.formTitle)},isLoadingForm(e){e||(this.resizeTitle(),this.resizeDescription())}},mounted(){this.fetchFullForm(this.form.id),vt(this.formTitle)},methods:{onMoveUp(e){e>0&&([this.form.questions[e-1],this.form.questions[e]]=[this.form.questions[e],this.form.questions[e-1]],this.onQuestionOrderChange())},onMoveDown(e){e<this.form.questions.length-1&&this.onMoveUp(e+1)},onTitleChange(){this.resizeTitle(),this.saveTitle()},resizeTitle(){this.$nextTick(()=>{const e=this.$refs.title;e.style.cssText="height: 0",e.style.cssText=`height: ${e.scrollHeight+4}px`})},resizeDescription(){this.$nextTick(()=>{const e=this.$refs.description;e.style.cssText="height: 0",e.style.cssText=`height: ${e.scrollHeight+4}px`})},updateDescription({target:e}){this.form.description=e.value,this.resizeDescription(),this.saveDescription()},saveTitle:pt(async function(){this.saveFormProperty("title")},gt),saveDescription:pt(async function(){this.saveFormProperty("description")},gt),async addQuestion(e){const s="";this.isLoadingQuestions=!0;try{const i=await M.post(H("apps/forms/api/v3/forms/{id}/questions",{id:this.form.id}),{type:e,text:s}),o=O(i);this.form.questions.push(Object.assign({text:s,type:e,answers:[]},o)),this.$nextTick(()=>{this.$refs.questions[this.$refs.questions.length-1].focus()}),D("forms:last-updated:set",this.form.id)}catch(i){I.error("Error while adding new question",{error:i}),F(t("forms","There was an error while adding the new question"))}finally{this.isLoadingQuestions=!1}},async deleteQuestion(e){this.isLoadingQuestions=!0;try{await M.delete(H("apps/forms/api/v3/forms/{id}/questions/{questionId}",{id:this.form.id,questionId:e}));const s=this.form.questions.findIndex(i=>i.id===e);this.form.questions.splice(s,1),D("forms:last-updated:set",this.form.id)}catch(s){I.error(`Error while removing question ${e}`,{error:s}),F(t("forms","There was an error while removing the question"))}finally{this.isLoadingQuestions=!1}},async cloneQuestion({id:e}){this.isLoadingQuestions=!0;try{const s=await M.post(H("apps/forms/api/v3/forms/{id}/questions?fromId={questionId}",{id:this.form.id,questionId:e})),i=O(s);this.form.questions.push(Object.assign({answers:[]},i)),this.$nextTick(()=>{this.$refs.questions[this.$refs.questions.length-1].focus()})}catch(s){I.error(`Error while duplicating question ${e}`,{error:s}),F("There was an error while duplicating the question")}finally{this.isLoadingQuestions=!1}},async onQuestionOrderChange(){this.isLoadingQuestions=!0;const e=this.form.questions.map(s=>s.id);try{await M.patch(H("apps/forms/api/v3/forms/{id}/questions",{id:this.form.id}),{newOrder:e}),D("forms:last-updated:set",this.form.id)}catch(s){I.error("Error while saving form",{error:s}),F(t("forms","Error while saving form"))}finally{this.isLoadingQuestions=!1}}}};var Ki=function(){var e=this,s=e._self._c;return s("NcAppContent",{attrs:{"page-heading":e.form.title?e.t("forms","Edit form"):e.t("forms","Create form")}},[s("TopBar",{attrs:{archived:e.isFormArchived,locked:e.isFormLocked,permissions:e.form?.permissions,"sidebar-opened":e.sidebarOpened,"submission-count":e.form?.submissionCount},on:{"share-form":e.onShareForm}}),e.isLoadingForm?s("NcEmptyContent",{staticClass:"emtpycontent",attrs:{name:e.t("forms","Loading {title} â€¦",{title:e.form.title})},scopedSlots:e._u([{key:"icon",fn:function(){return[s("NcLoadingIcon",{attrs:{size:64}})]},proxy:!0}],null,!1,826850984)}):e.isFormArchived?s("NcEmptyContent",{staticClass:"emtpycontent",attrs:{name:e.t("forms","Form is archived"),description:e.t("forms","Form '{title}' is archived and cannot be modified.",{title:e.form.title})},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconLock",{attrs:{size:64}})]},proxy:!0}])}):e.isFormLocked?s("NcEmptyContent",{staticClass:"emtpycontent",attrs:{name:e.t("forms","Form is locked"),description:e.t("forms","Form '{title}' is locked by {lockedBy} and cannot be modified. The lock expires: {lockedUntil}",{title:e.form.title,lockedBy:e.form.lockedBy,lockedUntil:e.form.lockedUntil===0?e.t("forms","never"):e.lockedUntilFormatted})},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconLock",{attrs:{size:64}})]},proxy:!0}])}):[s("header",[s("h2",[s("label",{staticClass:"hidden-visually",attrs:{for:"form-title"}},[e._v(e._s(e.t("forms","Form title")))]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.form.title,expression:"form.title"}],ref:"title",staticClass:"form-title",attrs:{id:"form-title",rows:"1",dir:"auto",maxlength:e.maxStringLengths.formTitle,placeholder:e.t("forms","Form title"),required:"",autofocus:""},domProps:{value:e.form.title},on:{input:[function(i){i.target.composing||e.$set(e.form,"title",i.target.value)},e.onTitleChange]}})]),s("label",{staticClass:"hidden-visually",attrs:{for:"form-desc"}},[e._v(" "+e._s(e.t("forms","Description"))+" ")]),s("textarea",{ref:"description",staticClass:"form-desc",attrs:{id:"form-desc",rows:"1",dir:"auto",placeholder:e.t("forms","Description (formatting using Markdown is supported)"),maxlength:e.maxStringLengths.formDescription},domProps:{value:e.form.description},on:{input:e.updateDescription}}),e._v(" "),e.form.expires&&e.form.showExpiration?s("p",{staticClass:"info-message"},[e._v(" "+e._s(e.expirationMessage)+" ")]):e._e(),e.infoMessage?s("p",{staticClass:"info-message"},[e._v(" "+e._s(e.infoMessage)+" ")]):e._e()]),s("section",[s("Draggable",{attrs:{animation:200,tag:"ul",handle:".question__drag-handle"},on:{change:e.onQuestionOrderChange,start:function(i){e.isDragging=!0},end:function(i){e.isDragging=!1}},model:{value:e.form.questions,callback:function(i){e.$set(e.form,"questions",i)},expression:"form.questions"}},[s("transition-group",{attrs:{name:e.isDragging?"no-external-transition-on-drag":"question-list"}},e._l(e.form.questions,function(i,o){return s(e.answerTypes[i.type].component,e._b({key:i.id,ref:"questions",refInFor:!0,tag:"component",attrs:{"can-move-down":o<e.form.questions.length-1,"can-move-up":o>0,"answer-type":e.answerTypes[i.type],index:o+1,"max-string-lengths":e.maxStringLengths},on:{clone:function(r){return e.cloneQuestion(i)},delete:function(r){return e.deleteQuestion(i.id)},"move-down":function(r){return e.onMoveDown(o)},"move-up":function(r){return e.onMoveUp(o)}}},"component",e.form.questions[o],!1,!0))}),1)],1),s("div",{staticClass:"question-menu"},[s("NcActions",{ref:"questionMenu",attrs:{open:e.questionMenuOpened,"menu-name":e.t("forms","Add a question"),"aria-label":e.t("forms","Add a question"),primary:""},on:{"update:open":function(i){e.questionMenuOpened=i}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.isLoadingQuestions?s("NcLoadingIcon",{attrs:{size:20}}):s("IconPlus",{attrs:{size:20}})]},proxy:!0}])},e._l(e.answerTypesFilter,function(i,o){return s("NcActionButton",{key:i.label,staticClass:"question-menu__question",attrs:{"close-after-click":"",disabled:e.isLoadingQuestions},on:{click:function(r){return e.addQuestion(o)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s(i.icon,{tag:"Icon",attrs:{size:20}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(i.label)+" ")])}),1)],1)],1)]],2)},Wi=[],Ji=T(Zi,Ki,Wi,!1,null,"1e902324");const Gi=Ji.exports,Xe='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-delete" viewBox="0 0 24 24"><path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" /></svg>',Xi={name:"TrayArrowDownIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var to=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon tray-arrow-down-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M2 12H4V17H20V12H22V17C22 18.11 21.11 19 20 19H4C2.9 19 2 18.11 2 17V12M12 15L17.55 9.54L16.13 8.13L13 11.25V2H11V11.25L7.88 8.13L6.46 9.55L12 15Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},eo=[],so=T(Xi,to,eo,!1,null,null);const io=so.exports,oo={name:"FileDelimitedOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var ro=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon file-delimited-outline-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2M18 20H6V4H13V9H18V20M10 19L12 15H9V10H15V15L13 19H10"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},no=[],ao=T(oo,ro,no,!1,null,null);const lo=ao.exports,ts='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-file-delimited-outline" viewBox="0 0 24 24"><path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2M18 20H6V4H13V9H18V20M10 19L12 15H9V10H15V15L13 19H10" /></svg>',co={name:"FileExcelOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var uo=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon file-excel-outline-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M14 2H6C4.89 2 4 2.9 4 4V20C4 21.11 4.89 22 6 22H18C19.11 22 20 21.11 20 20V8L14 2M18 20H6V4H13V9H18V20M12.9 14.5L15.8 19H14L12 15.6L10 19H8.2L11.1 14.5L8.2 10H10L12 13.4L14 10H15.8L12.9 14.5Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},ho=[],mo=T(co,uo,ho,!1,null,null);const fo=mo.exports,es='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-file-excel-outline" viewBox="0 0 24 24"><path d="M14 2H6C4.89 2 4 2.9 4 4V20C4 21.11 4.89 22 6 22H18C19.11 22 20 21.11 20 20V8L14 2M18 20H6V4H13V9H18V20M12.9 14.5L15.8 19H14L12 15.6L10 19H8.2L11.1 14.5L8.2 10H10L12 13.4L14 10H15.8L12.9 14.5Z" /></svg>',po={name:"FolderOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var go=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon folder-outline-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M20,18H4V8H20M20,6H12L10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},vo=[],yo=T(po,go,vo,!1,null,null);const _o=yo.exports,bo={name:"LinkIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var wo=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon link-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M3.9,12C3.9,10.29 5.29,8.9 7,8.9H11V7H7A5,5 0 0,0 2,12A5,5 0 0,0 7,17H11V15.1H7C5.29,15.1 3.9,13.71 3.9,12M8,13H16V11H8V13M17,7H13V8.9H17C18.71,8.9 20.1,10.29 20.1,12C20.1,13.71 18.71,15.1 17,15.1H13V17H17A5,5 0 0,0 22,12A5,5 0 0,0 17,7Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},So=[],Co=T(bo,wo,So,!1,null,null);const ss=Co.exports,ko='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-link" viewBox="0 0 24 24"><path d="M3.9,12C3.9,10.29 5.29,8.9 7,8.9H11V7H7A5,5 0 0,0 2,12A5,5 0 0,0 7,17H11V15.1H7C5.29,15.1 3.9,13.71 3.9,12M8,13H16V11H8V13M17,7H13V8.9H17C18.71,8.9 20.1,10.29 20.1,12C20.1,13.71 18.71,15.1 17,15.1H13V17H17A5,5 0 0,0 22,12A5,5 0 0,0 17,7Z" /></svg>',Ao={name:"LinkOffIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Eo=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon link-off-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M17,7H13V8.9H17C18.71,8.9 20.1,10.29 20.1,12C20.1,13.43 19.12,14.63 17.79,15L19.25,16.44C20.88,15.61 22,13.95 22,12A5,5 0 0,0 17,7M16,11H13.81L15.81,13H16V11M2,4.27L5.11,7.38C3.29,8.12 2,9.91 2,12A5,5 0 0,0 7,17H11V15.1H7C5.29,15.1 3.9,13.71 3.9,12C3.9,10.41 5.11,9.1 6.66,8.93L8.73,11H8V13H10.73L13,15.27V17H14.73L18.74,21L20,19.74L3.27,3L2,4.27Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},xo=[],No=T(Ao,Eo,xo,!1,null,null);const To=No.exports,Io='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-link-off" viewBox="0 0 24 24"><path d="M17,7H13V8.9H17C18.71,8.9 20.1,10.29 20.1,12C20.1,13.43 19.12,14.63 17.79,15L19.25,16.44C20.88,15.61 22,13.95 22,12A5,5 0 0,0 17,7M16,11H13.81L15.81,13H16V11M2,4.27L5.11,7.38C3.29,8.12 2,9.91 2,12A5,5 0 0,0 7,17H11V15.1H7C5.29,15.1 3.9,13.71 3.9,12C3.9,10.41 5.11,9.1 6.66,8.93L8.73,11H8V13H10.73L13,15.27V17H14.73L18.74,21L20,19.74L3.27,3L2,4.27Z" /></svg>',Lo={name:"PollIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Ho=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon poll-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M3,22V8H7V22H3M10,22V2H14V22H10M17,22V14H21V22H17Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},Mo=[],Po=T(Lo,Ho,Mo,!1,null,null);const is=Po.exports,Fo={name:"RefreshIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Ro=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon refresh-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},Vo=[],Bo=T(Fo,Ro,Vo,!1,null,null);const Do=Bo.exports,Oo={name:"TableIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var qo=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon table-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M5,4H19A2,2 0 0,1 21,6V18A2,2 0 0,1 19,20H5A2,2 0 0,1 3,18V6A2,2 0 0,1 5,4M5,8V12H11V8H5M13,8V12H19V8H13M5,14V18H11V14H5M13,14V18H19V14H13Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},$o=[],zo=T(Oo,qo,$o,!1,null,null);const Uo=zo.exports,os='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-table" viewBox="0 0 24 24"><path d="M5,4H19A2,2 0 0,1 21,6V18A2,2 0 0,1 19,20H5A2,2 0 0,1 3,18V6A2,2 0 0,1 5,4M5,8V12H11V8H5M13,8V12H19V8H13M5,14V18H11V14H5M13,14V18H19V14H13Z" /></svg>',Yo={name:"MagnifyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Qo=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon magnify-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},jo=[],Zo=T(Yo,Qo,jo,!1,null,null);const Ko=Zo.exports,Wo={name:"ResultsSummary",components:{IconFile:Ye},props:{submissions:{type:Array,required:!0},question:{type:Object,required:!0}},data(){return{answerTypes:ct}},computed:{questionTypeLabel(){const e=this.answerTypes[this.question.type].label;if(this.question.type==="linearscale"){const s=this.question.extraSettings?.optionsLabelLowest??t("forms","Strongly disagree"),i=this.question.extraSettings?.optionsLabelHighest??t("forms","Strongly agree"),o=this.question.extraSettings?.optionsLowest?.toString()??"1",r=this.question.extraSettings?.optionsHighest?.toString()??"5",n=[];s!==""&&n.push(`${o}: ${s}`),i!==""&&n.push(`${r}: ${i}`);const a=` (${n.join(", ")})`;return e+a}return e},questionOptions(){let e;return this.question.type!=="linearscale"?e=this.question.options.map(s=>({...s,count:0,percentage:0})):e=Array.from({length:(this.question.extraSettings?.optionsHighest??5)-(this.question.extraSettings?.optionsLowest??1)+1},(s,i)=>({text:(i+(this.question.extraSettings?.optionsLowest??1)).toString(),count:0,percentage:0})),this.question.extraSettings?.allowOtherAnswer&&e.unshift({text:t("forms","Other"),count:0,percentage:0}),e.unshift({text:t("forms","No response"),count:0,percentage:0}),this.submissions.forEach(s=>{const i=s.answers.filter(o=>o.questionId===this.question.id);i.length||e[0].count++,i.forEach(o=>{const r=e.findIndex(n=>n.text===o.text);r<0?this.question.extraSettings?.allowOtherAnswer?e[1].count++:e.push({text:o.text,count:1,percentage:0}):e[r].count++})}),this.question.type!=="linearscale"?e.sort((s,i)=>i.count-s.count):e.push(e.shift()),e.forEach(s=>{s.percentage=Math.round(100*s.count/this.submissions.length);const i=Math.max(...e.map(o=>o.count));s.best=s.count===i}),e},answers(){const e=[];let s=0;this.submissions.forEach(o=>{const r=o.answers.filter(n=>n.questionId===this.question.id);r.length||s++,["date","time"].includes(this.question.type)&&r.length===2?e.push({id:`${r[0].id}-${r[1].id}`,text:`${r[0].text} - ${r[1].text}`}):r.forEach(n=>{n.fileId?e.push({id:n.id,text:n.text,url:Z("/f/{fileId}",{fileId:n.fileId})}):e.push({id:n.id,text:n.text})})});const i=Math.round(100*s/this.submissions.length);return e.unshift({id:0,text:s+" ("+i+"%): "+t("forms","No response")}),e}}};var Jo=function(){var e=this,s=e._self._c;return s("div",{staticClass:"section question-summary"},[s("h3",{attrs:{dir:"auto"}},[e._v(" "+e._s(e.question.text)+" ")]),s("p",{staticClass:"question-summary__detail"},[e._v(" "+e._s(e.questionTypeLabel)+" ")]),e.answerTypes[e.question.type].predefined?s("ol",{staticClass:"question-summary__statistic"},e._l(e.questionOptions,function(i){return s("li",{key:i.id},[s("label",{attrs:{for:`option-${i.questionId}-${i.id}`}},[e._v(" "+e._s(i.count)+" "),s("span",{staticClass:"question-summary__statistic-percentage"},[e._v(" ("+e._s(i.percentage)+"%): ")]),s("span",{class:{"question-summary__statistic-text--best":i.best}},[e._v(" "+e._s(i.text)+" ")])]),s("meter",{attrs:{id:`option-${i.questionId}-${i.id}`,min:"0",max:e.submissions.length,value:i.count}})])}),0):s("ul",{staticClass:"question-summary__text"},e._l(e.answers,function(i,o){return s("li",{key:i.id,attrs:{dir:"auto"}},[i.url?[s("a",{attrs:{href:i.url,target:"_blank"}},[s("IconFile",{staticClass:"question-summary__text-icon",attrs:{size:20}}),e._v(" "+e._s(i.text)+" ")],1)]:e.question.type==="color"?[s("div",{staticClass:"color__result"},[i.id!==0?s("div",{class:o===1?"color__field color__field__first":"color__field",style:{"background-color":i.text}}):e._e(),e._v(" "+e._s(i.text)+" ")])]:[e._v(" "+e._s(i.text)+" ")]],2)}),0)])},Go=[],Xo=T(Wo,Jo,Go,!1,null,"28e1727e");const tr=Xo.exports,er={name:"Answer",components:{IconFile:Ye,NcHighlight:Ys},props:{answers:{type:Array,required:!1,default:()=>[]},answerText:{type:String,required:!1,default:""},questionText:{type:String,required:!0},questionType:{type:String,required:!0},highlight:{type:String,required:!1,default:""}}};var sr=function(){var e=this,s=e._self._c;return s("div",{staticClass:"answer"},[s("h4",{staticClass:"answer__question-text",attrs:{dir:"auto"}},[e._v(" "+e._s(e.questionText)+" ")]),e.answers.length?e._l(e.answers,function(i){return s("p",{key:i.id,staticClass:"answer__text",attrs:{dir:"auto"}},[s("a",{attrs:{href:i.url,target:"_blank"}},[s("IconFile",{staticClass:"answer__text-icon",attrs:{size:20}}),s("NcHighlight",{attrs:{text:i.text,search:e.highlight}})],1)])}):e.questionType==="color"?[s("div",{staticClass:"color__result"},[s("div",{staticClass:"color__field",style:{"background-color":e.answerText}}),s("NcHighlight",{attrs:{text:e.answerText,search:e.highlight}})],1)]:s("p",{staticClass:"answer__text",attrs:{dir:"auto"}},[s("NcHighlight",{attrs:{text:e.answerText,search:e.highlight}})],1)],2)},ir=[],or=T(er,sr,ir,!1,null,"5ba1c200");const rr=or.exports,nr={name:"Submission",components:{Answer:rr,IconDelete:yt,IconPencil:Qe,NcActions:ot,NcActionButton:rt,NcActionRouter:Je},props:{formHash:{type:String,required:!0},submission:{type:Object,required:!0},questions:{type:Array,required:!0},canDeleteSubmission:{type:Boolean,required:!0},canEditSubmission:{type:Boolean,required:!0},highlight:{type:String,default:null}},computed:{submissionDateTime(){return R(this.submission.timestamp,"X").format("LLLL")},answeredQuestions(){const e=[];return this.questions.forEach(s=>{const i=this.submission.answers.filter(o=>o.questionId===s.id);if(i.length)if(s.type==="file")e.push({id:s.id,text:s.text,type:s.type,answers:i.map(o=>({id:o.id,text:o.text,url:Z("/f/{fileId}",{fileId:o.fileId})}))});else if(["date","time"].includes(s.type)){const o=i.map(r=>r.text).join(" - ");e.push({id:s.id,text:s.text,type:s.type,squashedAnswers:o})}else{const o=i.map(r=>r.text).join("; ");e.push({id:s.id,text:s.text,type:s.type,squashedAnswers:o})}}),e}},methods:{onDelete(){this.$emit("delete")}}};var ar=function(){var e=this,s=e._self._c;return s("div",{staticClass:"section submission"},[s("div",{staticClass:"submission-head"},[s("h3",{attrs:{dir:"auto"}},[e._v(" "+e._s(e.submission.userDisplayName)+" ")]),s("NcActions",{staticClass:"submission-menu",attrs:{"force-menu":""}},[e.canEditSubmission?s("NcActionRouter",{attrs:{to:{name:"submit",params:{hash:e.formHash,submissionId:e.submission.id}}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconPencil",{attrs:{size:20}})]},proxy:!0}],null,!1,291764094)},[e._v(" "+e._s(e.t("forms","Edit this response"))+" ")]):e._e(),e.canDeleteSubmission?s("NcActionButton",{on:{click:e.onDelete},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconDelete",{attrs:{size:20}})]},proxy:!0}],null,!1,881161434)},[e._v(" "+e._s(e.t("forms","Delete this response"))+" ")]):e._e()],1)],1),s("p",{staticClass:"submission-date"},[e._v(" "+e._s(e.submissionDateTime)+" ")]),e._l(e.answeredQuestions,function(i){return s("Answer",{key:i.id,attrs:{highlight:e.highlight,"answer-text":i.squashedAnswers,answers:i.answers,"question-text":i.text,"question-type":i.type}})})],2)},lr=[],cr=T(nr,ar,lr,!1,null,"5187ff48");const ur=cr.exports,dr={name:"ChevronRightIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var hr=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon chevron-right-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},mr=[],fr=T(dr,hr,mr,!1,null,null);const pr=fr.exports,gr={name:"PageFirstIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var vr=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon page-first-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M18.41,16.59L13.82,12L18.41,7.41L17,6L11,12L17,18L18.41,16.59M6,6H8V18H6V6Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},yr=[],_r=T(gr,vr,yr,!1,null,null);const br=_r.exports,wr={name:"PageLastIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Sr=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon page-last-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M5.59,7.41L10.18,12L5.59,16.59L7,18L13,12L7,6L5.59,7.41M16,6H18V18H16V6Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},Cr=[],kr=T(wr,Sr,Cr,!1,null,null);const Ar=kr.exports,Er={name:"PaginationToolbar",components:{IconChevronLeft:je,IconChevronRight:pr,NcButton:it,NcSelect:Qs,PageFirstIcon:br,PageLastIcon:Ar},props:{totalItemsCount:{type:Number,required:!0},limit:{type:Number,default:20},offset:{type:Number,default:0}},emits:["update:offset"],computed:{allPageNumbersArray(){return Array.from({length:this.totalPages},(e,s)=>1+s)},totalPages(){return Math.max(1,Math.ceil(this.totalItemsCount/this.limit))},pageNumber:{get(){return Math.floor(this.offset/this.limit)+1},set(e){this.$emit("update:offset",(e-1)*this.limit)}}}};var xr=function(){var e=this,s=e._self._c;return s("div",{staticClass:"pagination-block"},[s("div",{staticClass:"pagination-items"},[s("NcButton",{attrs:{type:"tertiary",disabled:e.totalPages===1||e.pageNumber<=1,"aria-label":e.t("forms","Go to first page")},on:{click:function(i){e.pageNumber=1}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("PageFirstIcon",{attrs:{size:20}})]},proxy:!0}])}),s("NcButton",{attrs:{type:"tertiary",disabled:e.totalPages===1||e.pageNumber<=1,"aria-label":e.t("forms","Go to previous page")},on:{click:function(i){e.pageNumber--}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconChevronLeft",{attrs:{size:20}})]},proxy:!0}])}),s("div",{staticClass:"page-number"},[s("NcSelect",{attrs:{options:e.allPageNumbersArray,"aria-label-combobox":e.t("forms","Page number")},scopedSlots:e._u([{key:"selected-option-container",fn:function({option:i}){return[s("span",{staticClass:"selected-page"},[e._v(" "+e._s(e.t("forms","{page} of {totalPages}",{page:i.label,totalPages:e.totalPages}))+" ")])]}}]),model:{value:e.pageNumber,callback:function(i){e.pageNumber=i},expression:"pageNumber"}})],1),s("NcButton",{attrs:{type:"tertiary",disabled:e.totalPages===1||e.pageNumber>=e.totalPages,"aria-label":e.t("forms","Go to next page")},on:{click:function(i){e.pageNumber++}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconChevronRight",{attrs:{size:20}})]},proxy:!0}])}),s("NcButton",{attrs:{type:"tertiary",disabled:e.totalPages===1||e.pageNumber>=e.totalPages,"aria-label":e.t("forms","Go to last page")},on:{click:function(i){e.pageNumber=e.totalPages}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("PageLastIcon",{attrs:{size:20}})]},proxy:!0}])})],1)])},Nr=[],Tr=T(Er,xr,Nr,!1,null,"b3033246");const Ir=Tr.exports,Xt={ods:os,csv:ts,xlsx:es};let X="csv";const te=[{title:t("forms","Summary"),id:"summary"},{title:t("forms","Responses"),id:"responses"}],Lr={name:"Results",components:{IconChevronLeft:je,IconDelete:yt,IconDownload:io,IconFileDelimited:lo,IconFileExcelOutline:fo,IconFolder:_o,IconLink:ss,IconLinkVariantOff:To,IconPoll:is,IconRefresh:Do,IconShareVariant:$t,IconTable:Uo,NcActionButton:rt,NcActionSeparator:qt,NcActions:ot,NcAppContent:Ut,NcButton:it,NcDialog:dt,NcTextField:Ze,PaginationToolbar:Ir,IconMagnify:Ko,NcEmptyContent:zt,NcLoadingIcon:_t,PillMenu:Ts,ResultsSummary:tr,Submission:ur,TopBar:Ue},mixins:[ut,Dt],setup(){return{isMobile:vs(),responseViews:te}},data(){return{activeResponseView:te[0],questions:[],submissions:[],filteredSubmissionsCount:0,isDownloadActionOpened:!1,loadingResults:!0,skipReloadOnOffsetChange:!1,picker:null,showConfirmDeleteDialog:!1,submissionSearch:"",limit:20,offset:0,linkedFileNotAvailableButtons:[{label:t("forms","Unlink spreadsheet"),icon:Io,type:"error",callback:()=>{this.onUnlinkFile()}},{label:t("forms","Create spreadsheet"),icon:ko,type:"primary",callback:()=>{this.onLinkFile()}}],confirmDeleteButtons:[{label:t("forms","Cancel"),icon:Is,type:"tertiary",callback:()=>{this.showConfirmDeleteDialog=!1}},{label:t("forms","Delete submissions"),icon:Xe,type:"error",callback:()=>{this.deleteAllSubmissionsConfirmed()}}]}},computed:{isFormArchived(){return this.form.state===B.FormArchived},canDeleteSubmissions(){return this.form.permissions.includes(this.PERMISSION_TYPES.PERMISSION_RESULTS_DELETE)&&!this.isFormArchived},canEditForm(){return this.form.permissions.includes(this.PERMISSION_TYPES.PERMISSION_EDIT)},noSubmissions(){return this.form?.submissionCount===0},noFilteredSubmissions(){return this.submissions.length===0},fileUrl(){return this.form.fileId?Z("/f/{fileId}",{fileId:this.form.fileId}):window.location.href},showLinkedFileNotAvailableDialog(){return this.form.partial?!1:this.canEditForm&&this.form.fileId&&!this.form.filePath&&!this.isFormLocked}},watch:{async hash(){await this.fetchFullForm(this.form.id),this.loadFormResults(),vt(this.formTitle)},limit(){this.loadFormResults()},offset(){this.skipReloadOnOffsetChange||this.loadFormResults()},submissionSearch:pt(function(){this.skipReloadOnOffsetChange=!0,this.offset=0,this.$nextTick(()=>{this.skipReloadOnOffsetChange=!1}),this.loadFormResults()},gt)},async beforeMount(){await this.fetchFullForm(this.form.id),this.loadFormResults(),vt(this.formTitle)},methods:{async onUnlinkFile(){await M.patch(H("apps/forms/api/v3/forms/{formId}",{formId:this.form.id}),{keyValuePairs:{fileId:null,fileFormat:null}});const e={...this.form,fileFormat:null,fileId:null,filePath:null};this.$emit("update:form",e),D("forms:last-updated:set",this.form.id)},async loadFormResults(){this.loadingResults=!0,I.debug(`Loading results for form ${this.form.hash}`);try{let e=null;this.activeResponseView.id==="summary"?e=await M.get(H("apps/forms/api/v3/forms/{id}/submissions",{id:this.form.id})):e=await M.get(H("apps/forms/api/v3/forms/{id}/submissions?limit={limit}&offset={offset}&query={query}",{id:this.form.id,limit:this.limit,offset:this.offset,query:this.submissionSearch}));const s=O(e);this.submissions=this.formatDateAnswers(s.submissions,s.questions),this.questions=s.questions,this.filteredSubmissionsCount=s.filteredSubmissionsCount}catch(e){I.error("Error while loading results",{error:e}),F(t("forms","There was an error while loading the results"))}finally{this.loadingResults=!1}},async onDownloadFile(e){const s=H("apps/forms/api/v3/forms/{id}/submissions",{id:this.form.id})+"?requesttoken="+encodeURIComponent(gs())+"&fileFormat="+e;window.open(s,"_self")},async onLinkFile(){try{await this.getPicker().pick().then(async e=>{try{await M.patch(H("apps/forms/api/v3/forms/{id}",{id:this.form.id}),{keyValuePairs:{path:e,fileFormat:X}}),await this.fetchFullForm(this.form.id),await this.loadFormResults(),j(t("forms","File {file} successfully linked",{file:this.form.filePath.split("/").pop()})),D("forms:last-updated:set",this.form.id)}catch(s){I.error("Error while exporting to Files and linking",{error:s}),F(t("forms","There was an error while linking the file"))}})}catch(e){I.debug("No file selected",{error:e})}},async onStoreToFiles(){try{await this.getPicker().pick().then(async e=>{try{const s=await M.post(H("apps/forms/api/v3/forms/{id}/submissions/export",{id:this.form.id}),{path:e,fileFormat:X});j(t("forms","Export successful to {file}",{file:O(s)}))}catch(s){I.error("Error while exporting to Files",{error:s}),F(t("forms","There was an error while exporting to Files"))}})}catch(e){I.debug("No file selected",{error:e})}},async onReExport(){if(!this.form.fileId){F(t("forms","File is not linked"));return}try{const e=await M.post(H("apps/forms/api/v3/forms/{id}/submissions/export",{id:this.form.id}),{path:this.form.filePath,fileFormat:this.form.fileFormat});j(t("forms","Export successful to {file}",{file:O(e)}))}catch(e){I.error("Error while exporting to Files",{error:e}),F(t("forms","There was an error, while exporting to Files"))}},canDeleteSubmission(e){return this.canDeleteSubmissions||this.form.allowEditSubmissions&&lt().uid===e},canEditSubmission(e){return this.form.allowEditSubmissions&&lt().uid===e},async deleteSubmission(e){this.loadingResults=!0;try{await M.delete(H("apps/forms/api/v3/forms/{id}/submissions/{submissionId}",{id:this.form.id,submissionId:e})),j(t("forms","Submission deleted"));const s=this.submissions.findIndex(i=>i.id===e);this.submissions.splice(s,1),D("forms:last-updated:set",this.form.id)}catch(s){I.error(`Error while removing response ${e}`,{error:s}),F(t("forms","There was an error while removing this response"))}finally{this.loadingResults=!1}},deleteAllSubmissions(){this.showConfirmDeleteDialog=!0},async deleteAllSubmissionsConfirmed(){this.showConfirmDeleteDialog=!1,this.loadingResults=!0;try{await M.delete(H("apps/forms/api/v3/forms/{id}/submissions",{id:this.form.id})),this.submissions=[],D("forms:last-updated:set",this.form.id)}catch(e){I.error("Error while removing responses",{error:e}),F(t("forms","There was an error while removing responses"))}finally{this.loadingResults=!1}},formatDateAnswers(e,s){const i=Object.fromEntries(s.filter(o=>o.type==="date"|o.type==="datetime"|o.type==="time").map(o=>[o.id,o.type]));return e.forEach(o=>{o.answers.filter(r=>r.questionId in i).forEach(r=>{const n=R(r.text,ct[i[r.questionId]].storageFormat);n.isValid()&&(r.text=n.format(ct[i[r.questionId]].momentFormat))})}),e},getPicker(){return this.picker!==null?this.picker:(this.picker=li(t("forms","Choose spreadsheet location")).setMultiSelect(!1).allowDirectories(!0).setButtonFactory((e,s,i)=>{if(e.length===1){const o=e[0].extension?.slice(1)?.toLowerCase();if(o){if(Xt[o])return[{label:t("forms","Select {file}",{file:e[0].basename}),icon:Xt[o],callback(){X=o},type:"primary"}]}else return[{label:t("forms","Create XLSX"),icon:es,callback(){X="xlsx"},type:"secondary"},{label:t("forms","Create CSV"),icon:ts,callback(){X="csv"},type:"secondary"},{label:t("forms","Create ODS"),icon:os,callback(){X="ods"},type:"primary"}]}return[]}).build(),this.picker)}}};var Hr=function(){var e=this,s=e._self._c;return s("NcAppContent",{attrs:{"page-heading":e.t("forms","Results")}},[s("NcDialog",{attrs:{open:e.showLinkedFileNotAvailableDialog,name:e.t("forms","Linked file not available"),message:e.t("forms","Linked file is not available, would you like to link a new file?"),buttons:e.linkedFileNotAvailableButtons,size:"normal","no-close":""},on:{"update:open":function(i){e.showLinkedFileNotAvailableDialog=i}}}),s("TopBar",{attrs:{archived:e.isFormArchived,locked:e.isFormLocked,permissions:e.form?.permissions,"sidebar-opened":e.sidebarOpened,"submission-count":e.form?.submissionCount},on:{"share-form":e.onShareForm}}),s("header",[s("h2",{attrs:{dir:"auto"}},[e._v(" "+e._s(e.formTitle)+" ")]),s("p",[e._v(" "+e._s(e.t("forms","{amount} responses",{amount:e.filteredSubmissionsCount}))+" ")]),s("div",{staticClass:"response-actions"},[s("PillMenu",{staticClass:"response-actions__toggle",attrs:{disabled:e.noSubmissions,options:e.responseViews,active:e.activeResponseView},on:{"update:active":[function(i){e.activeResponseView=i},e.loadFormResults]}}),s("NcActions",{attrs:{"aria-label":e.t("forms","Options"),"force-name":"",inline:e.isMobile?0:1},on:{blur:function(i){e.isDownloadActionOpened=!1},close:function(i){e.isDownloadActionOpened=!1}}},[e.isDownloadActionOpened?[s("NcActionButton",{on:{click:function(i){e.isDownloadActionOpened=!1}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconChevronLeft",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("forms","Download"))+" ")]),s("NcActionSeparator"),s("NcActionButton",{attrs:{"close-after-click":""},on:{click:function(i){return e.onDownloadFile("csv")}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconFileDelimited",{attrs:{size:20}})]},proxy:!0}])},[e._v(" CSV ")]),s("NcActionButton",{attrs:{"close-after-click":""},on:{click:function(i){return e.onDownloadFile("ods")}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconTable",{attrs:{size:20}})]},proxy:!0}])},[e._v(" ODS ")]),s("NcActionButton",{attrs:{"close-after-click":""},on:{click:function(i){return e.onDownloadFile("xlsx")}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconFileExcelOutline",{attrs:{size:20}})]},proxy:!0}])},[e._v(" XSLX ")])]:[e.canEditForm&&!e.form.fileId&&!e.isFormLocked?s("NcActionButton",{on:{click:e.onLinkFile},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconLink",{attrs:{size:20}})]},proxy:!0}],null,!1,3963853667)},[e._v(" "+e._s(e.t("forms","Create spreadsheet"))+" ")]):e._e(),e.canEditForm&&e.form.fileId?[s("NcActionButton",{attrs:{href:e.fileUrl,type:"tertiary-no-background"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconTable",{attrs:{size:20}})]},proxy:!0}],null,!1,294719581)},[e._v(" "+e._s(e.t("forms","Open spreadsheet"))+" ")]),s("NcActionButton",{attrs:{"close-after-click":""},on:{click:e.onReExport},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconRefresh",{attrs:{size:20}})]},proxy:!0}],null,!1,3240524606)},[e._v(" "+e._s(e.t("forms","Re-export spreadsheet"))+" ")]),s("NcActionButton",{attrs:{"close-after-click":"",disabled:e.isFormLocked},on:{click:e.onUnlinkFile},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconLinkVariantOff",{attrs:{size:20}})]},proxy:!0}],null,!1,97002203)},[e._v(" "+e._s(e.t("forms","Unlink spreadsheet"))+" ")]),e.noSubmissions?e._e():s("NcActionSeparator")]:e._e(),e.noSubmissions?e._e():s("NcActionButton",{attrs:{"close-after-click":""},on:{click:e.onStoreToFiles},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconFolder",{attrs:{size:20}})]},proxy:!0}],null,!1,2686820117)},[e._v(" "+e._s(e.t("forms","Save copy to Files"))+" ")]),e.noSubmissions?e._e():s("NcActionButton",{attrs:{"close-after-click":!1,"is-menu":""},on:{click:function(i){e.isDownloadActionOpened=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconDownload",{attrs:{size:20}})]},proxy:!0}],null,!1,2487097783)},[e._v(" "+e._s(e.t("forms","Download"))+" ")]),e.canDeleteSubmissions&&!e.noSubmissions?s("NcActionButton",{attrs:{"close-after-click":""},on:{click:e.deleteAllSubmissions},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconDelete",{attrs:{size:20}})]},proxy:!0}],null,!1,881161434)},[e._v(" "+e._s(e.t("forms","Delete all responses"))+" ")]):e._e()]],2),(!e.noSubmissions||e.loadingResults||e.submissionSearch.length>0)&&e.activeResponseView.id!=="summary"?s("div",{staticClass:"search-wrapper"},[s("NcTextField",{attrs:{label:e.t("forms","Search"),"trailing-button-icon":"close","show-trailing-button":e.submissionSearch.length>0},on:{"trailing-button-click":function(i){e.submissionSearch=""}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconMagnify",{attrs:{size:20}})]},proxy:!0}],null,!1,1212505168),model:{value:e.submissionSearch,callback:function(i){e.submissionSearch=i},expression:"submissionSearch"}})],1):e._e()],1)]),e.loadingResults?s("NcEmptyContent",{staticClass:"forms-emptycontent",attrs:{name:e.t("forms","Loading responses â€¦")},scopedSlots:e._u([{key:"icon",fn:function(){return[s("NcLoadingIcon",{attrs:{size:64}})]},proxy:!0}],null,!1,826850984)}):e.noFilteredSubmissions&&e.submissionSearch.length>0?s("NcEmptyContent",{staticClass:"forms-emptycontent",attrs:{name:e.t("forms","No results found"),description:e.t("forms","No results found for {submissionSearch}",{submissionSearch:e.submissionSearch})},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconPoll",{attrs:{size:64}})]},proxy:!0}])}):e.noSubmissions?s("NcEmptyContent",{staticClass:"forms-emptycontent",attrs:{name:e.t("forms","No responses yet"),description:e.t("forms","Results of submitted forms will show up here")},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconPoll",{attrs:{size:64}})]},proxy:!0},{key:"action",fn:function(){return[s("div",{staticClass:"response-actions"},[s("NcButton",{attrs:{variant:"primary"},on:{click:e.onShareForm},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconShareVariant",{attrs:{size:20,decorative:""}})]},proxy:!0}])},[e._v(" "+e._s(e.t("forms","Share form"))+" ")])],1)]},proxy:!0}])}):e.activeResponseView.id==="summary"?s("section",e._l(e.questions,function(i){return s("ResultsSummary",{key:i.id,attrs:{question:i,submissions:e.submissions}})}),1):s("section",[e._l(e.submissions,function(i){return s("Submission",{key:i.id,attrs:{"form-hash":e.form.hash,submission:i,questions:e.questions,highlight:e.submissionSearch,"can-delete-submission":e.canDeleteSubmission(i.userId),"can-edit-submission":e.canEditSubmission(i.userId)},on:{delete:function(o){return e.deleteSubmission(i.id)}}})}),s("PaginationToolbar",{staticClass:"bottom-pagination",attrs:{"total-items-count":e.filteredSubmissionsCount,limit:e.limit,offset:e.offset},on:{"update:limit":function(i){e.limit=i},"update:offset":function(i){e.offset=i}}})],2),s("NcDialog",{attrs:{open:e.showConfirmDeleteDialog,name:e.t("forms","Delete submissions"),message:e.t("forms","Are you sure you want to delete all responses of {title}?",{title:e.formTitle}),buttons:e.confirmDeleteButtons},on:{"update:open":function(i){e.showConfirmDeleteDialog=i}}})],1)},Mr=[],Pr=T(Lr,Hr,Mr,!1,null,"d3338533");const Fr=Pr.exports;Q.use(We);const Rr=new We({mode:"history",base:Z("/apps/forms",""),linkActiveClass:"active",routes:[{path:"/",name:"root"},{path:"/:hash",redirect:{name:"submit"},name:"formRoot",props:!0},{path:"/:hash/edit",components:{default:Gi},name:"edit",props:{default:!0}},{path:"/:hash/results",components:{default:Fr},name:"results",props:{default:!0}},{path:"/:hash/submit/:submissionId?",components:{default:Ls},name:"submit",props:{default:!0}}]}),Vr={name:"ArchiveOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Br=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon archive-outline-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M20 21H4V10H6V19H18V10H20V21M3 3H21V9H3V3M9.5 11H14.5C14.78 11 15 11.22 15 11.5V13H9V11.5C9 11.22 9.22 11 9.5 11M5 5V7H19V5H5Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},Dr=[],Or=T(Vr,Br,Dr,!1,null,null);const rs=Or.exports,qr={name:"ArchiveOffOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var $r=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon archive-off-outline-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M8.2 5L6.2 3H21V9H12.2L10.2 7H19V5H8.2M20 16.8V10H18V14.8L20 16.8M20 19.35V19.34L18 17.34V17.35L9.66 9H9.66L7.66 7H7.66L6.13 5.47L2.39 1.73L1.11 3L3 4.89V9H7.11L17.11 19H6V10H4V21H19.11L20.84 22.73L22.11 21.46L20 19.35Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},zr=[],Ur=T(qr,$r,zr,!1,null,null);const Yr=Ur.exports,Qr={name:"AppNavigationForm",components:{FormsIcon:Yt,IconArchive:rs,IconArchiveOff:Yr,IconCheck:Js,IconContentCopy:Ms,IconDelete:yt,IconPencil:Qe,IconPoll:is,IconShareVariant:$t,NcActionButton:rt,NcActionRouter:Je,NcActionSeparator:qt,NcDialog:dt,NcListItem:Hs,NcLoadingIcon:_t},mixins:[ut],props:{form:{type:Object,required:!0},forceDisplayActions:{type:Boolean,default:!1,required:!1},readOnly:{type:Boolean,default:!0}},data(){return{loading:!1,showDeleteDialog:!1,buttons:[{label:t("forms","Delete form"),icon:Xe,type:"error",callback:()=>{this.onDeleteForm()}}]}},computed:{canEdit(){return this.form.permissions.includes(this.PERMISSION_TYPES.PERMISSION_EDIT)},canSeeResults(){return this.form.permissions.includes(this.PERMISSION_TYPES.PERMISSION_RESULTS)||this.form.submissionCount>0},isActive(){return this.form.hash===this.$route.params.hash},isArchived(){return this.form.state===B.FormArchived},isExpired(){return this.form.expires&&R().unix()>this.form.expires},isFormLocked(){return this.form.lockedUntil===0||this.form.lockedUntil>R().unix()&&this.form.lockedBy!==lt().uid},formTitle(){return this.form.title?this.form.title:t("forms","New form")},formSubtitle(){if(this.form.state===B.FormClosed)return t("forms","Form closed");if(this.form.expires){const e=R(this.form.expires,"X").fromNow();return this.isExpired?t("forms","Expired {relativeDate}",{relativeDate:e}):t("forms","Expires {relativeDate}",{relativeDate:e})}return""},hasSubtitle(){return this.formSubtitle!==""},routerTarget(){return this.readOnly?"submit":"formRoot"}},methods:{mobileCloseNavigation(){this.$emit("mobile-close-navigation")},onShareForm(){this.$emit("open-sharing",this.form.hash)},onCloneForm(){this.$emit("clone",this.form.id)},async onToggleArchive(){try{await M.patch(H("apps/forms/api/v3/forms/{id}",{id:this.form.id}),{keyValuePairs:{state:this.isArchived?B.FormClosed:B.FormArchived}}),this.$set(this.form,"state",this.isArchived?B.FormClosed:B.FormArchived)}catch(e){I.error("Error changing archived state of form",{error:e}),F(t("forms","Error changing archived state of form"))}},async onDeleteForm(){this.loading=!0;try{await M.delete(H("apps/forms/api/v3/forms/{id}",{id:this.form.id})),this.$emit("delete",this.form.id)}catch(e){I.error(`Error while deleting ${this.formTitle}`,{error:e.response}),F(t("forms","Error while deleting {title}",{title:this.formTitle}))}finally{this.loading=!1}}}};var jr=function(){var e=this,s=e._self._c;return s("NcListItem",{ref:"navigationItem",attrs:{active:e.isActive,"actions-aria-label":e.t("forms","Form actions"),"counter-number":e.form.submissionCount,compact:"","force-display-actions":e.forceDisplayActions,name:e.formTitle,to:{name:e.routerTarget,params:{hash:e.form.hash}}},on:{click:e.mobileCloseNavigation},scopedSlots:e._u([{key:"icon",fn:function(){return[e.loading?s("NcLoadingIcon",{attrs:{size:16}}):e.isExpired?s("IconCheck",{attrs:{size:16}}):s("FormsIcon",{attrs:{size:16}})]},proxy:!0},e.hasSubtitle?{key:"subname",fn:function(){return[e._v(" "+e._s(e.formSubtitle)+" ")]},proxy:!0}:null,!e.loading&&(!e.readOnly||e.canEdit||e.canSeeResults)?{key:"actions",fn:function(){return[!e.isArchived&&e.canEdit?s("NcActionRouter",{attrs:{"close-after-click":"",disabled:e.isFormLocked,exact:"",to:{name:"edit",params:{hash:e.form.hash}}},on:{click:e.mobileCloseNavigation},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconPencil",{attrs:{size:20}})]},proxy:!0}],null,!1,291764094)},[e._v(" "+e._s(e.t("forms","Edit form"))+" ")]):e._e(),!e.isArchived&&!e.readOnly?s("NcActionButton",{attrs:{"close-after-click":""},on:{click:e.onShareForm},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconShareVariant",{attrs:{size:20}})]},proxy:!0}],null,!1,2701055865)},[e._v(" "+e._s(e.t("forms","Share form"))+" ")]):e._e(),e.canSeeResults?s("NcActionRouter",{attrs:{"close-after-click":"",exact:"",to:{name:"results",params:{hash:e.form.hash}}},on:{click:e.mobileCloseNavigation},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconPoll",{attrs:{size:20}})]},proxy:!0}],null,!1,1519423900)},[e._v(" "+e._s(e.t("forms","Results"))+" ")]):e._e(),e.canEdit?s("NcActionButton",{attrs:{"close-after-click":""},on:{click:e.onCloneForm},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconContentCopy",{attrs:{size:20}})]},proxy:!0}],null,!1,3598792143)},[e._v(" "+e._s(e.t("forms","Copy form"))+" ")]):e._e(),e.canEdit&&!e.readOnly?s("NcActionSeparator"):e._e(),e.canEdit&&!e.readOnly?s("NcActionButton",{attrs:{"close-after-click":"",disabled:e.isFormLocked},on:{click:e.onToggleArchive},scopedSlots:e._u([{key:"icon",fn:function(){return[e.isArchived?s("IconArchiveOff",{attrs:{size:20}}):s("IconArchive",{attrs:{size:20}})]},proxy:!0}],null,!1,2091663753)},[e._v(" "+e._s(e.isArchived?e.t("forms","Unarchive form"):e.t("forms","Archive form"))+" ")]):e._e(),e.canEdit&&!e.readOnly?s("NcActionButton",{attrs:{"close-after-click":"",disabled:e.isFormLocked},on:{click:function(i){e.showDeleteDialog=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconDelete",{attrs:{size:20}})]},proxy:!0}],null,!1,881161434)},[e._v(" "+e._s(e.t("forms","Delete form"))+" ")]):e._e(),s("NcDialog",{attrs:{open:e.showDeleteDialog,name:e.t("forms","Delete form"),message:e.t("forms","Are you sure you want to delete {title}?",{title:e.formTitle}),buttons:e.buttons},on:{"update:open":function(i){e.showDeleteDialog=i}}})]},proxy:!0}:null],null,!0)})},Zr=[],Kr=T(Qr,jr,Zr,!1,null,null);const ns=Kr.exports,Wr=Ds({name:"ArchivedFormsModal",components:{AppNavigationForm:ns,NcDialog:dt},props:{open:{type:Boolean,required:!0},forms:{type:Array,required:!0}},emits:["update:open"],data(){return{shownForms:[]}},watch:{forms:{immediate:!0,handler(){this.shownForms=[...this.forms]}}},methods:{t:ze,onCloneForm(e){this.$emit("clone",e),this.$emit("update:open",!1)},onDelete(e){this.shownForms=this.shownForms.filter(({id:s})=>s!==e.id)}}});var Jr=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("NcDialog",{attrs:{"content-classes":"archived-forms",name:e.t("forms","Archived forms"),open:e.open,size:"normal"},on:{"update:open":function(i){return e.$emit("update:open",i)}}},[s("ul",{attrs:{"aria-label":e.t("forms","Archived forms")}},e._l(e.shownForms,function(i,o){return s("AppNavigationForm",{key:o,attrs:{form:i,"read-only":!1,"force-display-actions":""},on:{clone:function(r){return e.onCloneForm(i.id)},delete:function(r){return e.onDelete(i)},"mobile-close-navigation":function(r){return e.$emit("update:open",!1)}}})}),1)])},Gr=[],Xr=T(Wr,Jr,Gr,!1,null,"1e02b9f7");const tn=Xr.exports,en={name:"CogOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var sn=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon cog-outline-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M10,22C9.75,22 9.54,21.82 9.5,21.58L9.13,18.93C8.5,18.68 7.96,18.34 7.44,17.94L4.95,18.95C4.73,19.03 4.46,18.95 4.34,18.73L2.34,15.27C2.21,15.05 2.27,14.78 2.46,14.63L4.57,12.97L4.5,12L4.57,11L2.46,9.37C2.27,9.22 2.21,8.95 2.34,8.73L4.34,5.27C4.46,5.05 4.73,4.96 4.95,5.05L7.44,6.05C7.96,5.66 8.5,5.32 9.13,5.07L9.5,2.42C9.54,2.18 9.75,2 10,2H14C14.25,2 14.46,2.18 14.5,2.42L14.87,5.07C15.5,5.32 16.04,5.66 16.56,6.05L19.05,5.05C19.27,4.96 19.54,5.05 19.66,5.27L21.66,8.73C21.79,8.95 21.73,9.22 21.54,9.37L19.43,11L19.5,12L19.43,13L21.54,14.63C21.73,14.78 21.79,15.05 21.66,15.27L19.66,18.73C19.54,18.95 19.27,19.04 19.05,18.95L16.56,17.95C16.04,18.34 15.5,18.68 14.87,18.93L14.5,21.58C14.46,21.82 14.25,22 14,22H10M11.25,4L10.88,6.61C9.68,6.86 8.62,7.5 7.85,8.39L5.44,7.35L4.69,8.65L6.8,10.2C6.4,11.37 6.4,12.64 6.8,13.8L4.68,15.36L5.43,16.66L7.86,15.62C8.63,16.5 9.68,17.14 10.87,17.38L11.24,20H12.76L13.13,17.39C14.32,17.14 15.37,16.5 16.14,15.62L18.57,16.66L19.32,15.36L17.2,13.81C17.6,12.64 17.6,11.37 17.2,10.2L19.31,8.65L18.56,7.35L16.15,8.39C15.38,7.5 14.32,6.86 13.12,6.62L12.75,4H11.25Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},on=[],rn=T(en,sn,on,!1,null,null);const nn=rn.exports,an={name:"AccountMultipleOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var ln=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon account-multiple-outline-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M13.07 10.41A5 5 0 0 0 13.07 4.59A3.39 3.39 0 0 1 15 4A3.5 3.5 0 0 1 15 11A3.39 3.39 0 0 1 13.07 10.41M5.5 7.5A3.5 3.5 0 1 1 9 11A3.5 3.5 0 0 1 5.5 7.5M7.5 7.5A1.5 1.5 0 1 0 9 6A1.5 1.5 0 0 0 7.5 7.5M16 17V19H2V17S2 13 9 13 16 17 16 17M14 17C13.86 16.22 12.67 15 9 15S4.07 16.31 4 17M15.95 13A5.32 5.32 0 0 1 18 17V19H22V17S22 13.37 15.94 13Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},cn=[],un=T(an,ln,cn,!1,null,null);const dn=un.exports,hn={name:"CodeBracketsIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var mn=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon code-brackets-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M15,4V6H18V18H15V20H20V4M4,4V20H9V18H6V6H9V4H4Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},fn=[],pn=T(hn,mn,fn,!1,null,null);const gn=pn.exports,vn={name:"LinkBoxOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var yn=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon link-box-outline-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V5H19V19M11,16H10C8.39,16 6,14.94 6,12C6,9.07 8.39,8 10,8H11V10H10C9.54,10 8,10.17 8,12C8,13.9 9.67,14 10,14H11V16M14,16H13V14H14C14.46,14 16,13.83 16,12C16,10.1 14.33,10 14,10H13V8H14C15.61,8 18,9.07 18,12C18,14.94 15.61,16 14,16M15,13H9V11H15V13Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},_n=[],bn=T(vn,yn,_n,!1,null,null);const wn=bn.exports,Sn={name:"QrcodeIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Cn=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon qrcode-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H11V13H9V11M15,11H17V13H19V11H21V13H19V15H21V19H19V21H17V19H13V21H11V17H15V15H17V13H15V11M19,19V15H17V19H19M15,3H21V9H15V3M17,5V7H19V5H17M3,3H9V9H3V3M5,5V7H7V5H5M3,15H9V21H3V15M5,17V19H7V17H5Z"}},[e.title?s("title",[e._v(e._s(e.title))]):e._e()])])])},kn=[],An=T(Sn,Cn,kn,!1,null,null);const En=An.exports,xn={name:"IconCopyAll",props:{title:{type:String,default:""},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:20}}};var Nn=function(){var e=this,s=e._self._c;return s("span",e._b({staticClass:"material-design-icon copy-all-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[s("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,height:e.size,width:e.size,viewBox:"0 0 16 16"}},[s("path",{attrs:{d:"M 13.5 0 h -8 C 4.67 0 4 0.67 4 1.5 v 10 C 4 12.33 4.67 13 5.5 13 h 8 c 0.83 0 1.5 -0.67 1.5 -1.5 v -10 C 15 0.67 14.33 0 13.5 0 z M 13.5 11.5 h -8 v -10 h 8 V 11.5 z M 1 10 v -1.5 h 1.5 V 10 H 1 z M 1 13 v -1.5 h 1.5 V 13 H 1 z M 7 14.5 h 1.5 V 16 H 7 V 14.5 z M 1 5.5 h 1.5 V 7 H 1 V 5.5 z M 5.5 16 H 4 v -1.5 h 1.5 V 16 z M 2.5 16 C 1.67 16 1 15.33 1 14.5 h 1.5 V 16 z M 2.5 4 H 1 c 0 -0.83 0.67 -1.5 1.5 -1.5 V 4 z M 11.49 14.5 c 0 0.83 -0.67 1.5 -1.5 1.5 h 0 v -1.5 L 11.49 14.5 L 11.49 14.5 z"}}),e.title?s("title",[e._v(e._s(e.title))]):e._e()])])},Tn=[],In=T(xn,Nn,Tn,!1,null,null);const Ln=In.exports,Hn='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-account" viewBox="0 0 24 24"><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" /></svg>',Mn='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-account-group" viewBox="0 0 24 24"><path d="M12,5.5A3.5,3.5 0 0,1 15.5,9A3.5,3.5 0 0,1 12,12.5A3.5,3.5 0 0,1 8.5,9A3.5,3.5 0 0,1 12,5.5M5,8C5.56,8 6.08,8.15 6.53,8.42C6.38,9.85 6.8,11.27 7.66,12.38C7.16,13.34 6.16,14 5,14A3,3 0 0,1 2,11A3,3 0 0,1 5,8M19,8A3,3 0 0,1 22,11A3,3 0 0,1 19,14C17.84,14 16.84,13.34 16.34,12.38C17.2,11.27 17.62,9.85 17.47,8.42C17.92,8.15 18.44,8 19,8M5.5,18.25C5.5,16.18 8.41,14.5 12,14.5C15.59,14.5 18.5,16.18 18.5,18.25V20H5.5V18.25M0,20V18.5C0,17.11 1.89,15.94 4.45,15.6C3.86,16.28 3.5,17.22 3.5,18.25V20H0M24,20H20.5V18.25C20.5,17.22 20.14,16.28 19.55,15.6C22.11,15.94 24,17.11 24,18.5V20Z" /></svg>',Pn='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-email" viewBox="0 0 24 24"><path d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z" /></svg>',Fn='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-chat" viewBox="0 0 24 24"><path d="M12,3C17.5,3 22,6.58 22,11C22,15.42 17.5,19 12,19C10.76,19 9.57,18.82 8.47,18.5C5.55,21 2,21 2,21C4.33,18.67 4.7,17.1 4.75,16.5C3.05,15.07 2,13.13 2,11C2,6.58 6.5,3 12,3Z" /></svg>',Rn='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-circle-outline" viewBox="0 0 24 24"><path d="M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" /></svg>',bt={data(){return{SHARE_TYPES:{SHARE_TYPE_USER:OC.Share.SHARE_TYPE_USER,SHARE_TYPE_GROUP:OC.Share.SHARE_TYPE_GROUP,SHARE_TYPE_LINK:OC.Share.SHARE_TYPE_LINK,SHARE_TYPE_EMAIL:OC.Share.SHARE_TYPE_EMAIL,SHARE_TYPE_REMOTE:OC.Share.SHARE_TYPE_REMOTE,SHARE_TYPE_CIRCLE:OC.Share.SHARE_TYPE_CIRCLE,SHARE_TYPE_GUEST:OC.Share.SHARE_TYPE_GUEST,SHARE_TYPE_REMOTE_GROUP:OC.Share.SHARE_TYPE_REMOTE_GROUP,SHARE_TYPE_ROOM:OC.Share.SHARE_TYPE_ROOM},SHARE_TYPES_USED:[OC.Share.SHARE_TYPE_USER,OC.Share.SHARE_TYPE_GROUP,OC.Share.SHARE_TYPE_LINK,OC.Share.SHARE_TYPE_CIRCLE]}},methods:{shareTypeToIcon(e){switch(e){case this.SHARE_TYPES.SHARE_TYPE_GUEST:return Hn;case this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP:case this.SHARE_TYPES.SHARE_TYPE_GROUP:return Mn;case this.SHARE_TYPES.SHARE_TYPE_EMAIL:return Pn;case this.SHARE_TYPES.SHARE_TYPE_CIRCLE:return Rn;case this.SHARE_TYPES.SHARE_TYPE_ROOM:return Fn;default:return""}}}},as={mixins:[bt],data(){return{loading:!1,query:"",maxAutocompleteResults:parseInt(OC.config["sharing.maxAutocompleteResults"],10)||200,minSearchStringLength:parseInt(OC.config["sharing.minSearchStringLength"],10)||0,recommendations:[],suggestions:[]}},computed:{isValidQuery(){return this.query&&this.query.trim()!==""&&this.query.length>this.minSearchStringLength},noResultText(){return this.query?t("forms","No elements found."):t("forms","No recommendations. Start typing.")}},methods:{async asyncSearch(e){this.query=e.trim(),this.isValidQuery&&(this.loading=!0,this.debounceGetSuggestions(e))},debounceGetSuggestions:pt(function(...e){this.getSuggestions(...e)},gt),async getSuggestions(e){this.loading=!0;const s=this.SHARE_TYPES_USED.filter(i=>i!==this.SHARE_TYPES.SHARE_TYPE_LINK);try{const i=await M.get(H("apps/files_sharing/api/v1/sharees"),{params:{format:"json",itemType:"file",perPage:this.maxAutocompleteResults,search:e,shareType:s}}),o=O(i),r=o.exact;delete o.exact;const n=this.formatSearchResults(r),a=this.formatSearchResults(o);this.suggestions=n.concat(a)}catch(i){I.error("Loading Suggestions failed.",{error:i})}finally{this.loading=!1}},async getRecommendations(){this.loading=!0;try{const e=await M.get(H("apps/files_sharing/api/v1/sharees_recommended"),{params:{format:"json",itemType:"file"}});this.recommendations=this.formatSearchResults(O(e).exact)}catch(e){I.error("Fetching recommendations failed.",{error:e})}finally{this.loading=!1}},formatSearchResults(e){const s=Object.values(e).flat();return this.filterUnwantedShares(s).map(i=>this.formatForMultiselect(i)).sort((i,o)=>i.shareType-o.shareType)},filterUnwantedShares(e){return e.filter(s=>{if(typeof s!="object")return!1;try{return!(s.value.shareType===this.SHARE_TYPES.SHARE_TYPE_USER&&s.value.shareWith===lt().uid)}catch{return!1}})},formatForMultiselect(e){return{shareWith:e.value.shareWith,shareType:e.value.shareType,user:e.value.shareWith,isNoUser:e.value.shareType!==this.SHARE_TYPES.SHARE_TYPE_USER,id:e.value.shareWith,displayName:e.label,subname:e.shareWithDisplayNameUnique,iconSvg:this.shareTypeToIcon(e.value.shareType),key:e.value.shareWith+"-"+e.value.shareType}}}},Vn={components:{NcSelectUsers:Ke},mixins:[as],props:{currentShares:{type:Array,default:()=>[]},showLoading:{type:Boolean,default:!1},locked:{type:Boolean,required:!0}},computed:{options(){return this.isValidQuery?this.suggestions.filter(e=>!this.currentShares.find(s=>s.shareWith===e.shareWith&&s.shareType===e.shareType)):this.recommendations.filter(e=>!this.currentShares.find(s=>s.shareWith===e.shareWith&&s.shareType===e.shareType))},showLoadingCircle(){return this.showLoading||this.loading}},mounted(){this.getRecommendations()},methods:{addShare(e){const s={shareWith:e.shareWith,displayName:e.displayName,shareType:e.shareType};this.$emit("add-share",s)}}};var Bn=function(){var e=this,s=e._self._c;return s("div",[s("NcSelectUsers",{attrs:{"keep-open":"",loading:e.showLoadingCircle,disabled:e.locked,options:e.options,placeholder:e.t("forms","Search for user, group or team â€¦"),"aria-label-listbox":e.t("forms","Search for user, group or team â€¦")},on:{search:e.asyncSearch,"update:modelValue":e.addShare},scopedSlots:e._u([{key:"no-options",fn:function(){return[e._v(" "+e._s(e.noResultText)+" ")]},proxy:!0}])})],1)},Dn=[],On=T(Vn,Bn,Dn,!1,null,"525e61cc");const qn=On.exports,$n={components:{IconClose:Fs,NcActions:ot,NcActionButton:rt,NcActionCaption:Si,NcActionCheckbox:Ps,NcActionSeparator:qt,NcAvatar:js},mixins:[ut,bt],props:{share:{type:Object,required:!0},locked:{type:Boolean,required:!0}},computed:{canAccessResults(){return this.share.permissions.includes(this.PERMISSION_TYPES.PERMISSION_RESULTS)},canDeleteResults(){return this.share.permissions.includes(this.PERMISSION_TYPES.PERMISSION_RESULTS_DELETE)},canEditForm(){return this.share.permissions.includes(this.PERMISSION_TYPES.PERMISSION_EDIT)},isNoUser(){return this.share.shareType!==this.SHARE_TYPES.SHARE_TYPE_USER},displayName(){return this.share.displayName?this.share.displayName:this.share.shareWith},displayNameAppendix(){switch(this.share.shareType){case this.SHARE_TYPES.SHARE_TYPE_GROUP:return`(${t("forms","Group")})`;case this.SHARE_TYPES.SHARE_TYPE_CIRCLE:return`(${t("forms","Team")})`;default:return""}}},methods:{removeShare(){this.$emit("remove-share",this.share)},updatePermissionResults(e){return e===!1&&this.updatePermission(this.PERMISSION_TYPES.PERMISSION_RESULTS_DELETE,!1),this.updatePermission(this.PERMISSION_TYPES.PERMISSION_RESULTS,e)},updatePermissionDeleteResults(e){return this.updatePermission(this.PERMISSION_TYPES.PERMISSION_RESULTS_DELETE,e)},updatePermissionEdit(e){return this.updatePermission(this.PERMISSION_TYPES.PERMISSION_EDIT,e)},updatePermission(e,s){const i={...this.share};s?i.permissions=[...new Set([...i.permissions,e])]:i.permissions=i.permissions.filter(o=>o!==e),this.$emit("update:share",i)}}};var zn=function(){var e=this,s=e._self._c;return s("li",{staticClass:"share-div"},[s("NcAvatar",{attrs:{user:e.share.shareWith,"disable-menu":"","display-name":e.displayName,"is-no-user":e.isNoUser}}),s("div",{staticClass:"share-div__desc"},[s("span",[e._v(e._s(e.displayName))]),s("span",[e._v(e._s(e.displayNameAppendix))])]),s("NcActions",{staticClass:"share-div__actions"},[s("NcActionCaption",{attrs:{name:e.t("forms","Permissions")}}),s("NcActionCheckbox",{attrs:{"model-value":e.canEditForm,disabled:e.locked},on:{"update:model-value":e.updatePermissionEdit}},[e._v(" "+e._s(e.t("forms","Edit form"))+" ")]),s("NcActionCheckbox",{attrs:{"model-value":e.canAccessResults,disabled:e.locked},on:{"update:model-value":e.updatePermissionResults}},[e._v(" "+e._s(e.t("forms","View responses"))+" ")]),s("NcActionCheckbox",{attrs:{"model-value":e.canDeleteResults,disabled:!e.canAccessResults||e.locked},on:{"update:model-value":e.updatePermissionDeleteResults}},[e._v(" "+e._s(e.t("forms","Delete responses"))+" ")]),s("NcActionSeparator"),s("NcActionButton",{attrs:{disabled:e.locked},on:{click:e.removeShare},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconClose",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("forms","Delete"))+" ")])],1)],1)},Un=[],Yn=T($n,zn,Un,!1,null,"9a5996a7");const Qn=Yn.exports;var tt={},ee,se;function jn(){return se||(se=1,ee=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),ee}var At={},Y={},ie;function K(){if(ie)return Y;ie=1;let e;const s=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return Y.getSymbolSize=function(i){if(!i)throw new Error('"version" cannot be null or undefined');if(i<1||i>40)throw new Error('"version" should be in range from 1 to 40');return i*4+17},Y.getSymbolTotalCodewords=function(i){return s[i]},Y.getBCHDigit=function(i){let o=0;for(;i!==0;)o++,i>>>=1;return o},Y.setToSJISFunction=function(i){if(typeof i!="function")throw new Error('"toSJISFunc" is not a valid function.');e=i},Y.isKanjiModeEnabled=function(){return typeof e<"u"},Y.toSJIS=function(i){return e(i)},Y}var oe={},re;function jt(){return re||(re=1,function(e){e.L={bit:1},e.M={bit:0},e.Q={bit:3},e.H={bit:2};function s(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"l":case"low":return e.L;case"m":case"medium":return e.M;case"q":case"quartile":return e.Q;case"h":case"high":return e.H;default:throw new Error("Unknown EC Level: "+i)}}e.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},e.from=function(i,o){if(e.isValid(i))return i;try{return s(i)}catch{return o}}}(oe)),oe}var Et,ne;function Zn(){if(ne)return Et;ne=1;function e(){this.buffer=[],this.length=0}return e.prototype={get:function(s){const i=Math.floor(s/8);return(this.buffer[i]>>>7-s%8&1)===1},put:function(s,i){for(let o=0;o<i;o++)this.putBit((s>>>i-o-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(s){const i=Math.floor(this.length/8);this.buffer.length<=i&&this.buffer.push(0),s&&(this.buffer[i]|=128>>>this.length%8),this.length++}},Et=e,Et}var xt,ae;function Kn(){if(ae)return xt;ae=1;function e(s){if(!s||s<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=s,this.data=new Uint8Array(s*s),this.reservedBit=new Uint8Array(s*s)}return e.prototype.set=function(s,i,o,r){const n=s*this.size+i;this.data[n]=o,r&&(this.reservedBit[n]=!0)},e.prototype.get=function(s,i){return this.data[s*this.size+i]},e.prototype.xor=function(s,i,o){this.data[s*this.size+i]^=o},e.prototype.isReserved=function(s,i){return this.reservedBit[s*this.size+i]},xt=e,xt}var le={},ce;function Wn(){return ce||(ce=1,function(e){const s=K().getSymbolSize;e.getRowColCoords=function(i){if(i===1)return[];const o=Math.floor(i/7)+2,r=s(i),n=r===145?26:Math.ceil((r-13)/(2*o-2))*2,a=[r-7];for(let l=1;l<o-1;l++)a[l]=a[l-1]-n;return a.push(6),a.reverse()},e.getPositions=function(i){const o=[],r=e.getRowColCoords(i),n=r.length;for(let a=0;a<n;a++)for(let l=0;l<n;l++)a===0&&l===0||a===0&&l===n-1||a===n-1&&l===0||o.push([r[a],r[l]]);return o}}(le)),le}var Nt={},ue;function Jn(){if(ue)return Nt;ue=1;const e=K().getSymbolSize,s=7;return Nt.getPositions=function(i){const o=e(i);return[[0,0],[o-s,0],[0,o-s]]},Nt}var de={},he;function Gn(){return he||(he=1,function(e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const s={N1:3,N2:3,N3:40,N4:10};e.isValid=function(o){return o!=null&&o!==""&&!isNaN(o)&&o>=0&&o<=7},e.from=function(o){return e.isValid(o)?parseInt(o,10):void 0},e.getPenaltyN1=function(o){const r=o.size;let n=0,a=0,l=0,d=null,m=null;for(let h=0;h<r;h++){a=l=0,d=m=null;for(let f=0;f<r;f++){let c=o.get(h,f);c===d?a++:(a>=5&&(n+=s.N1+(a-5)),d=c,a=1),c=o.get(f,h),c===m?l++:(l>=5&&(n+=s.N1+(l-5)),m=c,l=1)}a>=5&&(n+=s.N1+(a-5)),l>=5&&(n+=s.N1+(l-5))}return n},e.getPenaltyN2=function(o){const r=o.size;let n=0;for(let a=0;a<r-1;a++)for(let l=0;l<r-1;l++){const d=o.get(a,l)+o.get(a,l+1)+o.get(a+1,l)+o.get(a+1,l+1);(d===4||d===0)&&n++}return n*s.N2},e.getPenaltyN3=function(o){const r=o.size;let n=0,a=0,l=0;for(let d=0;d<r;d++){a=l=0;for(let m=0;m<r;m++)a=a<<1&2047|o.get(d,m),m>=10&&(a===1488||a===93)&&n++,l=l<<1&2047|o.get(m,d),m>=10&&(l===1488||l===93)&&n++}return n*s.N3},e.getPenaltyN4=function(o){let r=0;const n=o.data.length;for(let a=0;a<n;a++)r+=o.data[a];return Math.abs(Math.ceil(r*100/n/5)-10)*s.N4};function i(o,r,n){switch(o){case e.Patterns.PATTERN000:return(r+n)%2===0;case e.Patterns.PATTERN001:return r%2===0;case e.Patterns.PATTERN010:return n%3===0;case e.Patterns.PATTERN011:return(r+n)%3===0;case e.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(n/3))%2===0;case e.Patterns.PATTERN101:return r*n%2+r*n%3===0;case e.Patterns.PATTERN110:return(r*n%2+r*n%3)%2===0;case e.Patterns.PATTERN111:return(r*n%3+(r+n)%2)%2===0;default:throw new Error("bad maskPattern:"+o)}}e.applyMask=function(o,r){const n=r.size;for(let a=0;a<n;a++)for(let l=0;l<n;l++)r.isReserved(l,a)||r.xor(l,a,i(o,l,a))},e.getBestMask=function(o,r){const n=Object.keys(e.Patterns).length;let a=0,l=1/0;for(let d=0;d<n;d++){r(d),e.applyMask(d,o);const m=e.getPenaltyN1(o)+e.getPenaltyN2(o)+e.getPenaltyN3(o)+e.getPenaltyN4(o);e.applyMask(d,o),m<l&&(l=m,a=d)}return a}}(de)),de}var mt={},me;function ls(){if(me)return mt;me=1;const e=jt(),s=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],i=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return mt.getBlocksCount=function(o,r){switch(r){case e.L:return s[(o-1)*4+0];case e.M:return s[(o-1)*4+1];case e.Q:return s[(o-1)*4+2];case e.H:return s[(o-1)*4+3];default:return}},mt.getTotalCodewordsCount=function(o,r){switch(r){case e.L:return i[(o-1)*4+0];case e.M:return i[(o-1)*4+1];case e.Q:return i[(o-1)*4+2];case e.H:return i[(o-1)*4+3];default:return}},mt}var fe={},at={},pe;function Xn(){if(pe)return at;pe=1;const e=new Uint8Array(512),s=new Uint8Array(256);return function(){let i=1;for(let o=0;o<255;o++)e[o]=i,s[i]=o,i<<=1,i&256&&(i^=285);for(let o=255;o<512;o++)e[o]=e[o-255]}(),at.log=function(i){if(i<1)throw new Error("log("+i+")");return s[i]},at.exp=function(i){return e[i]},at.mul=function(i,o){return i===0||o===0?0:e[s[i]+s[o]]},at}var ge;function ta(){return ge||(ge=1,function(e){const s=Xn();e.mul=function(i,o){const r=new Uint8Array(i.length+o.length-1);for(let n=0;n<i.length;n++)for(let a=0;a<o.length;a++)r[n+a]^=s.mul(i[n],o[a]);return r},e.mod=function(i,o){let r=new Uint8Array(i);for(;r.length-o.length>=0;){const n=r[0];for(let l=0;l<o.length;l++)r[l]^=s.mul(o[l],n);let a=0;for(;a<r.length&&r[a]===0;)a++;r=r.slice(a)}return r},e.generateECPolynomial=function(i){let o=new Uint8Array([1]);for(let r=0;r<i;r++)o=e.mul(o,new Uint8Array([1,s.exp(r)]));return o}}(fe)),fe}var Tt,ve;function ea(){if(ve)return Tt;ve=1;const e=ta();function s(i){this.genPoly=void 0,this.degree=i,this.degree&&this.initialize(this.degree)}return s.prototype.initialize=function(i){this.degree=i,this.genPoly=e.generateECPolynomial(this.degree)},s.prototype.encode=function(i){if(!this.genPoly)throw new Error("Encoder not initialized");const o=new Uint8Array(i.length+this.degree);o.set(i);const r=e.mod(o,this.genPoly),n=this.degree-r.length;if(n>0){const a=new Uint8Array(this.degree);return a.set(r,n),a}return r},Tt=s,Tt}var ye={},_e={},be={},we;function cs(){return we||(we=1,be.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),be}var q={},Se;function us(){if(Se)return q;Se=1;const e="[0-9]+",s="[A-Z $%*+\\-./:]+";let i="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";i=i.replace(/u/g,"\\u");const o="(?:(?![A-Z0-9 $%*+\\-./:]|"+i+`)(?:.|[\r
]))+`;q.KANJI=new RegExp(i,"g"),q.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),q.BYTE=new RegExp(o,"g"),q.NUMERIC=new RegExp(e,"g"),q.ALPHANUMERIC=new RegExp(s,"g");const r=new RegExp("^"+i+"$"),n=new RegExp("^"+e+"$"),a=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return q.testKanji=function(l){return r.test(l)},q.testNumeric=function(l){return n.test(l)},q.testAlphanumeric=function(l){return a.test(l)},q}var Ce;function W(){return Ce||(Ce=1,function(e){const s=cs(),i=us();e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(r,n){if(!r.ccBits)throw new Error("Invalid mode: "+r);if(!s.isValid(n))throw new Error("Invalid version: "+n);return n>=1&&n<10?r.ccBits[0]:n<27?r.ccBits[1]:r.ccBits[2]},e.getBestModeForData=function(r){return i.testNumeric(r)?e.NUMERIC:i.testAlphanumeric(r)?e.ALPHANUMERIC:i.testKanji(r)?e.KANJI:e.BYTE},e.toString=function(r){if(r&&r.id)return r.id;throw new Error("Invalid mode")},e.isValid=function(r){return r&&r.bit&&r.ccBits};function o(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+r)}}e.from=function(r,n){if(e.isValid(r))return r;try{return o(r)}catch{return n}}}(_e)),_e}var ke;function sa(){return ke||(ke=1,function(e){const s=K(),i=ls(),o=jt(),r=W(),n=cs(),a=7973,l=s.getBCHDigit(a);function d(c,A,E){for(let L=1;L<=40;L++)if(A<=e.getCapacity(L,E,c))return L}function m(c,A){return r.getCharCountIndicator(c,A)+4}function h(c,A){let E=0;return c.forEach(function(L){const V=m(L.mode,A);E+=V+L.getBitsLength()}),E}function f(c,A){for(let E=1;E<=40;E++)if(h(c,E)<=e.getCapacity(E,A,r.MIXED))return E}e.from=function(c,A){return n.isValid(c)?parseInt(c,10):A},e.getCapacity=function(c,A,E){if(!n.isValid(c))throw new Error("Invalid QR Code version");typeof E>"u"&&(E=r.BYTE);const L=s.getSymbolTotalCodewords(c),V=i.getTotalCodewordsCount(c,A),C=(L-V)*8;if(E===r.MIXED)return C;const p=C-m(E,c);switch(E){case r.NUMERIC:return Math.floor(p/10*3);case r.ALPHANUMERIC:return Math.floor(p/11*2);case r.KANJI:return Math.floor(p/13);case r.BYTE:default:return Math.floor(p/8)}},e.getBestVersionForData=function(c,A){let E;const L=o.from(A,o.M);if(Array.isArray(c)){if(c.length>1)return f(c,L);if(c.length===0)return 1;E=c[0]}else E=c;return d(E.mode,E.getLength(),L)},e.getEncodedBits=function(c){if(!n.isValid(c)||c<7)throw new Error("Invalid QR Code version");let A=c<<12;for(;s.getBCHDigit(A)-l>=0;)A^=a<<s.getBCHDigit(A)-l;return c<<12|A}}(ye)),ye}var It={},Ae;function ia(){if(Ae)return It;Ae=1;const e=K(),s=1335,i=21522,o=e.getBCHDigit(s);return It.getEncodedBits=function(r,n){const a=r.bit<<3|n;let l=a<<10;for(;e.getBCHDigit(l)-o>=0;)l^=s<<e.getBCHDigit(l)-o;return(a<<10|l)^i},It}var Ee={},Lt,xe;function oa(){if(xe)return Lt;xe=1;const e=W();function s(i){this.mode=e.NUMERIC,this.data=i.toString()}return s.getBitsLength=function(i){return 10*Math.floor(i/3)+(i%3?i%3*3+1:0)},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(i){let o,r,n;for(o=0;o+3<=this.data.length;o+=3)r=this.data.substr(o,3),n=parseInt(r,10),i.put(n,10);const a=this.data.length-o;a>0&&(r=this.data.substr(o),n=parseInt(r,10),i.put(n,a*3+1))},Lt=s,Lt}var Ht,Ne;function ra(){if(Ne)return Ht;Ne=1;const e=W(),s=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function i(o){this.mode=e.ALPHANUMERIC,this.data=o}return i.getBitsLength=function(o){return 11*Math.floor(o/2)+6*(o%2)},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(o){let r;for(r=0;r+2<=this.data.length;r+=2){let n=s.indexOf(this.data[r])*45;n+=s.indexOf(this.data[r+1]),o.put(n,11)}this.data.length%2&&o.put(s.indexOf(this.data[r]),6)},Ht=i,Ht}var Mt,Te;function na(){if(Te)return Mt;Te=1;const e=W();function s(i){this.mode=e.BYTE,typeof i=="string"?this.data=new TextEncoder().encode(i):this.data=new Uint8Array(i)}return s.getBitsLength=function(i){return i*8},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(i){for(let o=0,r=this.data.length;o<r;o++)i.put(this.data[o],8)},Mt=s,Mt}var Pt,Ie;function aa(){if(Ie)return Pt;Ie=1;const e=W(),s=K();function i(o){this.mode=e.KANJI,this.data=o}return i.getBitsLength=function(o){return o*13},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(o){let r;for(r=0;r<this.data.length;r++){let n=s.toSJIS(this.data[r]);if(n>=33088&&n<=40956)n-=33088;else if(n>=57408&&n<=60351)n-=49472;else throw new Error("Invalid SJIS character: "+this.data[r]+`
Make sure your charset is UTF-8`);n=(n>>>8&255)*192+(n&255),o.put(n,13)}},Pt=i,Pt}var Le={exports:{}},He;function la(){return He||(He=1,function(e){var s={single_source_shortest_paths:function(i,o,r){var n={},a={};a[o]=0;var l=s.PriorityQueue.make();l.push(o,0);for(var d,m,h,f,c,A,E,L,V;!l.empty();){d=l.pop(),m=d.value,f=d.cost,c=i[m]||{};for(h in c)c.hasOwnProperty(h)&&(A=c[h],E=f+A,L=a[h],V=typeof a[h]>"u",(V||L>E)&&(a[h]=E,l.push(h,E),n[h]=m))}if(typeof r<"u"&&typeof a[r]>"u"){var C=["Could not find a path from ",o," to ",r,"."].join("");throw new Error(C)}return n},extract_shortest_path_from_predecessor_list:function(i,o){for(var r=[],n=o;n;)r.push(n),i[n],n=i[n];return r.reverse(),r},find_path:function(i,o,r){var n=s.single_source_shortest_paths(i,o,r);return s.extract_shortest_path_from_predecessor_list(n,r)},PriorityQueue:{make:function(i){var o=s.PriorityQueue,r={},n;i=i||{};for(n in o)o.hasOwnProperty(n)&&(r[n]=o[n]);return r.queue=[],r.sorter=i.sorter||o.default_sorter,r},default_sorter:function(i,o){return i.cost-o.cost},push:function(i,o){var r={value:i,cost:o};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};e.exports=s}(Le)),Le.exports}var Me;function ca(){return Me||(Me=1,function(e){const s=W(),i=oa(),o=ra(),r=na(),n=aa(),a=us(),l=K(),d=la();function m(C){return unescape(encodeURIComponent(C)).length}function h(C,p,v){const _=[];let P;for(;(P=C.exec(v))!==null;)_.push({data:P[0],index:P.index,mode:p,length:P[0].length});return _}function f(C){const p=h(a.NUMERIC,s.NUMERIC,C),v=h(a.ALPHANUMERIC,s.ALPHANUMERIC,C);let _,P;return l.isKanjiModeEnabled()?(_=h(a.BYTE,s.BYTE,C),P=h(a.KANJI,s.KANJI,C)):(_=h(a.BYTE_KANJI,s.BYTE,C),P=[]),p.concat(v,_,P).sort(function(u,y){return u.index-y.index}).map(function(u){return{data:u.data,mode:u.mode,length:u.length}})}function c(C,p){switch(p){case s.NUMERIC:return i.getBitsLength(C);case s.ALPHANUMERIC:return o.getBitsLength(C);case s.KANJI:return n.getBitsLength(C);case s.BYTE:return r.getBitsLength(C)}}function A(C){return C.reduce(function(p,v){const _=p.length-1>=0?p[p.length-1]:null;return _&&_.mode===v.mode?(p[p.length-1].data+=v.data,p):(p.push(v),p)},[])}function E(C){const p=[];for(let v=0;v<C.length;v++){const _=C[v];switch(_.mode){case s.NUMERIC:p.push([_,{data:_.data,mode:s.ALPHANUMERIC,length:_.length},{data:_.data,mode:s.BYTE,length:_.length}]);break;case s.ALPHANUMERIC:p.push([_,{data:_.data,mode:s.BYTE,length:_.length}]);break;case s.KANJI:p.push([_,{data:_.data,mode:s.BYTE,length:m(_.data)}]);break;case s.BYTE:p.push([{data:_.data,mode:s.BYTE,length:m(_.data)}])}}return p}function L(C,p){const v={},_={start:{}};let P=["start"];for(let u=0;u<C.length;u++){const y=C[u],b=[];for(let g=0;g<y.length;g++){const x=y[g],k=""+u+g;b.push(k),v[k]={node:x,lastCount:0},_[k]={};for(let S=0;S<P.length;S++){const w=P[S];v[w]&&v[w].node.mode===x.mode?(_[w][k]=c(v[w].lastCount+x.length,x.mode)-c(v[w].lastCount,x.mode),v[w].lastCount+=x.length):(v[w]&&(v[w].lastCount=x.length),_[w][k]=c(x.length,x.mode)+4+s.getCharCountIndicator(x.mode,p))}}P=b}for(let u=0;u<P.length;u++)_[P[u]].end=0;return{map:_,table:v}}function V(C,p){let v;const _=s.getBestModeForData(C);if(v=s.from(p,_),v!==s.BYTE&&v.bit<_.bit)throw new Error('"'+C+'" cannot be encoded with mode '+s.toString(v)+`.
 Suggested mode is: `+s.toString(_));switch(v===s.KANJI&&!l.isKanjiModeEnabled()&&(v=s.BYTE),v){case s.NUMERIC:return new i(C);case s.ALPHANUMERIC:return new o(C);case s.KANJI:return new n(C);case s.BYTE:return new r(C)}}e.fromArray=function(C){return C.reduce(function(p,v){return typeof v=="string"?p.push(V(v,null)):v.data&&p.push(V(v.data,v.mode)),p},[])},e.fromString=function(C,p){const v=f(C,l.isKanjiModeEnabled()),_=E(v),P=L(_,p),u=d.find_path(P.map,"start","end"),y=[];for(let b=1;b<u.length-1;b++)y.push(P.table[u[b]].node);return e.fromArray(A(y))},e.rawSplit=function(C){return e.fromArray(f(C,l.isKanjiModeEnabled()))}}(Ee)),Ee}var Pe;function ua(){if(Pe)return At;Pe=1;const e=K(),s=jt(),i=Zn(),o=Kn(),r=Wn(),n=Jn(),a=Gn(),l=ls(),d=ea(),m=sa(),h=ia(),f=W(),c=ca();function A(u,y){const b=u.size,g=n.getPositions(y);for(let x=0;x<g.length;x++){const k=g[x][0],S=g[x][1];for(let w=-1;w<=7;w++)if(!(k+w<=-1||b<=k+w))for(let N=-1;N<=7;N++)S+N<=-1||b<=S+N||(w>=0&&w<=6&&(N===0||N===6)||N>=0&&N<=6&&(w===0||w===6)||w>=2&&w<=4&&N>=2&&N<=4?u.set(k+w,S+N,!0,!0):u.set(k+w,S+N,!1,!0))}}function E(u){const y=u.size;for(let b=8;b<y-8;b++){const g=b%2===0;u.set(b,6,g,!0),u.set(6,b,g,!0)}}function L(u,y){const b=r.getPositions(y);for(let g=0;g<b.length;g++){const x=b[g][0],k=b[g][1];for(let S=-2;S<=2;S++)for(let w=-2;w<=2;w++)S===-2||S===2||w===-2||w===2||S===0&&w===0?u.set(x+S,k+w,!0,!0):u.set(x+S,k+w,!1,!0)}}function V(u,y){const b=u.size,g=m.getEncodedBits(y);let x,k,S;for(let w=0;w<18;w++)x=Math.floor(w/3),k=w%3+b-8-3,S=(g>>w&1)===1,u.set(x,k,S,!0),u.set(k,x,S,!0)}function C(u,y,b){const g=u.size,x=h.getEncodedBits(y,b);let k,S;for(k=0;k<15;k++)S=(x>>k&1)===1,k<6?u.set(k,8,S,!0):k<8?u.set(k+1,8,S,!0):u.set(g-15+k,8,S,!0),k<8?u.set(8,g-k-1,S,!0):k<9?u.set(8,15-k-1+1,S,!0):u.set(8,15-k-1,S,!0);u.set(g-8,8,1,!0)}function p(u,y){const b=u.size;let g=-1,x=b-1,k=7,S=0;for(let w=b-1;w>0;w-=2)for(w===6&&w--;;){for(let N=0;N<2;N++)if(!u.isReserved(x,w-N)){let U=!1;S<y.length&&(U=(y[S]>>>k&1)===1),u.set(x,w-N,U),k--,k===-1&&(S++,k=7)}if(x+=g,x<0||b<=x){x-=g,g=-g;break}}}function v(u,y,b){const g=new i;b.forEach(function(N){g.put(N.mode.bit,4),g.put(N.getLength(),f.getCharCountIndicator(N.mode,u)),N.write(g)});const x=e.getSymbolTotalCodewords(u),k=l.getTotalCodewordsCount(u,y),S=(x-k)*8;for(g.getLengthInBits()+4<=S&&g.put(0,4);g.getLengthInBits()%8!==0;)g.putBit(0);const w=(S-g.getLengthInBits())/8;for(let N=0;N<w;N++)g.put(N%2?17:236,8);return _(g,u,y)}function _(u,y,b){const g=e.getSymbolTotalCodewords(y),x=l.getTotalCodewordsCount(y,b),k=g-x,S=l.getBlocksCount(y,b),w=g%S,N=S-w,U=Math.floor(g/S),nt=Math.floor(k/S),hs=nt+1,Zt=U-nt,ms=new d(Zt);let wt=0;const ht=new Array(S),Kt=new Array(S);let St=0;const fs=new Uint8Array(u.buffer);for(let J=0;J<S;J++){const kt=J<N?nt:hs;ht[J]=fs.slice(wt,wt+kt),Kt[J]=ms.encode(ht[J]),wt+=kt,St=Math.max(St,kt)}const Ct=new Uint8Array(g);let Wt=0,$,z;for($=0;$<St;$++)for(z=0;z<S;z++)$<ht[z].length&&(Ct[Wt++]=ht[z][$]);for($=0;$<Zt;$++)for(z=0;z<S;z++)Ct[Wt++]=Kt[z][$];return Ct}function P(u,y,b,g){let x;if(Array.isArray(u))x=c.fromArray(u);else if(typeof u=="string"){let U=y;if(!U){const nt=c.rawSplit(u);U=m.getBestVersionForData(nt,b)}x=c.fromString(u,U||40)}else throw new Error("Invalid data");const k=m.getBestVersionForData(x,b);if(!k)throw new Error("The amount of data is too big to be stored in a QR Code");if(!y)y=k;else if(y<k)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+k+`.
`);const S=v(y,b,x),w=e.getSymbolSize(y),N=new o(w);return A(N,y),E(N),L(N,y),C(N,b,0),y>=7&&V(N,y),p(N,S),isNaN(g)&&(g=a.getBestMask(N,C.bind(null,N,b))),a.applyMask(g,N),C(N,b,g),{modules:N,version:y,errorCorrectionLevel:b,maskPattern:g,segments:x}}return At.create=function(u,y){if(typeof u>"u"||u==="")throw new Error("No input text");let b=s.M,g,x;return typeof y<"u"&&(b=s.from(y.errorCorrectionLevel,s.M),g=m.from(y.version),x=a.from(y.maskPattern),y.toSJISFunc&&e.setToSJISFunction(y.toSJISFunc)),P(u,g,b,x)},At}var Fe={},Re={},Ve;function ds(){return Ve||(Ve=1,function(e){function s(i){if(typeof i=="number"&&(i=i.toString()),typeof i!="string")throw new Error("Color should be defined as hex string");let o=i.slice().replace("#","").split("");if(o.length<3||o.length===5||o.length>8)throw new Error("Invalid hex color: "+i);(o.length===3||o.length===4)&&(o=Array.prototype.concat.apply([],o.map(function(n){return[n,n]}))),o.length===6&&o.push("F","F");const r=parseInt(o.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+o.slice(0,6).join("")}}e.getOptions=function(i){i||(i={}),i.color||(i.color={});const o=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,r=i.width&&i.width>=21?i.width:void 0,n=i.scale||4;return{width:r,scale:r?4:n,margin:o,color:{dark:s(i.color.dark||"#000000ff"),light:s(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},e.getScale=function(i,o){return o.width&&o.width>=i+o.margin*2?o.width/(i+o.margin*2):o.scale},e.getImageWidth=function(i,o){const r=e.getScale(i,o);return Math.floor((i+o.margin*2)*r)},e.qrToImageData=function(i,o,r){const n=o.modules.size,a=o.modules.data,l=e.getScale(n,r),d=Math.floor((n+r.margin*2)*l),m=r.margin*l,h=[r.color.light,r.color.dark];for(let f=0;f<d;f++)for(let c=0;c<d;c++){let A=(f*d+c)*4,E=r.color.light;if(f>=m&&c>=m&&f<d-m&&c<d-m){const L=Math.floor((f-m)/l),V=Math.floor((c-m)/l);E=h[a[L*n+V]?1:0]}i[A++]=E.r,i[A++]=E.g,i[A++]=E.b,i[A]=E.a}}}(Re)),Re}var Be;function da(){return Be||(Be=1,function(e){const s=ds();function i(r,n,a){r.clearRect(0,0,n.width,n.height),n.style||(n.style={}),n.height=a,n.width=a,n.style.height=a+"px",n.style.width=a+"px"}function o(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}e.render=function(r,n,a){let l=a,d=n;typeof l>"u"&&(!n||!n.getContext)&&(l=n,n=void 0),n||(d=o()),l=s.getOptions(l);const m=s.getImageWidth(r.modules.size,l),h=d.getContext("2d"),f=h.createImageData(m,m);return s.qrToImageData(f.data,r,l),i(h,d,m),h.putImageData(f,0,0),d},e.renderToDataURL=function(r,n,a){let l=a;typeof l>"u"&&(!n||!n.getContext)&&(l=n,n=void 0),l||(l={});const d=e.render(r,n,l),m=l.type||"image/png",h=l.rendererOpts||{};return d.toDataURL(m,h.quality)}}(Fe)),Fe}var Ft={},De;function ha(){if(De)return Ft;De=1;const e=ds();function s(r,n){const a=r.a/255,l=n+'="'+r.hex+'"';return a<1?l+" "+n+'-opacity="'+a.toFixed(2).slice(1)+'"':l}function i(r,n,a){let l=r+n;return typeof a<"u"&&(l+=" "+a),l}function o(r,n,a){let l="",d=0,m=!1,h=0;for(let f=0;f<r.length;f++){const c=Math.floor(f%n),A=Math.floor(f/n);!c&&!m&&(m=!0),r[f]?(h++,f>0&&c>0&&r[f-1]||(l+=m?i("M",c+a,.5+A+a):i("m",d,0),d=0,m=!1),c+1<n&&r[f+1]||(l+=i("h",h),h=0)):d++}return l}return Ft.render=function(r,n,a){const l=e.getOptions(n),d=r.modules.size,m=r.modules.data,h=d+l.margin*2,f=l.color.light.a?"<path "+s(l.color.light,"fill")+' d="M0 0h'+h+"v"+h+'H0z"/>':"",c="<path "+s(l.color.dark,"stroke")+' d="'+o(m,d,l.margin)+'"/>',A='viewBox="0 0 '+h+" "+h+'"',E='<svg xmlns="http://www.w3.org/2000/svg" '+(l.width?'width="'+l.width+'" height="'+l.width+'" ':"")+A+' shape-rendering="crispEdges">'+f+c+`</svg>
`;return typeof a=="function"&&a(null,E),E},Ft}var Oe;function ma(){if(Oe)return tt;Oe=1;const e=jn(),s=ua(),i=da(),o=ha();function r(n,a,l,d,m){const h=[].slice.call(arguments,1),f=h.length,c=typeof h[f-1]=="function";if(!c&&!e())throw new Error("Callback required as last argument");if(c){if(f<2)throw new Error("Too few arguments provided");f===2?(m=l,l=a,a=d=void 0):f===3&&(a.getContext&&typeof m>"u"?(m=d,d=void 0):(m=d,d=l,l=a,a=void 0))}else{if(f<1)throw new Error("Too few arguments provided");return f===1?(l=a,a=d=void 0):f===2&&!a.getContext&&(d=l,l=a,a=void 0),new Promise(function(A,E){try{const L=s.create(l,d);A(n(L,a,d))}catch(L){E(L)}})}try{const A=s.create(l,d);m(null,n(A,a,d))}catch(A){m(A)}}return tt.create=s.create,tt.toCanvas=r.bind(null,i.render),tt.toDataURL=r.bind(null,i.renderToDataURL),tt.toString=r.bind(null,function(n,a,l){return o.render(n,l)}),tt}var fa=ma();const pa=ys(fa),ga={name:"QRDialog",components:{NcDialog:dt},props:{title:{type:String,default:""},text:{type:String,default:""}},emits:["closed"],data(){return{uri:{type:String,default:""},isOpen:{type:Boolean,default:!1}}},watch:{text:{immediate:!0,handler(){this.generateQr(),this.isOpen=!!this.text}}},methods:{async generateQr(){if(this.text)try{this.uri=await pa.toDataURL(this.text,{width:256})}catch(e){console.error(e)}else this.uri=null}}};var va=function(){var e=this,s=e._self._c;return s("NcDialog",{attrs:{"close-on-click-outside":"",name:e.title,open:e.isOpen},on:{close:function(i){e.isOpen=!1},"update:open":function(i){return e.$emit("closed",!0)}}},[s("div",{staticClass:"qr-dialog__content"},[s("img",{attrs:{src:e.uri,title:e.text,alt:e.t("forms","QR code representation of {text}",{text:e.text})}})])])},ya=[],_a=T(ga,va,ya,!1,null,null);const ba=_a.exports,wa={methods:{getInternalShareLink(e){return window.location.protocol+"//"+window.location.host+Z(`/apps/forms/${this.form.hash}`)},getPublicShareLink(e){let s;return this.isEmbeddingAllowed(e)?s=Z(`/apps/forms/embed/${e.shareWith}`):s=Z(`/apps/forms/s/${e.shareWith}`),new URL(s,window.location).href},isEmbeddingAllowed(e){return e.shareType===this.SHARE_TYPES.SHARE_TYPE_LINK&&e.permissions?.includes(this.PERMISSION_TYPES.PERMISSION_EMBED)},async copyLink(e,s){try{await navigator.clipboard.writeText(s),j(t("forms","Form link copied"))}catch(i){F(t("forms","Cannot copy, please copy the link manually")),I.error("Copy link failed",{error:i})}e.target.focus()},async copyEmbeddingCode(e){const s=`<iframe src="${this.getPublicShareLink(e)}" width="750" height="900"></iframe>`;try{await navigator.clipboard.writeText(s),j(t("forms","Embedding code copied"))}catch(i){F(t("forms","Cannot copy the code")),I.error("Copy embedding code failed",{error:i})}event.target.focus()}}},Sa={components:{FormsIcon:Yt,IconAccountMultiple:dn,IconCodeBrackets:gn,IconCopyAll:Ln,IconDelete:yt,IconLinkBoxVariantOutline:wn,IconLinkVariant:ss,IconPlus:Qt,IconQr:En,NcActions:ot,NcActionButton:rt,NcActionLink:Zs,NcCheckboxRadioSwitch:Ge,NcNoteCard:Ot,QRDialog:ba,SharingSearchDiv:qn,SharingShareDiv:Qn},mixins:[bt,wa,ut],props:{form:{type:Object,required:!0},locked:{type:Boolean,required:!0},lockedUntil:{type:String,default:""}},data(){return{isLoading:!1,appConfig:et(ft,"appConfig"),qrDialogText:""}},computed:{sortedShares(){return this.form.shares.filter(e=>e.shareType!==this.SHARE_TYPES.SHARE_TYPE_LINK).sort(this.sortByTypeAndDisplayname)},hasPublicLink(){return this.publicLinkShares.length!==0},publicLinkShares(){const e=this.form.shares.filter(s=>s.shareType===this.SHARE_TYPES.SHARE_TYPE_LINK);return e.sort((s,i)=>this.isEmbeddingAllowed(s)?1:this.isEmbeddingAllowed(i)?-1:0),e}},methods:{async addShare(e){this.isLoading=!0;try{const s=await M.post(H("apps/forms/api/v3/forms/{id}/shares",{id:this.form.id}),{shareType:e.shareType,shareWith:e.shareWith}),i=O(s);this.$emit("add-share",i)}catch(s){I.error("Error while adding new share",{error:s,share:e}),F(t("forms","There was an error while adding the share"))}finally{this.isLoading=!1}},async addPublicLink(){this.isLoading=!0;try{const e=await M.post(H("apps/forms/api/v3/forms/{id}/shares",{id:this.form.id}),{shareType:this.SHARE_TYPES.SHARE_TYPE_LINK}),s=O(e);this.$emit("add-share",s)}catch(e){I.error("Error adding public link",{error:e}),F(t("forms","There was an error while adding the link"))}finally{this.isLoading=!1}},makeEmbeddable(e){this.updateShare({...e,permissions:[...e.permissions,this.PERMISSION_TYPES.PERMISSION_EMBED]})},async updateShare(e){this.isLoading=!0;try{const s=await M.patch(H("apps/forms/api/v3/forms/{id}/shares/{shareId}",{id:this.form.id,shareId:e.id}),{keyValuePairs:{permissions:e.permissions}}),i=Object.assign(e,{id:O(s)});this.$emit("update-share",i)}catch(s){I.error("Error while updating share",{error:s,share:e}),F(t("forms","There was an error while updating the share"))}finally{this.isLoading=!1}},async removeShare(e){this.isLoading=!0;try{await M.delete(H("apps/forms/api/v3/forms/{id}/shares/{shareId}",{id:this.form.id,shareId:e.id})),this.$emit("remove-share",e)}catch(s){I.error("Error while removing share",{error:s,share:e}),F(t("forms","There was an error while removing the share"))}finally{this.isLoading=!1}},sortByTypeAndDisplayname(e,s){return e.shareType<s.shareType?-1:e.shareType>s.shareType?1:e.displayName.toLowerCase()<s.displayName.toLowerCase()?-1:e.displayName.toLowerCase()>s.displayName.toLowerCase()?1:0},onPermitAllUsersChange(e){const s={...this.form.access};s.permitAllUsers=e,this.$emit("update:formProp","access",s)},onShowToAllUsersChange(e){const s={...this.form.access};s.showToAllUsers=e,this.$emit("update:formProp","access",s)},openQrDialog(e){this.qrDialogText=this.getPublicShareLink(e)}}};var Ca=function(){var e=this,s=e._self._c;return s("div",{staticClass:"sidebar-tabs__content"},[e.locked?s("NcNoteCard",{attrs:{type:"info",heading:e.t("forms","Form is locked"),text:e.t("forms","Lock by {lockedBy}, expires: {lockedUntil}",{lockedBy:e.form.lockedBy?e.form.lockedBy:e.form.ownerId,lockedUntil:e.lockedUntil===""?e.t("forms","never"):e.lockedUntil})}}):e._e(),s("SharingSearchDiv",{attrs:{"current-shares":e.form.shares,"show-loading":e.isLoading,locked:e.locked},on:{"add-share":e.addShare}}),!e.hasPublicLink&&e.appConfig.allowPublicLink?s("div",{staticClass:"share-div share-div--link"},[s("div",{staticClass:"share-div__avatar"},[s("IconLinkVariant",{attrs:{size:20}})],1),s("span",{staticClass:"share-div__desc"},[e._v(e._s(e.t("forms","Share link")))]),s("NcActions",[s("NcActionButton",{attrs:{disabled:e.locked},on:{click:e.addPublicLink},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconPlus",{attrs:{size:20}})]},proxy:!0}],null,!1,1991456921)},[e._v(" "+e._s(e.t("forms","Add link"))+" ")])],1)],1):s("TransitionGroup",{attrs:{tag:"div"}},e._l(e.publicLinkShares,function(i){return s("div",{key:"share-"+i.shareType+"-"+i.shareWith,staticClass:"share-div share-div--link",class:{"share-div--embeddable":e.isEmbeddingAllowed(i)},attrs:{set:void(e.isEmbeddable=e.isEmbeddingAllowed(i))}},[s("div",{staticClass:"share-div__avatar"},[e.isEmbeddable?s("IconLinkBoxVariantOutline",{attrs:{size:20}}):s("IconLinkVariant",{attrs:{size:20}})],1),s("span",{staticClass:"share-div__desc"},[e._v(e._s(e.isEmbeddable?e.t("forms","Embeddable link"):e.t("forms","Share link")))]),s("NcActions",{attrs:{inline:1}},[s("NcActionLink",{attrs:{href:e.getPublicShareLink(i)},on:{click:function(o){o.preventDefault(),e.copyLink(o,e.getPublicShareLink(i))}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconCopyAll",{attrs:{size:20}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.t("forms","Copy to clipboard"))+" ")]),s("NcActionButton",{on:{click:function(o){return e.openQrDialog(i)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconQr",{attrs:{size:20}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.t("forms","Show QR code"))+" ")]),e.isEmbeddable?s("NcActionButton",{on:{click:function(o){return e.copyEmbeddingCode(i)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconCodeBrackets",{attrs:{size:20}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.t("forms","Copy embedding code"))+" ")]):s("NcActionButton",{attrs:{disabled:e.locked},on:{click:function(o){return e.makeEmbeddable(i)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconLinkBoxVariantOutline",{attrs:{size:20}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.t("forms","Convert to embeddable link"))+" ")]),s("NcActionButton",{attrs:{disabled:e.locked},on:{click:function(o){return e.removeShare(i)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconDelete",{attrs:{size:20}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.t("forms","Remove link"))+" ")]),e.appConfig.allowPublicLink?s("NcActionButton",{attrs:{"close-after-click":"",disabled:e.locked},on:{click:e.addPublicLink},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconPlus",{attrs:{size:20}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.t("forms","Add link"))+" ")]):e._e()],1)],1)}),0),s("QRDialog",{attrs:{title:e.t("forms","Share {formTitle}",{formTitle:e.form.title},{escape:!1,sanitize:!1}),text:e.qrDialogText},on:{closed:function(i){e.qrDialogText=""}}}),s("div",{staticClass:"share-div"},[s("div",{staticClass:"share-div__avatar"},[s("IconLinkVariant",{attrs:{size:20}})],1),s("div",{staticClass:"share-div__desc share-div__desc--twoline"},[s("span",[e._v(e._s(e.t("forms","Internal link")))]),s("span",[e._v(e._s(e.t("forms","Only works for logged in accounts with access rights")))])]),s("NcActions",[s("NcActionLink",{attrs:{href:e.getInternalShareLink(e.form.hash)},on:{click:function(i){i.preventDefault(),e.copyLink(i,e.getInternalShareLink(e.form.hash))}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconCopyAll",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("forms","Copy to clipboard"))+" ")])],1)],1),e.appConfig.allowPermitAll?s("div",[s("div",{staticClass:"share-div"},[s("div",{staticClass:"share-div__avatar"},[s("IconAccountMultiple",{attrs:{size:20}})],1),s("label",{staticClass:"share-div__desc",attrs:{for:"share-switch__permit-all"}},[e._v(" "+e._s(e.t("forms","Permit access to all logged in accounts"))+" ")]),s("NcCheckboxRadioSwitch",{attrs:{id:"share-switch__permit-all",checked:e.form.access.permitAllUsers,disabled:e.locked,type:"switch"},on:{"update:checked":e.onPermitAllUsersChange}})],1),e.appConfig.allowShowToAll&&e.form.access.permitAllUsers?s("div",{staticClass:"share-div share-div--indent"},[s("div",{staticClass:"share-div__avatar"},[s("FormsIcon",{attrs:{size:16}})],1),s("label",{staticClass:"share-div__desc",attrs:{for:"share-switch__show-to-all"}},[e._v(" "+e._s(e.t("forms","Show to all accounts on sidebar"))+" ")]),s("NcCheckboxRadioSwitch",{attrs:{id:"share-switch__show-to-all",checked:e.form.access.showToAllUsers,disabled:e.locked,type:"switch"},on:{"update:checked":e.onShowToAllUsersChange}})],1):e._e()]):e._e(),s("TransitionGroup",{attrs:{tag:"ul"}},e._l(e.sortedShares,function(i){return s("SharingShareDiv",{key:"share-"+i.shareType+"-"+i.shareWith,attrs:{share:i,locked:e.locked},on:{"remove-share":e.removeShare,"update:share":e.updateShare}})}),1)],1)},ka=[],Aa=T(Sa,Ca,ka,!1,null,"77d05e93");const Ea=Aa.exports,xa={components:{NcButton:it,NcDialog:dt,NcTextField:Ze,NcSelectUsers:Ke},mixins:[as],props:{form:{type:Object,required:!0},locked:{type:Boolean,required:!0}},data(){return{selected:null,showModal:!1,confirmationInput:"",loading:!1}},computed:{canTransfer(){return this.confirmationInput===this.confirmationString&&!!this.selected},confirmationString(){return`${this.form.ownerId}/${this.form.title}`},options(){return this.isValidQuery?this.suggestions:this.recommendations}},methods:{clearText(){this.confirmationInput=""},closeModal(){this.showModal=!1},escapedString(e){return""+e.replace("<","&lt;").replace(">","&gt;")},openModal(){this.showModal=!0},async onOwnershipTransfer(){if(this.showModal=!1,this.form.id&&this.selected.shareWith)try{D("forms:last-updated:set",this.form.id),await M.patch(H("apps/forms/api/v3/forms/{id}",{id:this.form.id}),{keyValuePairs:{ownerId:this.selected.shareWith}}),j(`${t("forms","This form is now owned by")} ${this.selected.displayName}`),D("forms:ownership-transfered",this.form.id)}catch(e){I.error("Error while transfering form ownership",{error:e}),F(t("forms","An error occurred while transfering ownership"))}else I.error("Null parameters while transfering form ownership",{selectedUser:this.selected}),F(t("forms","An error occurred while transfering ownership"))}}};var Na=function(){var e=this,s=e._self._c;return s("div",[s("NcButton",{staticClass:"transfer-button",attrs:{alignment:"start",variant:"tertiary",wide:"",disabled:e.locked},on:{click:e.openModal}},[s("span",{staticClass:"transfer-button__text"},[e._v(e._s(e.t("forms","Transfer ownership")))])]),s("NcDialog",{attrs:{open:e.showModal,"content-classes":"modal-content",name:e.t("forms","Transfer ownership"),"out-transition":""},on:{"update:open":function(i){e.showModal=i},close:e.closeModal},scopedSlots:e._u([{key:"default",fn:function(){return[s("p",{domProps:{innerHTML:e._s(e.t("forms","You're going to transfer the ownership of {name} to another account. Please select the account to which you want to transfer ownership.",{name:`<strong>${e.escapedString(e.form.title)}</strong>`},void 0,{escape:!1}))}}),s("NcSelectUsers",{staticClass:"modal-content__select",attrs:{loading:e.loading,options:e.options,placeholder:e.t("forms","Search for a user")},on:{search:e.asyncSearch},scopedSlots:e._u([{key:"no-options",fn:function(){return[e._v(" "+e._s(e.noResultText)+" ")]},proxy:!0}]),model:{value:e.selected,callback:function(i){e.selected=i},expression:"selected"}}),s("br"),s("p",{domProps:{innerHTML:e._s(e.t("forms","Type {text} to confirm.",{text:`<strong>${e.escapedString(e.confirmationString)}</strong>`},void 0,{escape:!1}))}}),s("NcTextField",{attrs:{label:e.t("forms","Confirmation text"),value:e.confirmationInput,success:e.confirmationInput===e.confirmationString},on:{"update:value":function(i){e.confirmationInput=i}}}),s("br"),s("p",[s("strong",[e._v(e._s(e.t("forms","This can not be undone.")))])])]},proxy:!0},{key:"actions",fn:function(){return[s("NcButton",{attrs:{disabled:!e.canTransfer,variant:"error"},on:{click:e.onOwnershipTransfer}},[e._v(" "+e._s(e.t("forms","I understand, transfer this form"))+" ")])]},proxy:!0}])})],1)},Ta=[],Ia=T(xa,Na,Ta,!1,null,"e84f3e7f");const La=Ia.exports;var Bt={exports:{}},Ha=Bt.exports,qe;function Ma(){return qe||(qe=1,function(e,s){(function(i,o){e.exports=o()})(Ha,function(){var i="__v-click-outside",o=typeof window<"u",r=typeof navigator<"u",n=o&&("ontouchstart"in window||r&&navigator.msMaxTouchPoints>0)?["touchstart"]:["click"];function a(h){var f=h.event,c=h.handler;(0,h.middleware)(f)&&c(f)}function l(h,f){var c=function(p){var v=typeof p=="function";if(!v&&typeof p!="object")throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:v?p:p.handler,middleware:p.middleware||function(_){return _},events:p.events||n,isActive:p.isActive!==!1,detectIframe:p.detectIframe!==!1,capture:!!p.capture}}(f.value),A=c.handler,E=c.middleware,L=c.detectIframe,V=c.capture;if(c.isActive){if(h[i]=c.events.map(function(p){return{event:p,srcTarget:document.documentElement,handler:function(v){return function(_){var P=_.el,u=_.event,y=_.handler,b=_.middleware,g=u.composedPath&&u.composedPath()||u.path;(g?g.indexOf(P)<0:!P.contains(u.target))&&a({event:u,handler:y,middleware:b})}({el:h,event:v,handler:A,middleware:E})},capture:V}}),L){var C={event:"blur",srcTarget:window,handler:function(p){return function(v){var _=v.el,P=v.event,u=v.handler,y=v.middleware;setTimeout(function(){var b=document.activeElement;b&&b.tagName==="IFRAME"&&!_.contains(b)&&a({event:P,handler:u,middleware:y})},0)}({el:h,event:p,handler:A,middleware:E})},capture:V};h[i]=[].concat(h[i],[C])}h[i].forEach(function(p){var v=p.event,_=p.srcTarget,P=p.handler;return setTimeout(function(){h[i]&&_.addEventListener(v,P,V)},0)})}}function d(h){(h[i]||[]).forEach(function(f){return f.srcTarget.removeEventListener(f.event,f.handler,f.capture)}),delete h[i]}var m=o?{bind:l,update:function(h,f){var c=f.value,A=f.oldValue;JSON.stringify(c)!==JSON.stringify(A)&&(d(h),l(h,{value:c}))},unbind:d}:{};return{install:function(h){h.directive("click-outside",m)},directive:m}})}(Bt)),Bt.exports}var Pa=Ma();const Fa='<svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#222222"><path d="M264-624h336v-96q0-50-35-85t-85-35q-50 0-85 35t-35 85h-72q0-80 56.23-136 56.22-56 136-56Q560-912 616-855.84q56 56.16 56 135.84v96h24q29.7 0 50.85 21.15Q768-581.7 768-552v384q0 29.7-21.16 50.85Q725.68-96 695.96-96H263.72Q234-96 213-117.15T192-168v-384q0-29.7 21.15-50.85Q234.3-624 264-624Zm216.21 336Q510-288 531-309.21t21-51Q552-390 530.79-411t-51-21Q450-432 429-410.79t-21 51Q408-330 429.21-309t51 21Z"/></svg>',Ra={components:{NcButton:it,NcCheckboxRadioSwitch:Ge,NcDateTimePicker:Rs,NcIconSvgWrapper:_s,NcNoteCard:Ot,TransferOwnership:La},directives:{ClickOutside:Pa.directive},mixins:[bt],inject:["$markdownit"],props:{form:{type:Object,required:!0},locked:{type:Boolean,required:!0},lockedUntil:{type:String,default:""}},data(){return{formatter:{stringify:this.stringifyDate,parse:this.parseTimestampToDate},maxStringLengths:et("forms","maxStringLengths"),editMessage:!1,svgLockOpen:Fa}},computed:{isCurrentUserOwner(){return lt().uid===this.form.ownerId},isFormLockedPermanently(){return this.locked&&this.form.lockedUntil===0},hasCustomSubmissionMessage(){return this.form?.submissionMessage!==void 0&&this.form?.submissionMessage!==null},disableSubmitMultiple(){return this.hasPublicLink||this.form.isAnonymous},disableSubmitMultipleExplanation(){return this.disableSubmitMultiple?t("forms","This can not be controlled, if the form has a public link or stores responses anonymously."):""},hasPublicLink(){return this.form.shares.filter(e=>e.shareType===this.SHARE_TYPES.SHARE_TYPE_LINK).length!==0},submitMultiple(){return this.disableSubmitMultiple||this.form.submitMultiple},formExpires(){return this.form.expires!==0},formArchived(){return this.form.state===B.FormArchived},formClosed(){return this.form.state!==B.FormActive},isExpired(){return this.form.expires&&R().unix()>this.form.expires},expirationDate(){return R(this.form.expires,"X").toDate()},submissionMessageHTML(){return this.$markdownit.render(this.form.submissionMessage||"")}},methods:{onAnonChange(e){this.$emit("update:formProp","isAnonymous",e)},onSubmitMultipleChange(e){this.$emit("update:formProp","submitMultiple",e)},onAllowEditSubmissionsChange(e){this.$emit("update:formProp","allowEditSubmissions",e)},onFormExpiresChange(e){e?this.$emit("update:formProp","expires",R().add(1,"hour").unix()):this.$emit("update:formProp","expires",0)},onShowExpirationChange(e){this.$emit("update:formProp","showExpiration",e)},onExpirationDateChange(e){this.$emit("update:formProp","expires",parseInt(R(e).format("X")))},onFormClosedChange(e){this.$emit("update:formProp","state",e?B.FormClosed:B.FormActive)},onFormLockChange(e){this.$emit("update:formProp","lockedUntil",e?0:null)},onFormArchivedChange(e){this.$emit("update:formProp","state",e?B.FormArchived:B.FormClosed)},onSubmissionMessageChange({target:e}){this.$emit("update:formProp","submissionMessage",e.value)},onUpdateHasCustomSubmissionMessage(){this.hasCustomSubmissionMessage?this.$emit("update:formProp","submissionMessage",null):this.$emit("update:formProp","submissionMessage","")},stringifyDate(e){const s=R(e).format("LLL");return this.isExpired?t("forms","Expired on {date}",{date:s}):t("forms","Expires on {date}",{date:s})},parseTimestampToDate(e){return R(e,"X").toDate()},notBeforeToday(e){return e<R().add(-1,"day").toDate()},notBeforeNow(e){return e<R().toDate()}}};var Va=function(){var e=this,s=e._self._c;return s("div",{staticClass:"sidebar-tabs__content"},[e.locked?s("NcNoteCard",{attrs:{type:"info",heading:e.t("forms","Form is locked"),text:e.t("forms","Lock by {lockedBy}, expires: {lockedUntil}",{lockedBy:e.form.lockedBy?e.form.lockedBy:e.form.ownerId,lockedUntil:e.lockedUntil===""?e.t("forms","never"):e.lockedUntil})}}):e._e(),e.locked&&e.isCurrentUserOwner?s("NcButton",{attrs:{wide:""},on:{click:function(i){return e.onFormLockChange(!1)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("NcIconSvgWrapper",{attrs:{svg:e.svgLockOpen}})]},proxy:!0}],null,!1,3842401863)},[e._v(" "+e._s(e.t("forms","Unlock form"))+" ")]):e._e(),s("NcCheckboxRadioSwitch",{attrs:{checked:e.form.isAnonymous,disabled:e.formArchived||e.locked,type:"switch"},on:{"update:checked":e.onAnonChange}},[e._v(" "+e._s(e.t("forms","Store responses anonymously"))+" ")]),s("NcCheckboxRadioSwitch",{attrs:{title:e.disableSubmitMultipleExplanation,checked:e.submitMultiple,disabled:e.disableSubmitMultiple||e.formArchived||e.locked,type:"switch"},on:{"update:checked":e.onSubmitMultipleChange}},[e._v(" "+e._s(e.t("forms","Allow multiple responses per person"))+" ")]),s("NcCheckboxRadioSwitch",{attrs:{"model-value":e.form.allowEditSubmissions,disabled:e.formArchived||e.locked,type:"switch"},on:{"update:model-value":e.onAllowEditSubmissionsChange}},[e._v(" "+e._s(e.t("forms","Allow editing own responses"))+" ")]),s("NcCheckboxRadioSwitch",{attrs:{checked:e.formExpires,disabled:e.formArchived||e.locked,type:"switch"},on:{"update:checked":e.onFormExpiresChange}},[e._v(" "+e._s(e.t("forms","Set expiration date"))+" ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.formExpires&&!e.formArchived,expression:"formExpires && !formArchived"}],staticClass:"settings-div--indent"},[s("NcDateTimePicker",{attrs:{id:"expiresDatetimePicker",clearable:!1,disabled:e.locked,"disabled-date":e.notBeforeToday,"disabled-time":e.notBeforeNow,editable:!1,formatter:e.formatter,"minute-step":5,"show-second":!1,value:e.expirationDate,type:"datetime"},on:{change:e.onExpirationDateChange}}),s("NcCheckboxRadioSwitch",{attrs:{checked:e.form.showExpiration,disabled:e.locked,type:"switch"},on:{"update:checked":e.onShowExpirationChange}},[e._v(" "+e._s(e.t("forms","Show expiration date on form"))+" ")])],1),s("NcCheckboxRadioSwitch",{attrs:{checked:e.formClosed,disabled:e.formArchived||e.locked,"aria-describedby":"forms-settings__close-form",type:"switch"},on:{"update:checked":e.onFormClosedChange}},[e._v(" "+e._s(e.t("forms","Close form"))+" ")]),s("p",{staticClass:"settings-hint",attrs:{id:"forms-settings__close-form"}},[e._v(" "+e._s(e.t("forms","Closed forms do not accept new submissions."))+" ")]),s("NcCheckboxRadioSwitch",{attrs:{"model-value":e.isFormLockedPermanently,disabled:e.formArchived||e.locked&&e.form.lockedUntil!==0||!e.isCurrentUserOwner,type:"switch"},on:{"update:model-value":e.onFormLockChange}},[e._v(" "+e._s(e.t("forms","Lock form permanently"))+" ")]),s("NcCheckboxRadioSwitch",{attrs:{checked:e.formArchived,"aria-describedby":"forms-settings__archive-form",disabled:e.locked,type:"switch"},on:{"update:checked":e.onFormArchivedChange}},[e._v(" "+e._s(e.t("forms","Archive form"))+" ")]),s("p",{staticClass:"settings-hint",attrs:{id:"forms-settings__archive-form"}},[e._v(" "+e._s(e.t("forms","Archived forms do not accept new submissions and can not be modified."))+" ")]),s("NcCheckboxRadioSwitch",{attrs:{checked:e.hasCustomSubmissionMessage,disabled:e.formArchived||e.locked,type:"switch"},on:{"update:checked":e.onUpdateHasCustomSubmissionMessage}},[e._v(" "+e._s(e.t("forms","Custom submission message"))+" ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.hasCustomSubmissionMessage,expression:"hasCustomSubmissionMessage"}],staticClass:"settings-div--indent submission-message",attrs:{tabindex:e.editMessage?void 0:"0"},on:{focus:function(i){e.editMessage=!0}}},[!e.formArchived&&(e.editMessage||!e.form.submissionMessage)?s("textarea",{directives:[{name:"click-outside",rawName:"v-click-outside",value:()=>{e.editMessage=!1},expression:`
				() => {
					editMessage = false
				}
			`}],staticClass:"submission-message__input",attrs:{"aria-describedby":"forms-submission-message-description","aria-label":e.t("forms","Custom submission message"),disabled:e.locked,maxlength:e.maxStringLengths.submissionMessage,placeholder:e.t("forms","Message to show after a user submitted the form (formatting using Markdown is supported)")},domProps:{value:e.form.submissionMessage},on:{blur:function(i){e.editMessage=!1},change:e.onSubmissionMessageChange}}):s("div",{staticClass:"submission-message__output",attrs:{"aria-label":e.t("forms","Custom submission message")},domProps:{innerHTML:e._s(e.submissionMessageHTML)}}),s("div",{staticClass:"submission-message__description",attrs:{id:"forms-submission-message-description"}},[e._v(" "+e._s(e.t("forms","Message to show after a user submitted the form. Please note that the message will not be translated!"))+" ")])]),s("TransferOwnership",{attrs:{locked:e.locked,form:e.form}})],1)},Ba=[],Da=T(Ra,Va,Ba,!1,null,"986dd79c");const Oa=Da.exports,qa={name:"Sidebar",components:{IconSettings:nn,IconShareVariant:$t,NcAppSidebar:Vs,NcAppSidebarTab:ji,SharingSidebarTab:Ea,SettingsSidebarTab:Oa},mixins:[Dt],props:{active:{type:String,default:"forms-sharing"}},computed:{lockedUntilFormatted(){return this.form.lockedUntil===0||this.form.lockedUntil===null?"":R(this.form.lockedUntil,"X").fromNow()}},methods:{onUpdateActive(e){this.$emit("update:active",e)},onPropertyChange(e,s){this.$set(this.form,e,s),this.saveFormProperty(e)},onAddShare(e){this.form.shares.push(e),D("forms:last-updated:set",this.form.id)},onRemoveShare(e){const s=this.form.shares.findIndex(i=>i.id===e.id);this.form.shares.splice(s,1),D("forms:last-updated:set",this.form.id)},onUpdateShare(e){const s=this.form.shares.findIndex(i=>i.id===e.id);this.form.shares.splice(s,1,e),D("forms:last-updated:set",this.form.id)}}};var $a=function(){var e=this,s=e._self._c;return s("NcAppSidebar",{attrs:{open:e.sidebarOpened,active:e.active,name:e.t("forms","Form settings")},on:{"update:active":e.onUpdateActive,"update:open":function(i){return e.$emit("update:sidebarOpened",i)}}},[s("NcAppSidebarTab",{attrs:{id:"forms-sharing",order:0,name:e.t("forms","Sharing")},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconShareVariant",{attrs:{size:20}})]},proxy:!0}])},[s("SharingSidebarTab",{attrs:{form:e.form,locked:e.isFormLocked,"locked-until":e.lockedUntilFormatted},on:{"update:formProp":e.onPropertyChange,"add-share":e.onAddShare,"remove-share":e.onRemoveShare,"update-share":e.onUpdateShare}})],1),s("NcAppSidebarTab",{attrs:{id:"forms-settings",order:1,name:e.t("forms","Settings")},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconSettings",{attrs:{size:20}})]},proxy:!0}])},[s("SettingsSidebarTab",{attrs:{form:e.form,locked:e.isFormLocked,"locked-until":e.lockedUntilFormatted},on:{"update:formProp":e.onPropertyChange}})],1)],1)},za=[],Ua=T(qa,$a,za,!1,null,"186d862f");const Ya=Ua.exports,Qa={name:"Forms",components:{AppNavigationForm:ns,ArchivedFormsModal:tn,FormsIcon:Yt,IconArchive:rs,IconPlus:Qt,NcAppContent:Ut,NcAppNavigation:Hi,NcAppNavigationCaption:Vi,NcAppNavigationNew:$i,NcButton:it,NcContent:Ws,NcEmptyContent:zt,NcLoadingIcon:_t,Sidebar:Ya},mixins:[ut],setup(){return{isMobile:$e()}},data(){return{loading:!0,sidebarOpened:!1,sidebarActive:"forms-sharing",forms:[],allSharedForms:[],showArchivedForms:!1,canCreateForms:et(ft,"appConfig").canCreateForms}},computed:{canEdit(){return this.selectedForm.permissions.includes(this.PERMISSION_TYPES.PERMISSION_EDIT)},hasForms(){return this.allSharedForms.length>0||this.forms.length>0},ownedForms(){return this.forms.filter(e=>e.state!==B.FormArchived)},sharedForms(){return this.allSharedForms.filter(e=>e.state!==B.FormArchived)},archivedForms(){return[...this.forms,...this.allSharedForms].filter(e=>e.state===B.FormArchived)},routeHash(){return this.$route.params.hash},routeAllowed(){if(this.loading&&et(ft,"formId")==="invalid"||!this.routeHash)return!1;const e=[...this.forms,...this.allSharedForms].find(s=>s.hash===this.routeHash);return e===void 0?(this.fetchPartialForm(this.routeHash),!1):e?.permissions.includes(this.$route.name)},selectedForm:{get(){return this.routeAllowed?this.forms.concat(this.allSharedForms).find(e=>e.hash===this.routeHash):{}},set(e){this.sidebarOpened=!1;let s=this.forms.findIndex(i=>i.hash===this.routeHash);if(s>-1){this.$set(this.forms,s,e);return}s=this.allSharedForms.findIndex(i=>i.hash===this.routeHash),s>-1&&this.$set(this.allSharedForms,s,e)}}},beforeMount(){this.loadForms()},mounted(){Vt("forms:last-updated:set",e=>this.onLastUpdatedByEventBus(e)),Vt("forms:ownership-transfered",e=>this.onDeleteForm(e))},unmounted(){Rt("forms:last-updated:set",e=>this.onLastUpdatedByEventBus(e)),Rt("forms:ownership-transfered",e=>this.onDeleteForm(e))},methods:{mobileCloseNavigation(){this.isMobile&&D("toggle-navigation",{open:!1})},openSharing(e){e!==this.routeHash&&this.$router.push({name:"edit",params:{hash:e}}),this.sidebarActive="forms-sharing",this.sidebarOpened=!0},async loadForms(){this.loading=!0;try{const e=await M.get(H("apps/forms/api/v3/forms"));this.forms=O(e)}catch(e){I.error("Error while loading owned forms list",{error:e}),F(t("forms","An error occurred while loading the forms list"))}try{const e=await M.get(H("apps/forms/api/v3/forms?type=shared"));this.allSharedForms=O(e)}catch(e){I.error("Error while loading shared forms list",{error:e}),F(t("forms","An error occurred while loading the forms list"))}this.loading=!1},async fetchPartialForm(e){if(await new Promise(s=>{const i=()=>{this.loading?window.setTimeout(i,250):s()};i()}),this.loading=!0,[...this.forms,...this.allSharedForms].find(s=>s.hash===e)===void 0)try{const s=await M.get(H("apps/forms/api/v3/forms/{id}",{id:et(ft,"formId")})),i=O(s);i.permissions.includes(this.PERMISSION_TYPES.PERMISSION_SUBMIT)&&this.allSharedForms.push(i)}catch(s){I.error(`Form ${e} not found`,{error:s}),F(t("forms","Form not found")),[403,404].includes(s.response?.status)&&this.$route.name!=="root"&&this.$router.push({name:"root"})}this.loading=!1},async onNewForm(){try{const e=await M.post(H("apps/forms/api/v3/forms")),s=O(e);this.forms.unshift(s),this.$router.push({name:"edit",params:{hash:s.hash}}),this.mobileCloseNavigation()}catch(e){I.error("Unable to create new form",{error:e}),F(t("forms","Unable to create a new form"))}},async onCloneForm(e){try{const s=await M.post(H("apps/forms/api/v3/forms?fromId={id}",{id:e})),i=O(s);this.forms.unshift(i),this.$router.push({name:"edit",params:{hash:i.hash}}),this.mobileCloseNavigation()}catch(s){I.error(`Unable to copy form ${e}`,{error:s}),F(t("forms","Unable to copy form"))}},async onDeleteForm(e){const s=this.forms.findIndex(o=>o.id===e),i=this.forms[s].hash;this.forms.splice(s,1),i===this.routeHash&&this.$route.name!=="root"&&this.$router.push({name:"root"})},onLastUpdatedByEventBus(e){const s=this.forms.findIndex(i=>i.id===e);if(s!==-1)this.forms[s].lastUpdated=R().unix(),this.forms.sort((i,o)=>o.lastUpdated-i.lastUpdated);else{const i=this.allSharedForms.findIndex(o=>o.id===e);this.allSharedForms[i].lastUpdated=R().unix(),this.allSharedForms.sort((o,r)=>r.lastUpdated-o.lastUpdated)}}}};var ja=function(){var e=this,s=e._self._c;return s("NcContent",{attrs:{"app-name":"forms"}},[e.canCreateForms||e.hasForms?s("NcAppNavigation",{attrs:{"aria-label":e.t("forms","Forms navigation")},scopedSlots:e._u([{key:"footer",fn:function(){return[e.archivedForms.length>0?s("div",{staticClass:"forms-navigation-footer"},[s("NcButton",{staticClass:"forms__archived-forms-toggle",attrs:{alignment:"start",variant:"tertiary",wide:""},on:{click:function(i){e.showArchivedForms=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconArchive",{attrs:{size:20}})]},proxy:!0}],null,!1,1438813153)},[e._v(" "+e._s(e.t("forms","Archived forms"))+" ")])],1):e._e()]},proxy:!0}],null,!1,1570565164)},[e.canCreateForms?s("NcAppNavigationNew",{attrs:{text:e.t("forms","New form")},on:{click:e.onNewForm},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconPlus",{attrs:{size:20,decorative:""}})]},proxy:!0}],null,!1,1626299775)}):e._e(),e.ownedForms.length>0?[s("NcAppNavigationCaption",{staticClass:"forms-navigation__list-heading",attrs:{"is-heading":"","heading-id":"forms-navigation-your-forms",name:e.t("forms","Your forms")}}),s("ul",{attrs:{"aria-labelledby":"forms-navigation-your-forms"}},e._l(e.ownedForms,function(i){return s("AppNavigationForm",{key:i.id,attrs:{form:i,"read-only":!1},on:{"open-sharing":e.openSharing,"mobile-close-navigation":e.mobileCloseNavigation,clone:e.onCloneForm,delete:e.onDeleteForm}})}),1)]:e._e(),e.sharedForms.length>0?[s("NcAppNavigationCaption",{staticClass:"forms-navigation__list-heading",attrs:{"is-heading":"","heading-id":"forms-navigation-shared-forms",name:e.t("forms","Shared with you")}}),s("ul",{attrs:{"aria-labelledby":"forms-navigation-shared-forms"}},e._l(e.sharedForms,function(i){return s("AppNavigationForm",{key:i.id,attrs:{form:i,"read-only":""},on:{"open-sharing":e.openSharing,"mobile-close-navigation":e.mobileCloseNavigation}})}),1)]:e._e()],2):e._e(),e.loading||!e.routeHash||!e.routeAllowed?s("NcAppContent",[e.loading?s("NcEmptyContent",{staticClass:"forms-emptycontent",attrs:{name:e.t("forms","Loading forms â€¦")},scopedSlots:e._u([{key:"icon",fn:function(){return[s("NcLoadingIcon",{attrs:{size:64}})]},proxy:!0}],null,!1,826850984)}):e.hasForms?s("NcEmptyContent",{staticClass:"forms-emptycontent",attrs:{name:e.canCreateForms?e.t("forms","Select a form or create a new one"):e.t("forms","Please select a form")},scopedSlots:e._u([{key:"icon",fn:function(){return[s("FormsIcon",{attrs:{size:64}})]},proxy:!0},e.canCreateForms?{key:"action",fn:function(){return[s("NcButton",{attrs:{variant:"primary"},on:{click:e.onNewForm}},[e._v(" "+e._s(e.t("forms","Create new form"))+" ")])]},proxy:!0}:null],null,!0)}):s("NcEmptyContent",{staticClass:"forms-emptycontent",attrs:{name:e.t("forms","No forms created yet")},scopedSlots:e._u([{key:"icon",fn:function(){return[s("FormsIcon",{attrs:{size:64}})]},proxy:!0},e.canCreateForms?{key:"action",fn:function(){return[s("NcButton",{attrs:{variant:"primary"},on:{click:e.onNewForm}},[e._v(" "+e._s(e.t("forms","Create a form"))+" ")])]},proxy:!0}:null],null,!0)})],1):[s("router-view",{attrs:{form:e.selectedForm,"sidebar-opened":e.sidebarOpened},on:{"update:form":function(i){e.selectedForm=i},"update:sidebarOpened":function(i){e.sidebarOpened=i},"update:sidebar-opened":function(i){e.sidebarOpened=i},"open-sharing":e.openSharing}}),!e.selectedForm.partial&&e.canEdit?s("Sidebar",{attrs:{form:e.selectedForm,"sidebar-opened":e.sidebarOpened,active:e.sidebarActive},on:{"update:sidebarOpened":function(i){e.sidebarOpened=i},"update:sidebar-opened":function(i){e.sidebarOpened=i},"update:active":function(i){e.sidebarActive=i}}}):e._e()],s("ArchivedFormsModal",{attrs:{open:e.showArchivedForms,forms:e.archivedForms},on:{"update:open":function(i){e.showArchivedForms=i},clone:e.onCloneForm}})],2)},Za=[],Ka=T(Qa,ja,Za,!1,null,"5a93235b");const Wa=Ka.exports;Q.directive("tooltip",Ks),Q.prototype.t=ze,Q.prototype.n=bs,new Q({el:"#content",name:"FormsRoot",router:Rr,render:e=>e(Wa)});
//# sourceMappingURL=forms-main.mjs.map
