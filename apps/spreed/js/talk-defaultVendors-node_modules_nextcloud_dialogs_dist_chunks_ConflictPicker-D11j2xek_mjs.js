"use strict";(()=>{(self.webpackChunktalk=self.webpackChunktalk||[]).push([["defaultVendors-node_modules_nextcloud_dialogs_dist_chunks_ConflictPicker-D11j2xek_mjs"],{82880:(oe,$,a)=>{a.r($),a.d($,{default:()=>ie});var e=a(20641),t=a(50953),i=a(90033),K=a(53751),p=a(9165),w=a(15446),C=a(86296),N=a(94434),g=a(82510),U=a(35810),B=a(10997),z=a(88720),l=a(80837),T=a(50240);const V=["src"],j={key:1},H=["src"],Y={key:1},J=64,Z=(0,e.pM)({__name:"ConflictPickerEntry",props:(0,e.zz)({existing:{},incoming:{}},{existingSelected:{type:Boolean,required:!0},existingSelectedModifiers:{},incomingSelected:{type:Boolean,required:!0},incomingSelectedModifiers:{}}),emits:["update:existingSelected","update:incomingSelected"],setup(r,{expose:F}){const d=(0,e.fn)(r,"existingSelected"),f=(0,e.fn)(r,"incomingSelected"),v=r;F({validate:I});const h=n=>"FileSystemEntry"in window&&n instanceof window.FileSystemEntry,L=n=>"FileSystemFileEntry"in window&&n instanceof window.FileSystemFileEntry,o=(0,t.KR)(""),c=(0,t.KR)(),_=(0,t.KR)(),y=(0,t.KR)(),E=(0,t.KR)(),R=(0,t.KR)(),P=(0,t.KR)(),k=(0,e.EW)(()=>f.value||d.value),S=(0,e.EW)(()=>v.existing.type===U.pt.Folder),A=(0,e.EW)(()=>h(v.incoming)?v.incoming.isDirectory:v.incoming instanceof File?!1:v.incoming.type===U.pt.Folder);(0,e.wB)(()=>v.existing,async()=>{E.value=D(v.existing),P.value=W(v.existing),_.value=await M(v.existing)}),(0,e.wB)(()=>v.incoming,async()=>{const n=await O(v.incoming);n!==null&&(y.value=D(n),R.value=W(n),c.value=await M(n))});async function O(n){return L(n)?await new Promise((s,m)=>n.file(s,m)):h(n)?null:n}function W(n){return n.size}function D(n){if(n instanceof File){const s=n.lastModified;if(s>0)return new Date(s)}else return n.mtime}async function M(n){return n instanceof File?await b(n):(0,z.g)(n,{size:J})?.toString()}async function b(n){if(!n.type.startsWith("image/"))return;const{resolve:s,promise:m}=Promise.withResolvers(),u=new FileReader;return u.onload=async x=>{const X=x?.target?.result;if(X instanceof ArrayBuffer){const le=new Blob([X],{type:n.type}),se=URL.createObjectURL(le);s(se);return}s(void 0)},u.readAsArrayBuffer(n),m}function I(){o.value=!f.value&&!d.value?(0,l.t)("You need to choose at least one conflict solution"):""}return(n,s)=>((0,e.uX)(),(0,e.CE)("fieldset",{class:(0,i.C4)(n.$style.pickerEntry)},[(0,e.Lk)("legend",null,(0,i.v_)(r.existing.basename),1),(0,e.bF)((0,t.R1)(C.A),{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=m=>f.value=m),error:!!o.value,"helper-text":o.value,required:!k.value},{default:(0,e.k6)(()=>[(0,e.Lk)("span",{class:(0,i.C4)(n.$style.pickerEntryItem)},[c.value?((0,e.uX)(),(0,e.CE)("img",{key:1,class:(0,i.C4)(n.$style.pickerEntryPreview),src:c.value,alt:"",loading:"lazy"},null,10,V)):((0,e.uX)(),(0,e.Wv)((0,t.R1)(g.A),{key:0,class:(0,i.C4)([n.$style.pickerEntryIcon,{[n.$style.pickerEntryIcon_folder]:S.value}]),path:A.value?(0,t.R1)(p.fEr):(0,t.R1)(p.DvY),size:48},null,8,["class","path"])),(0,e.Lk)("span",{class:(0,i.C4)(n.$style.pickerEntryDescription)},[(0,e.Lk)("span",null,(0,i.v_)((0,t.R1)(l.t)("New version")),1),y.value?((0,e.uX)(),(0,e.Wv)((0,t.R1)(B.A),{key:0,timestamp:y.value,"relative-time":!1,format:{timeStyle:"short",dateStyle:"medium"}},null,8,["timestamp"])):((0,e.uX)(),(0,e.CE)("span",j,(0,i.v_)((0,t.R1)(l.t)("Last modified date unknown")),1)),(0,e.Lk)("span",null,(0,i.v_)(R.value),1)],2)],2)]),_:1},8,["modelValue","error","helper-text","required"]),(0,e.bF)((0,t.R1)(C.A),{modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=m=>d.value=m),error:!!o.value,"helper-text":o.value,required:!k.value},{default:(0,e.k6)(()=>[(0,e.Lk)("span",{class:(0,i.C4)(n.$style.pickerEntryItem)},[_.value?((0,e.uX)(),(0,e.CE)("img",{key:1,class:(0,i.C4)(n.$style.pickerEntryPreview),src:_.value,alt:"",loading:"lazy"},null,10,H)):((0,e.uX)(),(0,e.Wv)((0,t.R1)(g.A),{key:0,class:(0,i.C4)([n.$style.pickerEntryIcon,{[n.$style.pickerEntryIcon_folder]:S.value}]),path:S.value?(0,t.R1)(p.fEr):(0,t.R1)(p.DvY),size:48},null,8,["class","path"])),(0,e.Lk)("span",{class:(0,i.C4)(n.$style.pickerEntryDescription)},[(0,e.Lk)("span",null,(0,i.v_)((0,t.R1)(l.t)("Existing version")),1),E.value?((0,e.uX)(),(0,e.Wv)((0,t.R1)(B.A),{key:0,timestamp:E.value,"relative-time":!1,format:{timeStyle:"short",dateStyle:"medium"}},null,8,["timestamp"])):((0,e.uX)(),(0,e.CE)("span",Y,(0,i.v_)((0,t.R1)(l.t)("Last modified date unknown")),1)),(0,e.Lk)("span",null,(0,i.v_)(P.value),1)],2)],2)]),_:1},8,["modelValue","error","helper-text","required"])],2))}}),G={$style:{pickerEntry:"_pickerEntry_xk2pl_1",pickerEntryItem:"_pickerEntryItem_xk2pl_5",pickerEntryIcon:"_pickerEntryIcon_xk2pl_11",pickerEntryPreview:"_pickerEntryPreview_xk2pl_12",pickerEntryIcon_folder:"_pickerEntryIcon_folder_xk2pl_24",pickerEntryDescription:"_pickerEntryDescription_xk2pl_34"}},Q=(0,T._)(Z,[["__cssModules",G]]),q={class:"hidden-visually"},ee={key:0,class:"hidden-visually"},ne=(0,e.pM)({__name:"ConflictPicker",props:{container:{},dirname:{},existing:{},incoming:{},recursiveUpload:{type:Boolean}},emits:["close"],setup(r,{emit:F}){const d=r,f=F,v=(0,l.t)("You need to select at least one version of each file to continue."),h=(0,e.rk)("form"),L=(0,e.rk)("conflictEntry"),o=(0,t.IJ)([]),c=(0,t.IJ)([]),_=(0,e.EW)(()=>o.value.length===0),y=(0,e.EW)(()=>o.value.length===d.incoming.length),E=(0,e.EW)(()=>!y.value&&!_.value),R=(0,e.EW)(()=>c.value.length===d.existing.length),P=(0,e.EW)(()=>!R.value&&!_.value),k=(0,e.EW)(()=>{for(const n of d.incoming)if(!(c.value.includes(n)||o.value.includes(n)))return!1;return!0}),S=(0,e.EW)(()=>d.dirname?.trim()!==""?(0,l.n)("%n file conflict in {dirname}","%n file conflicts in {dirname}",d.incoming.length,{dirname:d.dirname}):(0,l.n)("%n file conflict","%n files conflict",d.incoming.length));function A(){f("close",null)}function O(){l.l.debug("Conflict skipped. Ignoring all conflicting files"),f("close",{selected:[],renamed:[],skipped:[...d.incoming]})}function W(n){n?(l.l.debug("Selected all new files"),o.value=[...d.incoming]):(l.l.debug("Cleared new selection"),o.value=[])}function D(n){n?(l.l.debug("Selected all existing files"),c.value=[...d.incoming]):(l.l.debug("Cleared old selection"),c.value=[])}function M(n){c.value.includes(n)?c.value=c.value.filter(s=>s!==n):c.value=[...c.value,n]}function b(n){o.value.includes(n)?o.value=o.value.filter(s=>s!==n):o.value=[...o.value,n]}function I(){if(!k.value){for(const u of L.value)u.validate();h.value.reportValidity(),(0,l.s)(v);return}const n=o.value.filter(u=>!c.value.includes(u)),s=o.value.filter(u=>c.value.includes(u)),m=c.value.filter(u=>!o.value.includes(u));f("close",{renamed:s,selected:n,skipped:m})}return(n,s)=>((0,e.uX)(),(0,e.Wv)((0,t.R1)(N.A),{container:r.container,class:(0,i.C4)(n.$style.picker),name:S.value,size:"large",onClosing:A},{actions:(0,e.k6)(()=>[(0,e.bF)((0,t.R1)(w.A),{title:(0,t.R1)(l.t)("Cancel the entire operation"),"data-cy-conflict-picker-cancel":"",variant:"tertiary",onClick:A},{icon:(0,e.k6)(()=>[(0,e.bF)((0,t.R1)(g.A),{path:(0,t.R1)(p.hyP)},null,8,["path"])]),default:(0,e.k6)(()=>[(0,e.eW)(" "+(0,i.v_)((0,t.R1)(l.t)("Cancel")),1)]),_:1},8,["title"]),(0,e.Lk)("span",{class:(0,i.C4)(n.$style.pickerActionSeparator)},null,2),(0,e.bF)((0,t.R1)(w.A),{onClick:O},{icon:(0,e.k6)(()=>[(0,e.bF)((0,t.R1)(g.A),{path:(0,t.R1)(p.hyP)},null,8,["path"])]),default:(0,e.k6)(()=>[(0,e.eW)(" "+(0,i.v_)(r.incoming.length===1?(0,t.R1)(l.t)("Skip this file"):(0,t.R1)(l.n)("Skip %n file","Skip %n files",r.incoming.length)),1)]),_:1}),(0,e.bF)((0,t.R1)(w.A),{"aria-disabled":!k.value,class:(0,i.C4)([n.$style.pickerActionSubmit,{[n.$style.pickerActionSubmit_disabled]:!k.value}]),title:k.value?"":(0,t.R1)(v),type:"submit",variant:"primary",onClick:(0,K.D$)(I,["stop","prevent"])},{icon:(0,e.k6)(()=>[(0,e.bF)((0,t.R1)(g.A),{directional:"",path:(0,t.R1)(p.K5o)},null,8,["path"])]),default:(0,e.k6)(()=>[(0,e.eW)(" "+(0,i.v_)((0,t.R1)(l.t)("Continue"))+" ",1),k.value?(0,e.Q3)("",!0):((0,e.uX)(),(0,e.CE)("span",ee,(0,i.v_)((0,t.R1)(v)),1))]),_:1},8,["aria-disabled","class","title"])]),default:(0,e.k6)(()=>[(0,e.Lk)("div",{class:(0,i.C4)(n.$style.pickerHeader)},[(0,e.Lk)("p",{id:"conflict-picker-description",class:(0,i.C4)(n.$style.pickerDescription)},[(0,e.eW)((0,i.v_)((0,t.R1)(l.t)("Which files do you want to keep?")),1),s[0]||(s[0]=(0,e.Lk)("br",null,null,-1)),(0,e.eW)(" "+(0,i.v_)((0,t.R1)(l.t)("If you select both versions, the incoming file will have a number added to its name.")),1),s[1]||(s[1]=(0,e.Lk)("br",null,null,-1)),r.recursiveUpload?((0,e.uX)(),(0,e.CE)(e.FK,{key:0},[(0,e.eW)((0,i.v_)((0,t.R1)(l.t)("When an incoming folder is selected, the content is written into the existing folder and a recursive conflict resolution is performed.")),1)],64)):((0,e.uX)(),(0,e.CE)(e.FK,{key:1},[(0,e.eW)((0,i.v_)((0,t.R1)(l.t)("When an incoming folder is selected, any conflicting files within it will also be overwritten.")),1)],64))],2)],2),(0,e.Lk)("form",{ref:"form","aria-labelledby":"conflict-picker-description",class:(0,i.C4)(n.$style.pickerForm),onSubmit:(0,K.D$)(I,["prevent","stop"])},[(0,e.Lk)("fieldset",{class:(0,i.C4)(n.$style.pickerSelectAll)},[(0,e.Lk)("legend",q,(0,i.v_)((0,t.R1)(l.t)("Select all checkboxes")),1),(0,e.bF)((0,t.R1)(C.A),{"model-value":y.value,indeterminate:E.value,"onUpdate:modelValue":W},{default:(0,e.k6)(()=>[(0,e.eW)((0,i.v_)((0,t.R1)(l.t)("Select all new files")),1)]),_:1},8,["model-value","indeterminate"]),(0,e.bF)((0,t.R1)(C.A),{"model-value":R.value,indeterminate:P.value,"onUpdate:modelValue":D},{default:(0,e.k6)(()=>[(0,e.eW)((0,i.v_)((0,t.R1)(l.t)("Select all existing files")),1)]),_:1},8,["model-value","indeterminate"])],2),((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(r.existing,(m,u)=>((0,e.uX)(),(0,e.Wv)(Q,{ref_for:!0,ref:"conflictEntry",key:m.fileid,incoming:r.incoming[u],existing:m,"incoming-selected":o.value.includes(r.incoming[u]),"existing-selected":c.value.includes(r.incoming[u]),"onUpdate:existingSelected":x=>M(r.incoming[u]),"onUpdate:incomingSelected":x=>b(r.incoming[u])},null,8,["incoming","existing","incoming-selected","existing-selected","onUpdate:existingSelected","onUpdate:incomingSelected"]))),128))],34)]),_:1},8,["container","class","name"]))}}),te={$style:{picker:"_picker_6q4ek_1",pickerHeader:"_pickerHeader_6q4ek_6",pickerForm:"_pickerForm_6q4ek_15",pickerActionSubmit_disabled:"_pickerActionSubmit_disabled_6q4ek_22",pickerSelectAll:"_pickerSelectAll_6q4ek_27","conflict-picker__all":"_conflict-picker__all_6q4ek_40"}},ie=(0,T._)(ne,[["__cssModules",te]])}}]);})();

//# sourceMappingURL=talk-defaultVendors-node_modules_nextcloud_dialogs_dist_chunks_ConflictPicker-D11j2xek_mjs.js.map?v=00c3a0003c741df2b158