{"version":3,"file":"talk-node_modules_nextcloud_dialogs_dist_chunks_PublicAuthPrompt-CWSlYwmr_mjs.js?v=028db0976802ea4af043","mappings":"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","sources":["webpack:///talk/node_modules/@nextcloud/dialogs/dist/chunks/PublicAuthPrompt-CWSlYwmr.mjs"],"sourcesContent":["import { defineComponent, useTemplateRef, ref, watch, computed, createBlock, openBlock, unref, withCtx, createElementBlock, createCommentVNode, createVNode, toDisplayString } from \"vue\";\nimport { setGuestNickname } from \"@nextcloud/auth\";\nimport { getBuilder } from \"@nextcloud/browser-storage\";\nimport NcDialog from \"@nextcloud/vue/components/NcDialog\";\nimport NcNoteCard from \"@nextcloud/vue/components/NcNoteCard\";\nimport NcTextField from \"@nextcloud/vue/components/NcTextField\";\nimport { t, l as logger, s as showError } from \"./index-hZPKu-D6.mjs\";\nimport { validateFilename, InvalidFilenameError, InvalidFilenameErrorReason } from \"@nextcloud/files\";\nimport { _ as _export_sfc } from \"./_plugin-vue_export-helper-1tPrXgE0.mjs\";\n/*!\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nfunction getGuestNameValidity(name) {\n  if (name.trim() === \"\") {\n    return t(\"Names must not be empty.\");\n  }\n  if (name.startsWith(\".\")) {\n    return t(\"Names must not start with a dot.\");\n  }\n  if (name.length > 64) {\n    return t(\"Names may be at most 64 characters long.\");\n  }\n  try {\n    validateFilename(name);\n    return \"\";\n  } catch (error) {\n    if (!(error instanceof InvalidFilenameError)) {\n      throw error;\n    }\n    switch (error.reason) {\n      case InvalidFilenameErrorReason.Character:\n        return t('\"{char}\" is not allowed inside a name.', { char: error.segment });\n      case InvalidFilenameErrorReason.ReservedName:\n        return t('\"{segment}\" is a reserved name and not allowed.', { segment: error.segment });\n      case InvalidFilenameErrorReason.Extension:\n        if (error.segment.match(/\\.[a-z]/i)) {\n          return t('\"{extension}\" is not an allowed name.', { extension: error.segment });\n        }\n        return t('Names must not end with \"{extension}\".', { extension: error.segment });\n      default:\n        return t(\"Invalid name.\");\n    }\n  }\n}\nconst _hoisted_1 = {\n  key: 0,\n  class: \"public-auth-prompt__text\"\n};\nconst _sfc_main = /* @__PURE__ */ defineComponent({\n  __name: \"PublicAuthPrompt\",\n  props: {\n    nickname: { default: \"\" },\n    title: { default: t(\"Guest identification\") },\n    text: { default: \"\" },\n    notice: { default: \"\" },\n    submitLabel: { default: t(\"Submit name\") },\n    cancellable: { type: Boolean }\n  },\n  emits: [\"close\"],\n  setup(__props, { emit: __emit }) {\n    const props = __props;\n    const emit = __emit;\n    const inputElement = useTemplateRef(\"input\");\n    const storage = getBuilder(\"public\").build();\n    const name = ref(props.nickname);\n    watch(() => props.nickname, () => {\n      name.value = props.nickname;\n    });\n    watch(name, (newName) => {\n      const validity = getGuestNameValidity(newName);\n      if (!validity) {\n        inputElement.value.setCustomValidity(validity);\n        inputElement.value.reportValidity();\n        inputElement.value.focus();\n        return;\n      }\n    });\n    const buttons = computed(() => {\n      const cancelButton = {\n        label: t(\"Cancel\"),\n        variant: \"tertiary\",\n        callback: () => emit(\"close\")\n      };\n      const submitButton = {\n        label: props.submitLabel,\n        type: \"submit\",\n        variant: \"primary\"\n      };\n      if (props.cancellable) {\n        return [cancelButton, submitButton];\n      }\n      return [submitButton];\n    });\n    const defaultNotice = computed(() => {\n      if (props.notice) {\n        return props.notice;\n      }\n      if (name.value) {\n        return t(\"You are currently identified as {nickname}.\", { nickname: name.value });\n      }\n      return t(\"You are currently not identified.\");\n    });\n    function onSubmit() {\n      const nickname = name.value.trim();\n      const validity = getGuestNameValidity(nickname);\n      if (validity) {\n        inputElement.value.setCustomValidity(validity);\n        inputElement.value.reportValidity();\n        inputElement.value.focus();\n        return;\n      }\n      if (nickname === \"\") {\n        inputElement.value.setCustomValidity(t(\"You cannot leave the name empty.\"));\n        inputElement.value.reportValidity();\n        inputElement.value.focus();\n        return;\n      }\n      if (nickname.length < 2) {\n        inputElement.value.setCustomValidity(t(\"Please enter a name with at least 2 characters.\"));\n        inputElement.value.reportValidity();\n        inputElement.value.focus();\n        return;\n      }\n      try {\n        setGuestNickname(nickname);\n      } catch (error) {\n        logger.error(\"Failed to set nickname\", { error });\n        showError(t(\"Failed to set nickname.\"));\n        inputElement.value.focus();\n        return;\n      }\n      storage.setItem(\"public-auth-prompt-shown\", \"true\");\n      emit(\"close\", name.value);\n    }\n    return (_ctx, _cache) => {\n      return openBlock(), createBlock(unref(NcDialog), {\n        buttons: buttons.value,\n        class: \"public-auth-prompt\",\n        \"data-cy-public-auth-prompt-dialog\": \"\",\n        \"is-form\": \"\",\n        \"no-close\": \"\",\n        name: __props.title,\n        onSubmit\n      }, {\n        default: withCtx(() => [\n          __props.text ? (openBlock(), createElementBlock(\"p\", _hoisted_1, toDisplayString(__props.text), 1)) : createCommentVNode(\"\", true),\n          createVNode(unref(NcNoteCard), {\n            class: \"public-auth-prompt__header\",\n            text: defaultNotice.value,\n            type: \"info\"\n          }, null, 8, [\"text\"]),\n          createVNode(unref(NcTextField), {\n            ref: \"input\",\n            modelValue: name.value,\n            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => name.value = $event),\n            class: \"public-auth-prompt__input\",\n            \"data-cy-public-auth-prompt-dialog-name\": \"\",\n            label: unref(t)(\"Name\"),\n            placeholder: unref(t)(\"Enter your name\"),\n            required: !__props.cancellable,\n            minlength: \"2\",\n            maxlength: \"64\",\n            name: \"name\"\n          }, null, 8, [\"modelValue\", \"label\", \"placeholder\", \"required\"])\n        ]),\n        _: 1\n      }, 8, [\"buttons\", \"name\"]);\n    };\n  }\n});\nconst PublicAuthPrompt = /* @__PURE__ */ _export_sfc(_sfc_main, [[\"__scopeId\", \"data-v-b33d88e5\"]]);\nexport {\n  PublicAuthPrompt as default\n};\n//# sourceMappingURL=PublicAuthPrompt-CWSlYwmr.mjs.map\n"],"names":["getGuestNameValidity","name","error","_hoisted_1","_sfc_main","__props","__emit","props","emit","inputElement","storage","newName","validity","buttons","cancelButton","submitButton","defaultNotice","onSubmit","nickname","_ctx","_cache","$event","PublicAuthPrompt"],"sourceRoot":""}