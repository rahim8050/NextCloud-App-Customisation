import{_ as v,o as s,b as i,d as r,t as D,k as P,n as S,l as x,m as l,i as f,g as b,h as V,F as g,p as C,e as _,L as N}from"./LegacyGlobalMixin-fsGrxvTH.chunk.mjs";import{C as $,I as L,m as z,e as k,r as m,c as A,u as T,n as w,a as F,v as H,b as R,s as j}from"./style-B-IJY7WJ.chunk.mjs";import{b as G,c as q}from"./index-01gXY4hn.chunk.mjs";const B={name:"AccountMultipleIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},K=["aria-hidden","aria-label"],Q=["fill","width","height"],U={d:"M16 17V19H2V17S2 13 9 13 16 17 16 17M12.5 7.5A3.5 3.5 0 1 0 9 11A3.5 3.5 0 0 0 12.5 7.5M15.94 13A5.32 5.32 0 0 1 18 17V19H22V17S22 13.37 15.94 13M15 4A3.39 3.39 0 0 0 13.07 4.59A5 5 0 0 1 13.07 10.41A3.39 3.39 0 0 0 15 11A3.5 3.5 0 0 0 15 4Z"},Z={key:0};function J(a,e,o,c,n,d){return s(),i("span",S(a.$attrs,{"aria-hidden":o.title?null:"true","aria-label":o.title,class:"material-design-icon account-multiple-icon",role:"img",onClick:e[0]||(e[0]=p=>a.$emit("click",p))}),[(s(),i("svg",{fill:o.fillColor,class:"material-design-icon__svg",width:o.size,height:o.size,viewBox:"0 0 24 24"},[r("path",U,[o.title?(s(),i("title",Z,D(o.title),1)):P("",!0)])],8,Q))],16,K)}const W=v(B,[["render",J]]),{profileEnabled:X}=x("user_status","profileEnabled",!1),Y={name:"ReadOnlyContactDetails",components:{ContactDetailsProperty:$,NcEmptyContent:G,IconContact:W,NcLoadingIcon:q},mixins:[L],props:{contactEmailAddress:{type:String,required:!0},desc:{type:String,required:!1,default:""}},data(){return{contactDetailsSelector:".contact-details",excludeFromBirthdayKey:"x-nc-exclude-from-birthday-calendar",bus:z(),showMenuPopover:!1,profileEnabled:X,contact:void 0,localContact:void 0,loading:!0}},computed:{formattedSubtitle(){const a=this.contact.title,e=this.contact.org;return a&&e?t("contacts","{title} at {organization}",{title:a,organization:e}):a?k(a):e?k(e):""},addressbooks(){return this.$store.getters.getAddressbooks},sortedProperties(){return!this.localContact||!this.localContact.properties?[]:this.localContact.properties.toSorted((a,e)=>{const o=a.name.split(".").pop(),c=e.name.split(".").pop();return m.fieldOrder.indexOf(o)-m.fieldOrder.indexOf(c)})},groupedProperties(){return this.sortedProperties?this.sortedProperties.reduce((a,e)=>(this.canDisplay(e)&&(a[e.name]||(a[e.name]=[]),a[e.name].push(e)),a),{}):{}},addressbookIsReadOnly(){return this.contact.addressbook?.readOnly},addressbook(){return this.contact.addressbook.id},groupsModel(){return{readableName:t("mail","Contact groups"),icon:"icon-contacts-dark"}}},watch:{contact:{handler(a){this.updateLocalContact(a)},immediate:!0}},async beforeMount(){await A.connect({enableCardDAV:!0}),T().setCurrentUserPrincipal(A),await this.$store.dispatch("getAddressbooks"),await this.fetchContact()},methods:{async fetchContact(){try{const a=this.contactEmailAddress,e=(await Promise.all(this.addressbooks.map(async o=>[o.dav,await o.dav.addressbookQuery([{name:[w.IETF_CARDDAV,"prop-filter"],attributes:[["name","EMAIL"]],children:[{name:[w.IETF_CARDDAV,"text-match"],value:a}]}])]))).flatMap(([o,c])=>c.map(n=>new F(n.data,o)));this.contact=e.find(o=>o.email===a)}catch(a){console.error("Error fetching contact:",a)}finally{this.loading=!1}},updateGroups(a){this.newGroupsValue=a},async updateLocalContact(a){if(!a){this.localContact=void 0;return}const e=Object.assign(Object.create(Object.getPrototypeOf(a)),a);H(e),this.localContact=e,this.newGroupsValue=[...this.localContact.groups]},canDisplay(a){const e=m.properties[a.name.split(".").pop()],o=e&&e.force?e.force:a.getDefaultType();return e&&o!=="unknown"}}},tt={class:"display-contact-details"},at={key:0,class:"recipient-details-loading"},et={key:2,class:"recipient-details-content"},ot={class:"contact-title"},nt=["innerHTML"],st={class:"contact-details-wrapper"};function it(a,e,o,c,n,d){const p=l("NcLoadingIcon"),O=l("IconContact"),E=l("NcEmptyContent"),M=l("ContactDetailsProperty");return s(),i("div",tt,[n.loading?(s(),i("div",at,[f(p)])):n.contact?(s(),i("div",et,[r("div",ot,[r("h6",null,D(n.contact.fullName),1),r("span",{innerHTML:d.formattedSubtitle},null,8,nt)]),r("div",st,[(s(!0),i(g,null,C(d.groupedProperties,(h,I)=>(s(),i("div",{key:I},[(s(!0),i(g,null,C(h,(y,u)=>(s(),b(M,{key:`${u}-${n.contact.key}-${y.name}`,"is-first-property":u===0,"is-last-property":u===h.length-1,property:y,contact:n.contact,"local-contact":n.localContact,contacts:[n.contact],"is-read-only":!0,bus:n.bus},null,8,["is-first-property","is-last-property","property","contact","local-contact","contacts","bus"]))),128))]))),128))])])):(s(),b(E,{key:1,class:"empty-content",name:a.t("mail","No data for this contact"),description:a.t("mail","No data for this contact on their profile")},{icon:V(()=>[f(O,{size:20})]),_:1},8,["name","description"]))])}const ct=v(Y,[["render",it],["__scopeId","data-v-b4d71f26"]]);window.OCA??={},window.OCA.Contacts={async mountContactDetails(a,e){const o=_(ct,{contactEmailAddress:e}),c=R();return o.use(c),o.use(j),o.mixin(N),o.mount(a),{$destroy:()=>o.unmount()}}};
//# sourceMappingURL=contacts-oca.mjs.map
